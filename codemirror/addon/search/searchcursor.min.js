!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(i){"use strict";var p,x,L=i.Pos;function m(t,e){for(var n,r,i=null!=(r=(n=t).flags)?r:(n.ignoreCase?"i":"")+(n.global?"g":"")+(n.multiline?"m":""),o=i,l=0;l<e.length;l++)-1==o.indexOf(e.charAt(l))&&(o+=e.charAt(l));return i==o?t:new RegExp(t.source,o)}function d(t,e,n){e=m(e,"g");for(var r=n.line,i=n.ch,o=t.lastLine();r<=o;r++,i=0){e.lastIndex=i;var l=t.getLine(r),h=e.exec(l);if(h)return{from:L(r,h.index),to:L(r,h.index+h[0].length),match:h}}}function v(t,e){for(var n,r=0;;){e.lastIndex=r;var i=e.exec(t);if(!i)return n;if((r=(n=i).index+(n[0].length||1))==t.length)return n}}function C(t,e,n,r){if(t.length==e.length)return n;for(var i=0,o=n+Math.max(0,t.length-e.length);;){if(i==o)return i;var l=i+o>>1,h=r(t.slice(0,l)).length;if(h==n)return l;n<h?o=l:i=l+1}}function r(n,r,t,e){var i;this.atOccurrence=!1,this.doc=n,t=t?n.clipPos(t):L(0,0),this.pos={from:t,to:t},"object"==typeof e?i=e.caseFold:(i=e,e=null),"string"==typeof r?(null==i&&(i=!1),this.matches=function(t,e){return(t?function(t,e,n,r){if(!e.length)return null;var i=r?p:x,o=i(e).split(/\r|\n\r?/);t:for(var l=n.line,h=n.ch,s=t.firstLine()-1+o.length;s<=l;l--,h=-1){var c=t.getLine(l);-1<h&&(c=c.slice(0,h));var f=i(c);if(1==o.length){var u=f.lastIndexOf(o[0]);if(-1==u)continue t;return{from:L(l,C(c,f,u,i)),to:L(l,C(c,f,u+o[0].length,i))}}var a=o[o.length-1];if(f.slice(0,a.length)==a){var g=1;for(n=l-o.length+1;g<o.length-1;g++)if(i(t.getLine(n+g))!=o[g])continue t;var m=t.getLine(l+1-o.length),d=i(m);if(d.slice(d.length-o[0].length)==o[0])return{from:L(l+1-o.length,C(m,d,m.length-o[0].length,i)),to:L(l,C(c,f,a.length,i))}}}}:function(t,e,n,r){if(!e.length)return null;var i=r?p:x,o=i(e).split(/\r|\n\r?/);t:for(var l=n.line,h=n.ch,s=t.lastLine()+1-o.length;l<=s;l++,h=0){var c=t.getLine(l).slice(h),f=i(c);if(1==o.length){var u=f.indexOf(o[0]);if(-1==u)continue t;return n=C(c,f,u,i)+h,{from:L(l,C(c,f,u,i)+h),to:L(l,C(c,f,u+o[0].length,i)+h)}}var a=f.length-o[0].length;if(f.slice(a)==o[0]){for(var g=1;g<o.length-1;g++)if(i(t.getLine(l+g))!=o[g])continue t;var m=t.getLine(l+o.length-1),d=i(m),v=o[o.length-1];if(d.slice(0,v.length)==v)return{from:L(l,C(c,f,a,i)+h),to:L(l+o.length-1,C(m,d,v.length,i))}}}})(n,r,e,i)}):(r=m(r,"gm"),e&&!1===e.multiline?this.matches=function(t,e){return(t?function(t,e,n){e=m(e,"g");for(var r=n.line,i=n.ch,o=t.firstLine();o<=r;r--,i=-1){var l=t.getLine(r);-1<i&&(l=l.slice(0,i));var h=v(l,e);if(h)return{from:L(r,h.index),to:L(r,h.index+h[0].length),match:h}}}:d)(n,r,e)}:this.matches=function(t,e){return(t?function(t,e,n){e=m(e,"gm");for(var r,i=1,o=n.line,l=t.firstLine();l<=o;){for(var h=0;h<i;h++){var s=t.getLine(o--);r=null==r?s.slice(0,n.ch):s+"\n"+r}i*=2;var c=v(r,e);if(c){var f=r.slice(0,c.index).split("\n"),u=c[0].split("\n"),a=o+f.length,g=f[f.length-1].length;return{from:L(a,g),to:L(a+u.length-1,1==u.length?g+u[0].length:u[u.length-1].length),match:c}}}}:function(t,e,n){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(e.source))return d(t,e,n);e=m(e,"gm");for(var r,i=1,o=n.line,l=t.lastLine();o<=l;){for(var h=0;h<i&&!(l<o);h++){var s=t.getLine(o++);r=null==r?s:r+"\n"+s}i*=2,e.lastIndex=n.ch;var c=e.exec(r);if(c){var f=r.slice(0,c.index).split("\n"),u=c[0].split("\n"),a=n.line+f.length-1,g=f[f.length-1].length;return{from:L(a,g),to:L(a+u.length-1,1==u.length?g+u[0].length:u[u.length-1].length),match:c}}}})(n,r,e)})}x=String.prototype.normalize?(p=function(t){return t.normalize("NFD").toLowerCase()},function(t){return t.normalize("NFD")}):(p=function(t){return t.toLowerCase()},function(t){return t}),r.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){for(var e=this.matches(t,this.doc.clipPos(t?this.pos.from:this.pos.to));e&&0==i.cmpPos(e.from,e.to);)t?e.from.ch?e.from=L(e.from.line,e.from.ch-1):e=e.from.line==this.doc.firstLine()?null:this.matches(t,this.doc.clipPos(L(e.from.line-1))):e.to.ch<this.doc.getLine(e.to.line).length?e.to=L(e.to.line,e.to.ch+1):e=e.to.line==this.doc.lastLine()?null:this.matches(t,L(e.to.line+1,0));if(e)return this.pos=e,this.atOccurrence=!0,this.pos.match||!0;var n=L(t?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:n,to:n},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(t,e){if(this.atOccurrence){var n=i.splitLines(t);this.doc.replaceRange(n,this.pos.from,this.pos.to,e),this.pos.to=L(this.pos.from.line+n.length-1,n[n.length-1].length+(1==n.length?this.pos.from.ch:0))}}},i.defineExtension("getSearchCursor",function(t,e,n){return new r(this.doc,t,e,n)}),i.defineDocExtension("getSearchCursor",function(t,e,n){return new r(this,t,e,n)}),i.defineExtension("selectMatches",function(t,e){for(var n=[],r=this.getSearchCursor(t,this.getCursor("from"),e);r.findNext()&&!(0<i.cmpPos(r.to(),this.getCursor("to")));)n.push({anchor:r.from(),head:r.to()});n.length&&this.setSelections(n,0)})});