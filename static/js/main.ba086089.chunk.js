(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{109:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlAAAAAoCAIAAAC+blOXAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBQTRCNkU3RDBEOTExMUU5Qjk3MkFERTEyRkI4RjBCQSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBQTRCNkU3RTBEOTExMUU5Qjk3MkFERTEyRkI4RjBCQSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkFBNEI2RTdCMEQ5MTExRTlCOTcyQURFMTJGQjhGMEJBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkFBNEI2RTdDMEQ5MTExRTlCOTcyQURFMTJGQjhGMEJBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+HvluxAAAAUhJREFUeNrs3TFOQkEQgGEwL7RIaAxHsJDiWXsZzsVJ6Kx5hRYcwdAQpDKhorGE4pFZ1sHvKzGZLFL82WKyw5/NahBh8rY4+/n+fWn+Hc8vLfv5a4n6v3VdFzJn87kPmbPdHUPmrL9izvNx+A6ZMx8/hsx5nU1C5jxNRyFznl9iztO2bcichwEA/AOCB4DgAYDgAYDgAYDgAYDgAUAJzaU/lN5bqjW/735S3zlR3yv7+UsrvXcIuOEBgOABgOABgOABgOABgOABgOABwK+Le3hR+161ZN8zy7JPVuu9Ovt2gBseAAgeAIIHAIIHAIIHAIIHAIIHADfS3Ov+U/Z34LK/S/fXfl8ANzwABA8ABA8ABA8ABA8ABA8ABA8ArtTU2lvK8t5e33Nmf4cvC/t2gBseAAgeAIIHAIIHAIIHAIIHAIIHADdyEmAARD5eRI/K+WsAAAAASUVORK5CYII="},110:function(e){e.exports={a:"23:31 01/28/20"}},111:function(e,t,n){e.exports=n.p+"static/media/loshermanosbros-lite.c3b13663.gif"},112:function(e,t,n){e.exports=n.p+"static/media/breakout-lite.a4d778a2.gif"},113:function(e,t,n){e.exports=n.p+"static/media/brospipe-lite.82f3b93a.gif"},114:function(e,t,n){e.exports=n.p+"static/media/livecoding480.20d1866a.gif"},115:function(e,t,n){e.exports=n.p+"static/media/slider480.dc4d8c4b.gif"},116:function(e,t,n){e.exports=n.p+"static/media/pauserewind.741e69fa.gif"},117:function(e,t,n){e.exports=n.p+"static/media/toggle.4ab6d6b6.gif"},118:function(e,t,n){e.exports=n.p+"static/media/spritedemo.76159464.gif"},119:function(e,t,n){e.exports=n.p+"static/media/mapdemo.23680514.gif"},120:function(e,t,n){e.exports=n.p+"static/media/musicdemo.c1b0f3bd.gif"},125:function(e){e.exports=[{title:"Game loop",dl:[["init(state)","This function is called first before anything else. Set your game's initial state here. Note that your game's state must be a serializable object, e.g. don't put a function in there. You may also do non-state initialization logic here, e.g. call `resetMap()`."],["update(state, input, elapsed)","This function is called before `draw`. `state` is your game's state. Mutate state here. Note that you should not assign a new variable to `state`. Instead, assign individual properties. For example, don't do this: `state = { lives: 0}`. Do this: `state.lives = 0`. `elapsed` is time passed since last `update` call. See below for an explanation of `input`."],["drawActors(state)","Draws `actors` in `state`. Internally this function calls `sprite` per actor. So make sure your actors each have at least `x`, `y`, and `sprite` properties."],["draw(state)","This function is called after `draw`. `state` is your game's state."]]},{title:"Input",dl:[["","The `update` function receives `input` as its second parameter. It's an object of booleans representing user input: up, right, down, left, a, b, start, and select. On keyboards, the last two represent Enter and Space, respectively. There are several input variations:"],["<button>","Whether a button is currently held down (or not). For example, if you're holding right and up, `input` will have the following properties: `{ right: true, up: true }`."],["<buttonPressed>","Whether a button is pressed on the current frame but not on the previous frame. For example, if you pressed `up` in the current frame, `input` will have the following property: `{ upPressed: true }`."],["<buttonReleased>","Whether a button is not pressed on the current frame but was pressed on the previous frame."]]},{title:"Draw",note:"non-integers are rounded down",dl:[["print(x, y, text, [color=0])","Draws `text` at xy."],["getPixel(x, y)","Returns the current color of the pixel xy."],["setPixel(x, y, [color=0])","Sets the color of the pixel xy."],["line(x1, y1, x2, y2, [color=0])","Draws line from x1y1 to x2y2."],["rectStroke(x, y, width, height, [color=0])","Strokes a rectangle at xy."],["rectFill(x, y, width, height, [color=0])","Fills a rectangle at xy."],["circStroke(x, y, radius, [color=0])","Strokes a circle at xy."],["circFill(x, y, radius, [color=0])","Fills a circle at xy."],["polyStroke(points, [rotate, [x, y]], color)","Strokes a polygon as defined by an array of points, each point being a two-element array. You do not need to close the polygon. For example, to draw a square at 0,0: `polyStroke([[0,0], [4,0], [4,4], [0, 4]], 0)`. `rotate` is in degrees. If `rotate` is supplied, but no xy, rotates the polygon. If `rotate` and `xy` is supplied, rotates the polygon about xy. Note color is not optional."],["sprite(x, y, sprite, [brighten, flipH, flipV])","Draws the sprite at xy. `sprite` is an integer between 0 and 127. The optional integer `brighten` will draw the sprite's pixels brighter by the specified amount. Negative values darken the sprite. If `flipH` is true, mirrors the sprite along the y axis, and if `flipV` is true, mirrors the sprite along the x axis."],["clear([c])","Clears the screen. Optionally pass in a color to draw the entire screen with that color."],["getTile(mx, my)","If found, returns the sprite at this location. `mx` and `my` are in map coordinates. The result is an array, with a `type` property indicating the sprite type (0-1-2-3)."],["setTile(mx, my, spriteNumber)","Sets the sprite on the map. `mx` and `my` are in map coordinates."],["map([mx=0, my=0])","Draws the map. `mx` and `my` are in map coordinates, e.g. mx=1, my=1 is the top-left map tile."],["resetMap()","Resets the map. Useful when you've called `setTile`."],["camera([x=0, y=0])","Offsets the top-left corner from subsequent draw coordinates. Call `camera()` to reset it."]]},{title:"Utility",dl:[["colorSwap(from, to)","Swaps one color with another. Applies to any drawing calls. Reset with `colorSwap()`."],["colorSwap()","Resets any previous color swaps."],["range([start=0], end, [step=1])","Creates an array of numbers from `start` up to `end`, not inclusive. <a class='text' href='https://lodash.com/docs/4.17.11#range'>By Lodash</a>."],["flatten(array)","Flattens `array` a single level deep. <a class='text' href='https://lodash.com/docs/4.17.11#flatten'>By Lodash</a>."],["random([lower=0], [upper=1])","Returns a random number between `lower` and `upper`. <a class='text' href='https://lodash.com/docs/4.17.11#random'>By Lodash</a>."],["clamp(number, [lower], upper)","Clamps `number` between inclusive `lower` and `upper`. <a class='text' href='https://lodash.com/docs/4.17.11#clamp'>By Lodash</a>."],["log(message)","Prints `message` to the preview window."],["new StateMachine({ init, transitions })","Creates a state machine. By <a class='text' href='https://github.com/jakesgordon/javascript-state-machine'>Jake Gordon</a>. Consult its documentation."]]},{title:"Sound",dl:[["playPhrase(phrase)","Plays a phrase as defined in the PHRASE editor. `phrase` is the phrase number. You can only play one phrase at a time."],["playChain(chain, [loop=false])","Plays a chain as defined in the CHAIN editor. `chain` is the chain number. Set `loop` to true to make the chain loop infinitely. You can only play one chain at a time."],["stopChain()","Stops the current chain."],["playSong(song, [loop=false])","Plays a song as defined in the SONG editor. `song` is the song number. Set `loop` to true to make the song loop infinitely. You can only play one song at a time."],["stopSong()","Stops the current song."]]}]},126:function(e){e.exports=[["What is SCRIPT-8's resolution?","128 pixels by 128 pixels."],["How do I use colors?","There are 8 colors, from 0 (brightest) to 7 (darkest). But they wrap around: 8 is 0 is 16, etc."],["What is the frame rate?","SCRIPT-8 tries to draw at 60fps, or a new frame every 16.6ms. This might vary due to many factors: device capabilities, game code, battery status, etc."],["How do I use the slider?","In CODE, click on a number. Hold the Shift key (or Command, if you're on a Mac) and move the slider."],["How do I display my cassette's title in SHELF?","In CODE, set the first line as `// title: My Title`. Once you put the cassette on SHELF, your title will show up."],["How do I copy someone else's cassette to my own cassette?","Load the cassette (go to the URL). Then mouse over CASSETTE and click RECORD TO BLANK. The other person's cassette has now been copied to your own cassette. The URL has changed. Your changes here won't affect the original cassette. This is a great way to learn."],["How do I make my existing cassette work with `init`?","You can UPDATE a cassette to the latest SCRIPT-8 API by mousing over CASSETTE and then choosing UPDATE API. You cannot revert this change."],['How do I enable the "past and future paths" feature?',"This will work automatically if you put your sprites into the `actors` array in `state` (see `drawActors` in the API docs). SCRIPT-8 will use this array to know what to keep track of, where it has been (`x` and `y` properties), and how to draw it (`sprite`). To see it in action, pause your game and click one of the sprites that should appear under the timeline."],["Why do I have to give SCRIPT-8 public_repo scope?","This is necessary to post comments, which are stored as comments on a sister SCRIPT-8 public repo. If you're curious, the implementation is in `Comments.js`."]]},127:function(e){e.exports=[["Alt-f","Format code"],["Ctrl-/ / Cmd-/","Comment/uncomment code"],["Ctrl-f / Cmd-f","Start searching"],["Ctrl-g / Cmd-g","Find next"],["Shift-Ctrl-g / Shift-Cmd-g","Find previous"],["Shift-Ctrl-r / Shift-Cmd-Option-f","Replace all"],["Ctrl-s / Cmd-s","Record cassette"],["Alt-[ / Alt-]","Go to previous/next code tab"],["Alt-. / Alt-/","Go to previous/next screen"]]},130:function(e,t,n){e.exports=n(293)},20:function(e){e.exports={a:"0.1.280"}},29:function(e){e.exports=[{title:"Welcome to SCRIPT-8's lesson modes.",shortTitle:"Introduction",slides:[{text:["We are going to learn how to make games!","Each lesson will introduce a new concept."]},{text:["We will learn to draw characters and make them move.","We will learn to make worlds for our characters.","Then we'll add enemies and a bit of music, of course."]},{text:["You'll find the list of lessons in HELP.","Click HELP in the top menu."],requirements:{screen:"HELP"}},{screen:"HELP",text:["All the lessons are listed here, at the top.","Alright. That's enough introduction for now.","Let's start!"]}]},{title:"Hello world!",slides:[{text:['In this lesson we will make a cassette that says "Hello world!".',"This might not be too exciting, but all good stories start at the beginning.","So let's begin."]},{text:["Before we get going: make sure to record any unsaved changes.","The lesson will insert a blank cassette.","Click NEXT when you're ready."],newGameOnNext:!0},{game:"",text:["We need to go to the CODE screen to write our code.","Click CODE in the top menu."],requirements:{screen:"CODE"}},{screen:"CODE",text:["Enter the following lines:","XXdraw = () => {","XX \u2003print(42, 60, 'Hello world!', 0)","XX}"]},{game:"draw = () => {\n  print(42, 60, 'Hello world!', 0)\n}",screen:"CODE",text:["Your first SCRIPT-8 cassette!","You should see 'Hello world!' drawn on the right.","If not it's because you're on a small screen."]},{screen:"CODE",text:["But that's OK. You can see the cassette full-screen in RUN.","Click RUN now. It might show up as RU if you're on a small screen."],requirements:{screen:"RUN"}},{text:["This is also what your friends will see when they load your cassette."]},{text:["Speaking of which, save it! This is, after all, the beginning of your story.","Mouse over CASSETTE, on the menu, and click RECORD."]},{text:["You'll notice the URL changed.","It's your cassette's URL now.","You can share it with family and friends."]},{text:["In the next lesson we'll try to understand what we typed here.","It is always good to know what is going on.","Good-bye for now. See you soon!"]}]},{title:"Hello many worlds!",slides:[{text:["In the previous lesson we learned how to draw letters.","Let's try to understand the code a bit. Then we can do more."]},{text:["Before we get going: make sure to record any unsaved changes.","The lesson will insert a blank cassette.","Click NEXT when you're ready."],newGameOnNext:!0},{game:"",text:["Let's go over to the CODE screen.","Click CODE in the top menu."],requirements:{screen:"CODE"}},{screen:"CODE",text:["Alright. Do you remember the 'Hello world!' code?","Enter it now. It's our starting point.","Don't remember it? That's OK. I'll do it for you. Click NEXT."]},{screen:"CODE",game:"draw = () => {\n  print(42, 60, 'Hello world!', 0)\n}",text:["There are two functions here, 'draw' and 'print'.","SCRIPT-8 calls the 'draw' function 60 times per second.","It's a very important function.","It's part of what some call the game loop."]},{screen:"CODE",game:"SAME",text:["The other function, 'print', prints text to the screen.","It takes four parameters: x, y, text, and color.","The first two, x and y, can be any integers from 0 to 127."]},{screen:"CODE",game:"SAME",text:["SCRIPT-8's resolution is 128px by 128px.","If you draw something at x = 128, well, that's past the right edge.","So you won't see it."]},{screen:"CODE",game:"SAME",text:["In fact, let's try that now. Change the first two numbers to something else.","If you're on a small screen, remember to click RUN to see your work.","Oh, and if things don't look right... that's OK. I'll explain."]},{text:["So. Did you try changing the numbers? And did your screen get all garbled?","That is probably not what you expected.","It looks like the text smeared all over itself. Not good.","Go back to CODE so we can fix this."],requirements:{screen:"CODE"}},{screen:"CODE",text:["Remember how SCRIPT-8 calls 'draw' 60 times a second?","That explains this glitch. SCRIPT-8 drew your text multiple times.","But it didn't clear the screen between each draw."]},{screen:"CODE",text:["SCRIPT-8 drew your texts on top of each other. Like you told it to.","Well. Let's tell it to clear the screen before every draw!"]},{screen:"CODE",text:["Add 'clear()' at the beginning of your function. Like this:","XXdraw = () => {","XX \u2003clear()","XX \u2003print(8, 8, 'Hello world!', 0)","XX}"]},{screen:"CODE",text:["And now you can change the x or y, and the text will be drawn fresh every time.","Great.","We still haven't talked about the last parameter: color."]},{text:["It can be any integer from 0 to 7.","That's because there are 8 colors in SCRIPT-8.","Change the color. Experiment. Oh. What happens if you enter... a 9?"]},{text:["It still drew something. Looks like... a 9 is like the color 1.","And 18 is the color 2. Try it."]},{text:["So, the color numbers seem to wrap around, in groups of 8.","SCRIPT-8 does this by design. It can be useful in certain situations.","This is also known as modular arithmetic."]},{text:['This lesson is titled "Hello many worlds!" but we haven\'t taken care of that.',"Can you guess how to fill the screen with 'Hello world!'? I'll do it for you."]},{game:"draw = () => {\n  clear()\n  print(0, 0, 'Hello world!', 0)\n  print(8, 8, 'Hello world!', 1)\n  print(16, 16, 'Hello world!', 2)\n  print(24, 24, 'Hello world!', 3)\n  print(32, 32, 'Hello world!', 4)\n  print(40, 40, 'Hello world!', 5)\n  print(48, 48, 'Hello world!', 6)\n  print(56, 56, 'Hello world!', 5)\n  print(64, 64, 'Hello world!', 4)\n  print(72, 72, 'Hello world!', 2)\n  print(80, 80, 'Hello world!', 1)\n  print(88, 88, 'Hello world!', 0)\n  print(96, 96, 'Hello world!', 1)\n  print(104, 104, 'Hello world!', 2)\n  print(112, 112, 'Hello world!', 3)\n  print(120, 120, 'Hello world!', 4)\n}",screen:"CODE",text:["OK. We have reached the end. I hope you learned something new.","The next lesson will be about SCRIPT-8's magical number slider.","Are you curious? I would be. See you in the next one!"]}]},{title:"The magical number slider",slides:[{text:["This lesson has a promising name, don't you think?","But first we must take care of something important."]},{text:["Before we get going: make sure to record any unsaved changes.","The lesson will insert a blank cassette.","Click NEXT when you're ready."],newGameOnNext:!0},{game:"",screen:"CODE",text:["Do you remember the last slide from our previous lesson? With all the 'Hello World!'s?","See if you can add that code here.","Don't worry if you forgot. I'll do it for you."]},{screen:"CODE",game:"draw = () => {\n  clear()\n  print(0, 0, 'Hello world!', 0)\n  print(8, 8, 'Hello world!', 1)\n  print(16, 16, 'Hello world!', 2)\n  print(24, 24, 'Hello world!', 3)\n  print(32, 32, 'Hello world!', 4)\n  print(40, 40, 'Hello world!', 5)\n  print(48, 48, 'Hello world!', 6)\n  print(56, 56, 'Hello world!', 5)\n  print(64, 64, 'Hello world!', 4)\n  print(72, 72, 'Hello world!', 2)\n  print(80, 80, 'Hello world!', 1)\n  print(88, 88, 'Hello world!', 0)\n  print(96, 96, 'Hello world!', 1)\n  print(104, 104, 'Hello world!', 2)\n  print(112, 112, 'Hello world!', 3)\n  print(120, 120, 'Hello world!', 4)\n}",text:["Pay close attention to all the `print` lines.","Isn't there a lot lot of repetition?","We can do better."]},{text:["Can you improve this using loops?","(Remember SCRIPT-8 cassettes are written in JavaScript).","I'll show you one way."]},{screen:"CODE",text:["This code uses a `for` loop to print 10 lines.","Not bad. We got rid of the duplication.","But there's a better way."],game:"draw = () => {\n  clear()\n  let i\n  for (i = 0; i < 10; i++) {\n    print(8 * i, 8 * i, 'Hello world!', i % 7)\n  }\n}"},{text:["SCRIPT-8 has a number of functions to help us do common tasks, such as looping over things.","One of them is `range`:","XXrange([start=0], end, [step=1])"],game:"SAME"},{screen:"CODE",text:["Here it is in action, next to the previous `for` code.","Much cleaner. No need to keep track of counter variables.","Now, about that magical slider."],game:"draw = () => {\n  clear()\n//   let i\n//   for (i = 0; i < 10; i++) {\n//     print(8 * i, 8 * i, 'Hello world!', i % 7)\n//   }\n  const lines = 10\n  range(lines).forEach(i => {\n    print(8 * i, 8 * i, 'Hello world!', i % 7)\n  })\n}"},{screen:"CODE",text:["Actually, just a moment (sorry!).","See how the 'Hello World!'s don't go all the way to the bottom?","Let's fix that. Change the 10 (in line 7) until the text goes all the way down."],game:"SAME"},{screen:"CODE",text:["You probably chose 16, right?","And how exactly did you do that?","You probably deleted 10, then typed 11. Deleted 11, typed 12.","Deleted 12, typed 13. Deleted 13, typed 14. Deleted 14, typed 15. Deleted 15, typed 16."]},{text:["That's also a lot of of duplication.","All that typing just to find the right integer.","If only there were an easier way to do this."]},{screen:"CODE",text:["Do something for me. Click on the number 10 above.","And then, on your keyboard, hold the Shift key (or Command, if you're on a Mac.)","You see that slider? With the square in the middle?","Drag that square to the right. And watch the cassette on the right."],game:"DEL2-5"},{text:["THE MAGICAL NUMBER SLIDER.","This lesson has come to an end.","Don't you wish your text editor had magical sliders?"]}]},{title:"Spinning squares",slides:[{text:["In this lesson we will learn how to draw 'Hello World!' KIDDING.","How about something more exciting. How about squares? Spinning squares?","Let's get started."]},{text:["Before we get going: make sure to record any unsaved changes.","The lesson will insert a blank cassette.","Click NEXT when you're ready."],newGameOnNext:!0},{text:["SCRIPT-8 has various drawing functions. They're all listed in HELP.","One of them is `rectStroke`:","XXrectStroke(x, y, width, height, [color=0])"],screen:"CODE",game:""},{text:["Can you use `rectStroke` to draw eight concentric squares?","Try for a bit. If you're stuck, I'll do it for you. Click NEXT."]},{text:["Oops, sorry! That doesn't look quite right.","There's eight squares, but they all start on the same xy spot.","Can you fix it? I'll also try."],screen:"CODE",game:"draw = () => {\n  clear()\n  range(8).forEach(i => {\n    const width = 8 * i\n    const height = 8 * i\n    const x = 64\n    const y = 64\n    rectStroke(x, y, width, height)\n  })\n}"},{text:["Good. Every new square needs to start a bit further up and to the left.","Before we move on, there's a bit of duplication here. You see it?","Let's fix that."],linesToHighlight:"5-6",screen:"CODE",game:"REP5-6\n    const x = 64 - width / 2\n    const y = 64 - height / 2"},{text:["Better. One final thing. The colors are all the same.","Can you change that?"],linesToHighlight:"3-4",screen:"CODE",game:"REP3-7\n    const side = 8 * i\n    const xy = 64 - side / 2\n    rectStroke(xy, xy, side, side)"},{text:["If we would have set color to `i`, the last square would be invisible.","Hence the use of the modulus operator."],linesToHighlight:"5-5",screen:"CODE",game:"REP5-5\n    const color = i % 7\n    rectStroke(xy, xy, side, side, color)"},{text:["Now, this lesson is titled spinning squares. And we can't rotate a square using `rectStroke`.","We'll use `polyStroke` for that:","XXpolyStroke(points, [rotate, [x, y]], color)"]},{text:["`polyStroke` draws a closed polygon as defined by an array of points.","Let me show you. I'll draw one square using `polyStroke`."],screen:"CODE",game:"SAME"},{text:["Note you don't need to go back to the start. `polyStroke` closes the polygon."],screen:"CODE",game:"draw = () => {\n  clear()\n  const topLeft = [36, 36]\n  const topRight = [91, 36]\n  const bottomRight = [91, 91]\n  const bottomLeft = [36, 91]\n  polyStroke([topLeft, topRight, bottomRight, bottomLeft], 0)\n}"},{text:["We can rotate a polygon using `polyStroke`.","Set the rotation angle (in degrees) after points.","For example, I'll rotate this rectangle by 5 degrees:"],screen:"CODE",game:"SAME"},{text:["You can also specify a rotation point. We won't go into that, but consult HELP for more information.","Back to our squares. Can you draw eight squares using `polyStroke`?"],linesToHighlight:"6-7",screen:"CODE",game:"REP6-6\n  const angle = 5\n  polyStroke([topLeft, topRight, bottomRight, bottomLeft], angle, 0)"},{text:["Looking good. But how do we make the squares spin?","This is where `update` comes in, another `game loop` function. SCRIPT-8 executes it before `draw`:","XXupdate(state, input, elapsed)"],screen:"CODE",game:"draw = () => {\n  clear()\n  range(8).forEach(i => {\n    const angle = 5\n    const halfSide = 8 * i / 2\n    const topLeft = [64 - halfSide, 64 - halfSide]\n    const topRight = [64 + halfSide, 64 - halfSide]\n    const bottomRight = [64 + halfSide, 64 + halfSide]\n    const bottomLeft = [64 - halfSide, 64 + halfSide]\n    const color = i % 7\n    polyStroke([topLeft, topRight, bottomRight, bottomLeft], angle, color)\n  })\n}"},{text:["`elapsed` is how many milliseconds passed since the last `update` call.","Ignore `input` for now. We'll talk about it in a future lesson.","Now, see that `state` parameter?","XXupdate(state, input, elapsed)"],linesToHighlight:"0-1",screen:"CODE",game:"REP0-0\nupdate = (state, input, elapsed) => {\n}\n\ndraw = () => {"},{text:["SCRIPT-8 is a state-based engine. You initialize the game's state in `init`.","Then, during every `update`, modify the state as needed.","And draw your game in `draw`, which receives one parameter, `state`."],linesToHighlight:"3-3",game:"REP3-3\ndraw = (state) => {"},{text:["That's the game loop! Nothing to it.","I've added `init`. It's empty now. What do we want to put in there?","How about our squares' rotation angle?"],linesToHighlight:"0-1",screen:"CODE",game:"REP0-0\ninit = state => {\n}\n\nupdate = (state, input, elapsed) => {"},{text:["Good idea.","We also need to update `draw`."],linesToHighlight:"1-1",screen:"CODE",game:"ADD1\n  state.angle = 5 // the rotation angle"},{text:["Notice how we're not declaring `angle` inside `draw`.","Instead, we'll get it from `state`."],linesToHighlight:"9-10",screen:"CODE",game:"REP9-10\n  const { angle } = state\n  range(8).forEach(i => {"},{text:["Ready for the final part?","We need to make them spin. Can you guess how to do that?","Hint: change the angle in `update`."],screen:"CODE",game:"SAME"},{text:["Ta-dah!","Isn't SCRIPT-8 fun?","See you in the next lesson."],linesToHighlight:"5-5",screen:"CODE",game:"ADD5\n  state.angle = state.angle + elapsed / 10"}]},{title:"Swirly squares",slides:[{text:["If you were here for the previous lesson, you'll remember we drew eight concentric squares.","And then we made them spin, for much excitement."]},{text:["Let's make them swirl instead. We'll also add a title to our cassette.","And we'll put it on the SHELF!"]},{text:["Before we get going: make sure to record any unsaved changes.","The lesson will insert a blank cassette.","Click NEXT when you're ready."],newGameOnNext:!0},{game:"",text:["Let's get started. Go to CODE. I'll load the squares for us."]},{text:["We need to give each square its own rotation angle.","For example, you could add 10 degrees per square, based on its position in the array.","Like so:"],screen:"CODE",game:"init = state => {\n  state.angle = 5 // the rotation angle\n}\n\nupdate = (state, input, elapsed) => {\n  state.angle = state.angle + elapsed / 10\n}\n\ndraw = (state) => {\n  clear()\n  const { angle } = state\n  range(8).forEach(i => {\n    const halfSide = 8 * i / 2\n    const topLeft = [64 - halfSide, 64 - halfSide]\n    const topRight = [64 + halfSide, 64 - halfSide]\n    const bottomRight = [64 + halfSide, 64 + halfSide]\n    const bottomLeft = [64 - halfSide, 64 + halfSide]\n    const color = i % 7\n    polyStroke([topLeft, topRight, bottomRight, bottomLeft], angle, color)\n  })\n}"},{text:["This looks good. But each square needs to have the rotation angle based on its position AND time.","Let's create a function that does this.","We'll call it `getRotation`."],linesToHighlight:"19-23",screen:"CODE",game:"REP18-18\n\n    // add 10 degrees to each successive square.\n    // e.g. the first square gets 0 new degrees, the second one gets 10,\n    // the third one gets 20, etc.\n    const customAngle = angle + i * 10\n    polyStroke([topLeft, topRight, bottomRight, bottomLeft], customAngle, color)"},{text:["We also need a way to keep track of total time passed.","Let's add that to `init`."],linesToHighlight:"4-8",screen:"CODE",game:"ADD3\n\n// given a number of milliseconds and square index,\n// returns the square's rotation\nconst getRotation = (milliseconds, i) => {\n  return milliseconds * i\n}"},{text:["And what good is this `totalElapsed` if we don't change it?","Do that in `update`:"],linesToHighlight:"1-1",screen:"CODE",game:"ADD1\n  state.totalElapsed = 0 // total time passed"},{text:["How should we store each square's rotation?","A good place to do this is your game's state.","Add a `rotations` array to `init`:"],linesToHighlight:"12-12",screen:"CODE",game:"ADD12\n  state.totalElapsed += elapsed"},{text:["And finally, update the `rotations` array in `update`:"],linesToHighlight:"2-2",screen:"CODE",game:"ADD2\n  state.rotations = [] // each rectangle's individual rotation"},{text:["OK. Now we get to draw our squares.","Use `rotations` in `draw`. Each `polyStroke` call should reference this array instead of `angle`."],linesToHighlight:"14-14",screen:"CODE",game:"REP14-14\n  state.rotations = range(8).map(i => getRotation(state.totalElapsed, i))"},{text:["WOW! That is a bit too fast.","Adjust the calculations in `getRotation`.","Divide by something, e.g. 50:"],linesToHighlight:"31-32",screen:"CODE",game:"REP31-31\n    const customAngle = state.rotations[i]"},{text:["Much better.","We should also get rid of `angle` in our state.","We don't need it anymore."],linesToHighlight:"9-9",screen:"CODE",game:"REP9-9\n  return milliseconds * i / 50"},{text:["Now, here's a neat trick.","Use a sine function in `getRotation`:"],linesToHighlight:"0-3",screen:"CODE",game:"DEL3"},{text:["This gives it more of an elastic swirly feel. Beautiful!","We need a title. Add it as the first line of your cassette.","I'll show you."],linesToHighlight:"8-8",screen:"CODE",game:"REP8-8\n  return Math.sin(milliseconds / 400) * 16 * (i + 1)"},{text:["Now try putting your cassette on the SHELF.","To do this, first record it by mousing over CASSETTE (on the top menu) and clicking RECORD.","Once that's done, mouse over CASSETTE and click PUT ON SHELF."],linesToHighlight:"0-0",screen:"CODE",game:"REP0-0\n// title: Swirly squares\n\ninit = state => {"},{text:["If everything went well (and why shouldn't it?) you'll see your cassette on the SHELF.","The SHELF is a good place to put your cassette for others to see.","Well, that's the end of this lesson. See you later!"]}]},{title:"Platformer pt. 1: basic movement",slides:[{text:["In previous lessons we've learned to draw text and make squares move.","Exciting, no doubt.","But you're here to make games!"]},{text:["It's about time we got to it.","In this lesson we'll learn how to make a little plumber move.","Now that is exciting."]},{text:["Before we get going: make sure to record any unsaved changes.","The lesson will insert a blank cassette.","Click NEXT when you're ready."],newGameOnNext:!0},{game:"",text:["First things first. Go to CODE.","Actually, no. Let's go to SPRITE instead (mouse over ART to find it).","We have to draw our plumber."],requirements:{screen:"SPRITE"}},{text:["To draw, click `+`, click a color, and then click (or drag) on the top-left grid.","To delete, click `-`, and then click (or drag) on the top-left grid.","Play for a bit, and then I'll draw something. Click NEXT."],sprites:[{index:0,array:["        ","        ","        ","        ","        ","        ","        ","        "]}]},{text:["Well isn't that cheerful.","You might have noticed 0-1-2-3 buttons under the `+` and `-`.","These are sprite flags. We'll discuss them in a future lesson."],screen:"SPRITE",sprites:[{index:0,array:["        ","  0  0  ","  0  0  ","        ","        ","0      0"," 0    0 ","  0000  "]}]},{text:["This smiley face is pleasant. But I promised a plumber.","Click NEXT."],sprites:[{index:0,array:["        ","  0  0  ","  0  0  ","        ","        ","0      0"," 0    0 ","  0000  "]}]},{text:["Doesn't he look familiar? We'll call him Mr. M.","By the way, these sprites are courtesy of <a class='text' href='https://twitter.com/johanvinet'>Johan Vinet</a>.","We also need something for Mr. M to stand on."],screen:"SPRITE",sprites:[{index:0,array:["   2220 ","   22222","  20270 ","  200220","   2000 "," 221331 ","0 333351","  2   3 "]}]},{text:["I'll draw a rock sprite."],sprites:[{index:32,array:["        ","        ","        ","        ","        ","        ","        ","        "]}]},{text:["Feel free to edit these.","When you're ready, go to MAP.","You'll find it by mousing over ART."],screen:"SPRITE",sprites:[{index:32,array:["22334334","24447445","34447447","34445447","35774334","23343445","34453447","47754777"]}]},{text:["To make a map, click a sprite, and then click (or drag) on the top-left grid.","Delete by first clicking on `-`, and then click (or drag) on the top-left grid.","Play for a bit. Then I'll try making a floor for our plumber."],screen:"MAP",map:[]},{text:["Good. Now Mr. M has something to walk on.","Alright. We're done with sprites and maps. Time to make him move.","Go to CODE."],screen:"MAP",map:["15-0-32","15-1-32","15-2-32","15-3-32","15-4-32","15-5-32","15-6-32","15-7-32","15-8-32","15-9-32","15-10-32","15-11-32","15-12-32","15-13-32","15-14-32","15-15-32"]},{text:["First, add a `draw` function. We covered this in previous lessons.","Don't remember? That's OK. I'll do it for you.","Click NEXT."],screen:"CODE",game:""},{text:["Now we need to draw the map. Remember, the one with the floor?","SCRIPT-8 has a function for this:","XXmap()"],screen:"CODE",game:"draw = state => {\n  clear()\n}"},{text:["`map` draws the map. Handy.","You can optionally pass it parameters, but we don't need that here.","Consult HELP for more information on `map` and other SCRIPT-8 functions."],screen:"CODE",game:"ADD2\n  map()"},{text:["Time to draw the plumber.","SCRIPT-8 has another function for this:","XXsprite(x, y, spriteIndex)"]},{text:["There is our plumber. But he's not in the right spot.","Can you make him stand on the floor?","Tip: the number slider might make this easier."],screen:"CODE",game:"ADD3\n  sprite(0, 0, 0)"},{text:["Good.","By the way, the third parameter in `sprite` is the sprite index.","Our plumber is the first sprite on the sprite list. Sprite 0."],screen:"CODE",game:"REP3\n  sprite(0, 112, 0)"},{text:["This is good progress.","But what is a platformer without movement?","We need to respond to input (e.g. pressing the right key) and update the sprite's position."],screen:"CODE",game:"REP3\n  sprite(0, 112, 0)"},{text:["In SCRIPT-8, the `update` function receives the current input.","Let's add that next."]},{text:["Time to add input-handling code.","If left is pressed, move the charac... wait a second.","The plumber is being drawn to (0, 112).","Shouldn't we fix that first?"],screen:"CODE",game:"REP0-0\nupdate = (state, input) => {\n\n}\n\ndraw = state => {"},{text:["Yes, we should. Let's add `init` so we can track the plumber's state there.","Like so:"]},{text:["And update `draw` so it uses state instead of the hardcoded numbers."],screen:"CODE",game:"REP0-0\ninit = state => {\n  state.x = 0\n  state.y = 112\n}\n\nupdate = (state, input) => {"},{text:["Now for the final part. In the `update` function, `input` is an object that contains various booleans indicating if keys are pressed.","For example, `input.left` will be true if the left key is pressed, etc.","Let's first add logic to handle left and right keys."],screen:"CODE",game:"REP12\n  sprite(state.x, state.y, 0)"},{text:["And now we can update state appropriately. If left is pressed, decrease x by 1.","And if right is pressed, well, you get the idea."],screen:"CODE",game:"REP6\n  if (input.left) {\n\n  }\n\n  if (input.right) {\n\n  }"},{text:["Click on the game (or click RUN if you can't see it).","And press the left or right keys.","The plumber moves!"],screen:"CODE",game:"REP6-12\n  if (input.left) {\n    state.x -= 1\n  }\n\n  if (input.right) {\n    state.x += 1\n  }"},{text:["One last thing.","Pressing left makes Mr. M move back, but he's facing forward.","That isn't right."]},{text:["Fortunately for us, `sprite` has three optional parameters:","XXsprite(x, y, spriteIndex, [brighten, flipH, flipV])","`brighten` brightens or darkens the sprite. `flipH` flips it horizontally. `flipV` flips it vertically."]},{text:["First, we should add `flipH` to `init`. We need to keep track of it somehow."],screen:"CODE"},{text:["Next, update the input-handling code.","If left is pressed, set flipH to true.","If right is pressed, set flipH to false."],screen:"CODE",game:"REP2\n  state.y = 112\n  state.flipH = false"},{text:["Finally, change the sprite call.","Remember to ignore `brighten` for now (the fourth parameter)."],screen:"CODE",game:"REP7-13\n  if (input.left) {\n    state.x -= 1\n    state.flipH = true\n  }\n\n  if (input.right) {\n    state.x += 1\n    state.flipH = false\n  }"},{text:["And there you have it. Our plumber faces the right direction.","Exciting!"],screen:"CODE",game:"REP21\n  sprite(state.x, state.y, 0, 0, state.flipH)"},{text:["This has been a long lesson, mostly because I like the sight of my own words.","But pause for a second and look at the amount of code required to make our plumber move.","Not that much."]},{text:["See you in the next lesson!"]}]},{title:"Platformer pt. 2: walking animation",slides:[{text:["In the previous lesson we drew Mr. M, our plumber.","A solid first platformer lesson.","Shall we do more?"]},{text:["Before we get going: make sure to record any unsaved changes.","The lesson will insert a blank cassette.","Click NEXT when you're ready."],newGameOnNext:!0},{game:"",text:["OK. As I was saying, we made Mr. M move.","He's a fast walker.","Very fast. I'll load up last lesson's code to explain."]},{text:["Click on the game in the preview window (or go to RUN if you can't see it).","And move a bit. Press left, then right.","Fast walker huh? He's so fast, his legs... don't move! They glide!"],screen:"CODE",map:["15-0-32","15-1-32","15-2-32","15-3-32","15-4-32","15-5-32","15-6-32","15-7-32","15-8-32","15-9-32","15-10-32","15-11-32","15-12-32","15-13-32","15-14-32","15-15-32"],sprites:[{index:0,array:["   2220 ","   22222","  20270 ","  200220","   2000 "," 221331 ","0 333351","  2   3 "]},{index:32,array:["22334334","24447445","34447447","34445447","35774334","23343445","34453447","47754777"]}],game:"init = state => {\n  state.x = 0\n  state.y = 112\n  state.flipH = false\n}\n\nupdate = (state, input) => {\n  if (input.left) {\n    state.x -= 1\n    state.flipH = true\n  }\n\n  if (input.right) {\n    state.x += 1\n    state.flipH = false\n  }\n}\n\ndraw = state => {\n  clear()\n  map()\n  sprite(state.x, state.y, 0, 0, state.flipH)\n}"},{text:["We're using the same sprite whether he's standing or walking.","That's a problem.","We need to draw a set of walking sprites."]},{screen:"SPRITE",text:["You can try for a bit. But I'll do it for us.","You knew that was coming, right?","Click NEXT."]},{text:["Here are our 6 walking sprites.","Beautiful.","By the way, these sprites are courtesy of <a class='text' href='https://twitter.com/johanvinet'>Johan Vinet</a>."],screen:"SPRITE",sprites:[{index:1,array:["   2220 ","   22222","  20270 ","  200220","   2000 ","  22135 ","  20335 ","   223  "]},{index:2,array:["   2222 ","   22222","  22027 ","  220022","   2200 ","  32215 ","  33220 ","  2  3  "]},{index:3,array:["   2222 ","   22222","  22027 ","  220022","   2200 ","  322150"," 233322 ","      3 "]},{index:4,array:["   2220 ","   22222","  20270 ","  200220","   2000 ","  22135 ","  20335 ","   223  "]},{index:5,array:["   2202 ","   22222","  02707 ","  002202","   0000 "," 221331 ","0 333351","  3  2  "]},{index:6,array:["   2202 ","   22222","  02707 ","  002202"," 220000 ","0 213310"," 333335 ","      2 "]}]},{text:["OK. We now have 1 standing sprite and 6 walking sprites.","We'll need to track what sprite to draw.","Let's add `sprite` to `init`."],screen:"CODE"},{text:["Good. And we might as well update our `draw` function.","Use `state.sprite` in the `sprite()` call."],linesToHighlight:"3-3",game:"ADD3\n  state.sprite = 0",screen:"CODE"},{text:["Now for the interesting part.","If we're pressing left or right we'll use the walking sprites."],linesToHighlight:"22-22",screen:"CODE",game:"REP22\n  sprite(state.x, state.y, state.sprite, 0, state.flipH)"},{text:["And if we're not pressing either left or right we'll use the standing sprite."],linesToHighlight:"18-20",screen:"CODE",game:"REP16\n  }\n\n  if (input.left || input.right) {\n    state.sprite = 1\n  }"},{text:["OK let's try it.","Click on the preview screen and move our plumber (or go to RUN).","Does it look right?"],linesToHighlight:"21-21",screen:"CODE",game:"REP20\n  } else {\n    state.sprite = 0\n  }"},{text:["That was a trick question. It doesn't look right.","Mr. M is still gliding because we are not cycling through the walking sprites."]},{text:["When he starts walking we should use sprite 1.","Then the next time we execute the `draw` function we should use sprite 2.","And so on until we reach the end of the walking sprites."]},{text:["At that point, if we're still walking, we'll go back to sprite 1.","And continue cycling through."]},{text:["I hope this makes sense to you.","OK then!","First we need to make an array of the walking sprites."]},{text:["Next add a `counter` to `init`."],screen:"CODE",linesToHighlight:"7-7",game:"REP5-7\n}\n\nconst walkCycle = [1, 2, 3, 4, 5, 6]\n\nupdate = (state, input) => {"},{text:["We'll increment this every time we're walking.","Watch line 24."],linesToHighlight:"4-4",screen:"CODE",game:"ADD4\n  state.counter = 0"},{text:["If we stop walking, we'll reset the counter to 0."],screen:"CODE",linesToHighlight:"23-23",game:"ADD23\n    state.counter++"},{text:["Finally, if we're walking, use the counter to set the sprite.","I'll do this in line 23.","Notice the use of modulus arithmetic."],linesToHighlight:"26-26",screen:"CODE",game:"ADD26\n    state.counter = 0"},{text:["Time to test it.","Click on the preview screen and make Mr. M move.","What do you think?"],linesToHighlight:"22-22",screen:"CODE",game:"REP22\n    state.sprite = walkCycle[state.counter % 6]"},{text:["It worked!","But... his legs are moving way too fast.","We're cycling through the walking sprites too fast."]},{text:["This is an easy fix.","Let's a create a `slowCounter`.","I'll put it right above the modulus arithmetic line."]},{text:["Next we'll use it in the line below."],linesToHighlight:"22-22",screen:"CODE",game:"ADD22\n    const slowCounter = state.counter"},{text:["And finally, time to slooow the counter.","Divide by something and make sure to round the number down.","We need `slowCounter` to stay an integer."],screen:"CODE",linesToHighlight:"23-23",game:"REP23\n    state.sprite = walkCycle[slowCounter % 6]"},{text:["Try it.","Not bad!"],linesToHighlight:"22-22",screen:"CODE",game:"REP22\n    const slowCounter = Math.floor(state.counter / 5)"},{text:["There you have it, a walking animation.","It wouldn't do to have a gliding plumber. Nope.","See you next time!"]}]},{title:"Platformer pt. 3: jumping (coming soon)",slides:[{text:["Coming soon."]}]},{title:"Platformer pt. 4: wall collisions (coming soon)",slides:[{text:["Coming soon."]}]},{title:"Platformer pt. 5: camera (coming soon)",slides:[{text:["Coming soon."]}]}]},292:function(e,t,n){},293:function(e,t,n){"use strict";n.r(t);for(var a,r,i=n(0),o=n.n(i),s=n(105),l=n(12),c=n(8),u=n(11),h=n(10),d=n(7),m=n(9),p=n(3),f=n(33),g=n.n(f),b=n(5),E=n.n(b),v=n(1),y=n.n(v),O={BOOT:"BOOT",HOME:"HOME",RUN:"RUN",HELP:"HELP",CODE:"CODE",SPRITE:"SPRITE",MAP:"MAP",SONG:"SONG",CHAIN:"CHAIN",PHRASE:"PHRASE",SHELF:"SHELF"},S=[O.HOME,O.CODE,O.SPRITE,O.MAP,O.PHRASE,O.CHAIN,O.SONG,O.HELP,O.SHELF,O.RUN],C=function(e){var t=S.indexOf(e);return S[(t+1)%S.length]},w=function(e){var t=S.indexOf(e);return S[(t-1+S.length)%S.length]},k=O,x=n(294),T=n(61),j=n.n(T),N={TOGGLE_MENU:"TOGGLE_MENU",UPDATE_IFRAME_VERSION:"UPDATE_IFRAME_VERSION",SET_ERROR_LINE:"SET_ERROR_LINE",CLEAR_TOKEN:"CLEAR_TOKEN",SELECT_UI:"SELECT_UI",TOGGLE_SOUND:"TOGGLE_SOUND",DISMISS_NOTICES:"DISMISS_NOTICES",SET_SCREEN:"SET_SCREEN",FETCH_GIST_REQUEST:"FETCH_GIST_REQUEST",FETCH_GIST_SUCCESS:"FETCH_GIST_SUCCESS",FINISH_BOOT:"FINISH_BOOT",UPDATE_GAME:"UPDATE_GAME",NEW_GAME:"NEW_GAME",TOKEN_REQUEST:"TOKEN_REQUEST",TOKEN_SUCCESS:"TOKEN_SUCCESS",SET_NEXT_ACTION:"SET_NEXT_ACTION",CLEAR_NEXT_ACTION:"CLEAR_NEXT_ACTION",SAVE_GIST_REQUEST:"SAVE_GIST_REQUEST",SAVE_GIST_SUCCESS:"SAVE_GIST_SUCCESS",UPDATE_SFX:"UPDATE_SFX",UPDATE_SPRITE:"UPDATE_SPRITE",UPDATE_MAP:"UPDATE_MAP",UPDATE_PHRASE:"UPDATE_PHRASE",UPDATE_CHAIN:"UPDATE_CHAIN",UPDATE_SONG:"UPDATE_SONG",SET_TUTORIAL_SLIDE:"SET_TUTORIAL_SLIDE",CLOSE_TUTORIAL:"CLOSE_TUTORIAL",SHELVE_CASSETTE_REQUEST:"SHELVE_CASSETTE_REQUEST",SHELVE_CASSETTE_SUCCESS:"SHELVE_CASSETTE_SUCCESS",UNSHELVE_CASSETTE_REQUEST:"UNSHELVE_CASSETTE_REQUEST",UNSHELVE_CASSETTE_SUCCESS:"UNSHELVE_CASSETTE_SUCCESS",SET_VISIBILITY_REQUEST:"SET_VISIBILITY_REQUEST",SET_VISIBILITY_SUCCESS:"SET_VISIBILITY_SUCCESS",COUNTER_CASSETTE_REQUEST:"COUNTER_CASSETTE_REQUEST",COUNTER_CASSETTE_SUCCESS:"COUNTER_CASSETTE_SUCCESS",SET_SCROLL_DATA:"SET_SCROLL_DATA",SET_CODE_TAB:"SET_CODE_TAB",UPDATE_HISTORY:"UPDATE_HISTORY",SET_CALL_UNDER_MOUSE:"SET_CALL_UNDER_MOUSE",CLEAR_CALL_UNDER_MOUSE:"CLEAR_CALL_UNDER_MOUSE"},I=n(26),A=n.n(I),R="init = state => {\n}\n\nupdate = (state, input, elapsed) => {\n}\n\ndraw = state => {\n}",M=n(20),D={hideMenu:!1,iframeVersion:M.a,errorLine:null,screen:k.BOOT,booted:!1,gist:{},game:{0:{text:R,active:!0,key:0}},token:{},nextAction:null,sprites:{},map:[],phrases:{},chains:{},songs:{},docHistories:{},dismissedNotices:[],selectedUi:{phrase:0,chain:0,song:0},tutorial:null,sound:!0,shelving:!1},P=["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"],U=function(e,t,n){var a=function(e){return P[e%P.length]}(e),r=function(e){return Math.floor(e/P.length)}(e)+(n?2:0);return t?"".concat(a).concat(r):a},L=function(e){return y.a.mapValues(e,function(e){return{notes:y.a.map(e.notes,function(e,t){return[t,U(e.note),e.octave,e.volume].join("")}),tempo:y.a.isNil(e.tempo)?0:e.tempo,synth:y.a.isNil(e.synth)?0:e.synth}})},_=function(e){return t=JSON.parse(y.a.get(e,'files["phrases.json"].content',JSON.stringify(D.phrases,null,2))),A()(y.a.mapValues(t,function(e){var t=Array.isArray(e),n=y()(t?e:e.notes).map(function(e){return e.match(/^(\d+)([a-g]#?)(-?\d)(\d)/).slice(1,5)}).map(function(e){return{index:e[0],note:(t=e[1],P.indexOf(t)),octave:+e[2],volume:+e[3]};var t}).keyBy("index").mapValues(function(e){return y.a.omit(e,"index")}).value();return y.a.isEmpty(n)?null:{notes:n,tempo:t?0:y.a.isNil(e.tempo)?0:e.tempo,synth:t?0:y.a.isNil(e.synth)?0:e.synth}}));var t},H=function(e){var t=e.error,n=e.message;throw t.message=[t.message,n].join(". "),new Error(t)},F=n(4),G=n(295),B=n(13),V=function(e){return e.length||e.push(0),e.reduce(function(e,t,n){if(n>0){var a=e[n-1];return[].concat(Object(B.a)(e),[[a[1],a[1]+t]])}return[[0,t]]},[])},W=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return y()(e).orderBy(function(e,t){return t}).map(function(e){return function(e,t){if(e.callUnderMouse&&e.text&&t){var n=e.callUnderMouse,a=e.text.slice(0,n.start),r=e.text.slice(n.start,n.end),i=e.text.slice(n.end);return"".concat(a,"_script8.injectHighlight(() => ").concat(r,")").concat(i)}return e.text}(e,t)}).filter(function(e){return!y.a.isEmpty(e)}).value().join("\n")},q=function(e){var t=JSON.parse(y.a.get(e,'files["misc.json"].content',"{}")),n=y.a.get(e,'files["code.js"].content',"");if(t.lines){var a=V(t.lines),r=n.split("\n");return a.reduce(function(e,t,n){return Object(F.a)({},e,Object(p.a)({},n,{text:r.slice.apply(r,Object(B.a)(t)).join("\n"),active:0===n,key:n}))},{})}return{0:{text:n,active:!0,key:0}}},X=function(e){return y.a.range(8).map(function(t){return e[t]&&e[t].text?e[t].text.split("\n").length:0})},J=function(e){return Object(F.a)({},e[Object.keys(e).filter(function(t){return e[t].active})],{key:Object.keys(e).filter(function(t){return e[t].active})[0]})},Y=Object(G.a)((a={},Object(p.a)(a,N.NEW_GAME,function(e,t){return t.payload===k.CODE?{0:{text:"SCRIPT-8 NEW",active:!0,key:0}}:{0:{text:R,active:!0,key:0}}}),Object(p.a)(a,N.SET_CODE_TAB,function(e,t){var n=t.payload;return y.a.mapValues(Object(F.a)({},e,Object(p.a)({},n,Object(F.a)({},e[n],{key:n,active:!0}))),function(e,t){return Object(F.a)({},e,{active:t===n.toString()})})}),Object(p.a)(a,N.UPDATE_GAME,function(e,t){var n=t.payload;return Object(F.a)({},e,Object(p.a)({},n.tab,Object(F.a)({},e[n.tab],{text:n.content})))}),Object(p.a)(a,N.SET_SCROLL_DATA,function(e,t){var n=t.payload;return Object(F.a)({},e,Object(p.a)({},n.tab,Object(F.a)({},e[n.tab],{scrollData:n.scrollData})))}),Object(p.a)(a,N.FETCH_GIST_SUCCESS,function(e,t){return q(t.payload)}),Object(p.a)(a,N.SET_CALL_UNDER_MOUSE,function(e,t){var n=t.payload;return Object(F.a)({},e,Object(p.a)({},n.tab,Object(F.a)({},e[n.tab],{callUnderMouse:n.callUnderMouse})))}),Object(p.a)(a,N.CLEAR_CALL_UNDER_MOUSE,function(e,t){var n=t.payload;return Object(F.a)({},e,Object(p.a)({},n.tab,Object(F.a)({},e[n.tab],{callUnderMouse:null})))}),a),D.game),z=Object(x.a)((r={},Object(p.a)(r,N.TOGGLE_MENU,function(){}),Object(p.a)(r,N.UPDATE_IFRAME_VERSION,function(){}),Object(p.a)(r,N.SET_ERROR_LINE,function(e){return e}),Object(p.a)(r,N.CLEAR_TOKEN,function(){}),Object(p.a)(r,N.SELECT_UI,function(e){return e}),Object(p.a)(r,N.DISMISS_NOTICES,function(e){return e}),Object(p.a)(r,N.TOGGLE_SOUND,function(){}),Object(p.a)(r,N.SET_SCREEN,function(e){return e}),Object(p.a)(r,N.FETCH_GIST_REQUEST,function(){}),Object(p.a)(r,N.FETCH_GIST_SUCCESS,function(e){return e}),Object(p.a)(r,N.FINISH_BOOT,function(){}),Object(p.a)(r,N.UPDATE_GAME,function(e){return e}),Object(p.a)(r,N.NEW_GAME,function(e){return e}),Object(p.a)(r,N.TOKEN_REQUEST,function(){}),Object(p.a)(r,N.TOKEN_SUCCESS,function(e){return e}),Object(p.a)(r,N.SET_NEXT_ACTION,function(e){return e}),Object(p.a)(r,N.CLEAR_NEXT_ACTION,function(){}),Object(p.a)(r,N.SAVE_GIST_REQUEST,function(){}),Object(p.a)(r,N.SAVE_GIST_SUCCESS,function(e){return e}),Object(p.a)(r,N.UPDATE_SFX,function(e){return e}),Object(p.a)(r,N.UPDATE_SPRITE,function(e){return e}),Object(p.a)(r,N.UPDATE_MAP,function(e){return e}),Object(p.a)(r,N.UPDATE_PHRASE,function(e){return e}),Object(p.a)(r,N.UPDATE_CHAIN,function(e){return e}),Object(p.a)(r,N.UPDATE_SONG,function(e){return e}),Object(p.a)(r,N.IS_NEW_USER,function(){}),Object(p.a)(r,N.SET_TUTORIAL_SLIDE,function(e){return e}),Object(p.a)(r,N.CLOSE_TUTORIAL,function(){}),Object(p.a)(r,N.SHELVE_CASSETTE_REQUEST,function(){}),Object(p.a)(r,N.SHELVE_CASSETTE_SUCCESS,function(e){return e}),Object(p.a)(r,N.UNSHELVE_CASSETTE_REQUEST,function(){}),Object(p.a)(r,N.UNSHELVE_CASSETTE_SUCCESS,function(e){return e}),Object(p.a)(r,N.SET_VISIBILITY_REQUEST,function(e){return e}),Object(p.a)(r,N.SET_VISIBILITY_SUCCESS,function(e){return e}),Object(p.a)(r,N.COUNTER_CASSETTE_REQUEST,function(){}),Object(p.a)(r,N.COUNTER_CASSETTE_SUCCESS,function(e){return e}),Object(p.a)(r,N.SET_SCROLL_DATA,function(e){return e}),Object(p.a)(r,N.SET_CODE_TAB,function(e){return e}),Object(p.a)(r,N.UPDATE_HISTORY,function(e){return e}),Object(p.a)(r,N.SET_CALL_UNDER_MOUSE,function(e){return e}),Object(p.a)(r,N.CLEAR_CALL_UNDER_MOUSE,function(e){return e}),r)),K=z,Q=function(e){var t=e.iframeVersion,n=e.toFork,a=e.game,r=e.token,i=e.gist,o=e.sprites,s=e.map,l=e.phrases,c=e.chains,u=e.songs;return function(e){e(z.saveGistRequest());var h=new j.a({token:r.value}),d=function(e){var n=function(e){return e?" Click [here](https://script-8.github.io/?id=".concat(e,") to boot it."):""}(e),r="This is a [SCRIPT-8](https://script-8.github.io) cassette.".concat(n),h={iframeVersion:t},d={public:!0,description:"SCRIPT-8",files:{"sprites.json":{content:JSON.stringify(o,null,2)},"map.json":{content:JSON.stringify(s,null,2)},"phrases.json":{content:JSON.stringify(L(l),null,2)},"chains.json":{content:JSON.stringify(c,null,2)},"songs.json":{content:JSON.stringify(u,null,2)},"README.md":{content:r}}},m=q(i.data),p=W(m),f=W(a);return f.length?(d.files["code.js"]={content:f},h.lines=X(a)):p.length&&(d.files["code.js"]=null),d.files["misc.json"]={content:JSON.stringify(h,null,2)},d},m=function(){return h.getGist().create(d()).then(function(e){return e.data},function(e){return H({error:e,message:"Could not create gist."})}).then(function(t){return e(z.saveGistSuccess(t))})};return i.data?n?y.a.get(i,"data.owner.login",null)===r.user.login?m():h.getGist(i.data.id).fork().then(function(e){return e.data.id}).then(function(e){return h.getGist(e).read()}).then(function(e){return e.data}).then(function(t){return e(z.saveGistSuccess(t))}).catch(function(e){return H({error:e,message:"Could not fork gist ".concat(i.data.id," from the hosted oauth service.")})}):y.a.get(i,"data.owner.login",null)===r.user.login?h.getGist(i.data.id).update(d(i.data.id)).then(function(e){return e.data},function(e){return H({error:e,message:"Could not update gist."})}).then(function(t){return e(z.saveGistSuccess(t))}):m():m()}},Z=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.fetchGist,n=e.token,a=e.setScreen,r=window.location.search,i=new window.URLSearchParams(r),o=i.get("id"),s=i.get("shelf");o?t({id:o,token:n}):a(s?k.SHELF:k.HOME)}},{key:"componentDidUpdate",value:function(){var e=this.props,t=e.gist,n=e.setScreen,a=e.booted,r=e.counterCassette,i=e.token;!t.isFetching&&t.data&&a&&(n(k.RUN),y.a.get(i,"user.login",null)!==y.a.get(t,"data.owner.login",null)&&r(t.data.id))}},{key:"render",value:function(){return o.a.createElement("div",{className:"Boot"})}}]),t}(i.Component),$=Object(l.b)(function(e){return{gist:e.gist,booted:e.booted,token:e.token}},function(e){return{setScreen:function(t){return e(K.setScreen(t))},counterCassette:function(t){return e(function(e){var t=e.id;return function(e){return e(z.counterCassetteRequest()),window.fetch("".concat("https://script-8-api-l55chnkhk.now.sh","/counter/").concat(t)).then(function(e){return e.json()}).then(function(t){return e(z.counterCassetteSuccess(t))}).catch(function(e){return H({error:e,message:"Could not increase counter from the hosted oauth service."})})}}({id:t}))},fetchGist:function(t){var n=t.id,a=t.token;return e(function(e){var t=e.id,n=e.token;return function(e){return e(z.fetchGistRequest()),n&&n.value?new j.a({token:n.value}).getGist(t).read().then(function(e){return e.data},function(e){return H({error:e,message:"Could not fetch gist ".concat(t," from GitHub while using an oauth token.")})}).then(function(t){return e(z.fetchGistSuccess(t))}):window.fetch("".concat("https://script-8-api-l55chnkhk.now.sh","/gist/").concat(t)).then(function(e){return e.json()}).then(function(t){return e(z.fetchGistSuccess(t))}).catch(function(e){return H({error:e,message:"Could not fetch gist ".concat(t," from the hosted oauth service.")})})}}({id:n,token:a}))}}})(Z),ee=n(2),te=n(109),ne=n.n(te),ae=n(110),re=n(111),ie=n.n(re),oe=n(112),se=n.n(oe),le=n(113),ce=n.n(le),ue=n(114),he=n.n(ue),de=n(115),me=n.n(de),pe=n(116),fe=n.n(pe),ge=n(117),be=n.n(ge),Ee=n(118),ve=n.n(Ee),ye=n(119),Oe=n.n(ye),Se=n(120),Ce=n.n(Se),we=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleStartTutorial=n.handleStartTutorial.bind(Object(ee.a)(Object(ee.a)(n))),n.handleSeeLessons=n.handleSeeLessons.bind(Object(ee.a)(Object(ee.a)(n))),n.handleClickGifs=n.handleClickGifs.bind(Object(ee.a)(Object(ee.a)(n))),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleStartTutorial",value:function(){this.props.startTutorial()}},{key:"handleSeeLessons",value:function(){this.props.setScreen(k.HELP)}},{key:"handleClickGifs",value:function(){this.props.setScreen(k.SHELF)}},{key:"render",value:function(){return o.a.createElement("div",{className:"Home"},o.a.createElement("div",{className:"main"},o.a.createElement("img",{className:"logo",src:ne.a,alt:"SCRIPT-8 logo"}),o.a.createElement("p",{className:"last-updated"},o.a.createElement("span",null,"updated ",ae.a),o.a.createElement("span",null,"v",M.a)),o.a.createElement("p",null,"SCRIPT-8 is a fantasy computer for making, sharing, and playing tiny retro-looking games (called cassettes). It's free, browser-based, and"," ",o.a.createElement("a",{className:"text",href:"https://github.com/script-8/script-8.github.io"},"open-source"),". Cassettes are written in JavaScript."),o.a.createElement("p",{className:"gifs"},o.a.createElement("button",{onClick:this.handleClickGifs},o.a.createElement("img",{className:"gif",src:ie.a,alt:"Los hermanos bros"})),o.a.createElement("button",{onClick:this.handleClickGifs},o.a.createElement("img",{className:"gif",src:se.a,alt:"break-8 game"})),o.a.createElement("button",{onClick:this.handleClickGifs},o.a.createElement("img",{className:"gif",src:ce.a,alt:"the plumber"}))),o.a.createElement("p",{className:"start"},o.a.createElement("button",{className:E()("button",{invisible:this.props.tutorial}),onClick:this.handleStartTutorial},"> New? Start here"),o.a.createElement("button",{className:E()("button",{invisible:this.props.tutorial}),onClick:this.handleSeeLessons},"> See lessons")),o.a.createElement("p",null,'SCRIPT-8 is designed to encourage play \u2014 the kind of wonder-filled play children experience as they explore and learn about the world. In order to support this goal, everything in SCRIPT-8 has immediate feedback. It is what some call a "livecoding" environment.'),o.a.createElement("p",null,"It features:"),o.a.createElement("ul",null,o.a.createElement("li",null,"a code editor where the game changes as you type.",o.a.createElement("img",{className:"gif wide",src:he.a,alt:"livecoding"})),o.a.createElement("li",null,"a slider to help you tweak numbers without typing.",o.a.createElement("img",{className:"gif wide",src:me.a,alt:"slider"})),o.a.createElement("li",null,o.a.createElement("span",null,"a time-traveling tool so you can pause and rewind."),o.a.createElement("img",{className:"gif wide single",src:fe.a,alt:"pause and rewind"})),o.a.createElement("li",null,o.a.createElement("span",null,"buttons that show a character's past and future paths."),o.a.createElement("img",{className:"gif wide single",src:be.a,alt:"toggle"})),o.a.createElement("li",null,"the ability to combine all the above so you can manipulate time.",o.a.createElement("iframe",{title:"Demonstration of SCRIPT-8's time-traveling tool",width:"560",height:"315",src:"https://www.youtube.com/embed/0rg5GGFaIY0",frameBorder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})," "),o.a.createElement("li",null,o.a.createElement("span",null,"a sprite editor where the game instantly displays your edits."),o.a.createElement("img",{className:"gif wide single",src:ve.a,alt:"sprite demo"})),o.a.createElement("li",null,o.a.createElement("span",null,"a map editor where changes alter the game's behavior, in real-time."),o.a.createElement("img",{className:"gif wide single",src:Oe.a,alt:"map demo"})),o.a.createElement("li",null,o.a.createElement("span",null,"a music editor where you create phrases, group them into chains, and turn those into songs."),o.a.createElement("img",{className:"gif wide single",src:Ce.a,alt:"music demo"}))),o.a.createElement("p",null,"Each cassette is recorded to a URL you can share with anyone."),o.a.createElement("p",null,"Play cassettes with a keyboard or gamepad."),o.a.createElement("p",null,"You can inspect any cassette's contents (even if it's not yours), change the code, art, or music, and record it to a different cassette \u2014 a new version."),o.a.createElement("p",null,"SCRIPT-8 is heavily influenced by Bret Victor's ideas (specifically"," ",o.a.createElement("a",{className:"text",href:"http://vimeo.com/36579366"},"Inventing on principle")," ","and"," ",o.a.createElement("a",{className:"text",href:"http://worrydream.com/LearnableProgramming/"},"Learnable programming"),") and Joseph White's"," ",o.a.createElement("a",{className:"text",href:"https://www.lexaloffle.com/pico-8.php"},"PICO-8"),", the best of all fantasy consoles."),o.a.createElement("p",null,"SCRIPT-8 is written by Gabriel Florit (that's me!) and"," ",o.a.createElement("a",{className:"text",href:"https://github.com/script-8/script-8.github.io/graphs/contributors"},"dedicated contributors"),". Click"," ",o.a.createElement("a",{className:"text",href:"https://twitter.com/gabrielflorit"},"here")," ","to follow me on twitter. And visit the Github repository"," ",o.a.createElement("a",{className:"text",href:"https://github.com/script-8/script-8.github.io"},"here"),", where you can keep up with new features and the occasional bug fix."),o.a.createElement("p",null,"If you have any questions, come join us on the"," ",o.a.createElement("a",{className:"text",href:"https://discord.gg/HA68FNX"},"Fantasy Consoles Discord server"),", a friendly place to chat about these sophisticated, cutting-edge computers. The server has a dedicated SCRIPT-8 room."),o.a.createElement("p",null,"SCRIPT-8 nyx8 palette by"," ",o.a.createElement("a",{className:"text",href:"https://twitter.com/Xavier_Gd"},"Javier Guerrero"),". Sprites in"," ",o.a.createElement("a",{className:"text",href:"https://script-8.github.io/?id=cd8d6811adb3afb472aaf7505729cf01"},"Los Hermanos Bros.")," ","by"," ",o.a.createElement("a",{className:"text",href:"https://twitter.com/johanvinet"},"Johan Vinet"),".")))}}]),t}(i.Component),ke=Object(l.b)(function(e){return{tutorial:e.tutorial}},function(e){return{setScreen:function(t){return e(K.setScreen(t))},startTutorial:function(){return e(K.setTutorialSlide({lessonIndex:0,slideIndex:0}))}}})(we),xe=n(41),Te="\n\nconst modes = ['glitch', 'numbers', 'pre-ram', 'ram', 'run', 'end']\n\nconst size = range(128)\nconst d = 1\n\nconst rects = flatten(size.map(x => size.map(y => [x, y, d, 128])))\n\nconst biosLines = range(18).map(() => {\n  return (\n    '  ' +\n    range(4)\n      .map(() => random(1000, 9999))\n      .join('      ')\n  )\n})\n\nif (typeof(initialState) !== 'undefined') {\n  initialState = {\n    counter: 0,\n    totalElapsed: 0,\n    modeIndex: 0,\n    hasStarted: false\n  }\n}\n\ninit = state => {\n  state.counter = 0\n  state.totalElapsed = 0\n  state.modeIndex = 0\n  state.hasStarted = false\n}\n\nupdate = (state, input, elapsed) => {\n  if (!state.hasStarted) {\n    state.hasStarted = true\n  }\n\n  const mode = modes[state.modeIndex]\n\n  state.counter++\n  state.totalElapsed += elapsed\n\n  if (mode === 'glitch' && state.totalElapsed > 500) {\n    state.modeIndex++\n    state.totalElapsed = 0\n  } else if (mode === 'numbers' && state.totalElapsed > 100) {\n    state.modeIndex++\n    state.totalElapsed = 0\n  } else if (mode === 'pre-ram' && state.totalElapsed > 100) {\n    state.modeIndex++\n    state.totalElapsed = 0\n    state.counter = 0\n  } else if (mode === 'ram' && state.counter > 64 && _script8.end) {\n    // The _script8.end function is not defined until we're done fetching the gist.\n    state.modeIndex++\n    state.totalElapsed = 0\n    state.counter++\n  } else if (mode === 'run') {\n    if (input.__mousedown) {\n      ".concat("init = state => {\n}\n\nupdate = (state, input, elapsed) => {\n}\n\ndrawActors = (state, fade) =>\n  state.actors && state.actors.forEach(actor =>\n    sprite(\n      actor.x,\n      actor.y,\n      actor.sprite,\n      fade ? actor.trailBrighten || -3 : actor.brighten,\n      actor.flipH,\n      actor.flipV\n    )\n  )\n\ndraw = state => {\n  camera()\n  clear()\n}","\n      _script8.end()\n    }\n  }\n}\n\ndraw = state => {\n  const { modeIndex, counter } = state\n  const mode = modes[modeIndex]\n\n  if (mode === 'glitch') {\n    rects.forEach(rect => {\n      rectFill(...rect, rect[0] + (rect[1] * counter) / 100)\n    })\n  }\n\n  if (mode === 'numbers') {\n    const factor = 4\n    if (counter % factor === 0) {\n      rectFill(0, 0, 128, 128, 7)\n      biosLines.forEach((line, j) => {\n        print(0, 128 + 7 * j - (7 * counter) / factor, line, 5)\n      })\n    }\n  }\n\n  if (mode === 'pre-ram') {\n    rectFill(0, 0, 128, 128, 7)\n  }\n\n  if (mode === 'ram') {\n    rectFill(0, 0, 128, 128, 6)\n    print(7, 7 * 1, 'script-8', 0)\n    print(7, 7 * 3, 'bios (c) 1980 pantron inc.', 3)\n    print(7, 7 * 4, 'version ").concat(M.a,"', 3)\n    print(7, 7 * 6, 'RAM: ' + Math.min(state.counter, 32) + ' kb', 3)\n\n    print(\n      7,\n      7 * 9,\n      'booting cassette ' +\n        (Math.floor(state.counter / 20) % 2 === 0 ? '' : '+'),\n      3\n    )\n\n    rectFill(48 + 3 * 0, 7, 3, 5, 0)\n    rectFill(48 + 3 * 1, 7, 3, 5, 1)\n    rectFill(48 + 3 * 2, 7, 3, 5, 2)\n    rectFill(48 + 3 * 3, 7, 3, 5, 3)\n    rectFill(48 + 3 * 4, 7, 3, 5, 4)\n    rectFill(48 + 3 * 5, 7, 3, 5, 5)\n    rectFill(48 + 3 * 6, 7, 3, 5, 4)\n    rectFill(48 + 3 * 7, 7, 3, 5, 3)\n    rectFill(48 + 3 * 8, 7, 3, 5, 2)\n    rectFill(48 + 3 * 9, 7, 3, 5, 1)\n    rectFill(48 + 3 * 10, 7, 3, 5, 0)\n  }\n\n  if (mode === 'run') {\n    rectFill(0, 0, 128, 128, 6)\n    print(7, 7 * 1, 'script-8', 0)\n    print(7, 7 * 3, 'bios (c) 1980 pantron inc.', 3)\n    print(7, 7 * 4, 'version ").concat(M.a,"', 3)\n    print(7, 7 * 6, 'RAM: ' + Math.min(state.counter, 32) + ' kb', 3)\n\n    print(7, 7 * 9, 'booting cassette done. ', 3)\n\n    rectFill(48 + 3 * 0, 7, 3, 5, 0)\n    rectFill(48 + 3 * 1, 7, 3, 5, 1)\n    rectFill(48 + 3 * 2, 7, 3, 5, 2)\n    rectFill(48 + 3 * 3, 7, 3, 5, 3)\n    rectFill(48 + 3 * 4, 7, 3, 5, 4)\n    rectFill(48 + 3 * 5, 7, 3, 5, 5)\n    rectFill(48 + 3 * 6, 7, 3, 5, 4)\n    rectFill(48 + 3 * 7, 7, 3, 5, 3)\n    rectFill(48 + 3 * 8, 7, 3, 5, 2)\n    rectFill(48 + 3 * 9, 7, 3, 5, 1)\n    rectFill(48 + 3 * 10, 7, 3, 5, 0)\n    print(7, 7 * 11, '> click to run', 3)\n    rectFill(7, 7 * 12, 4, 5, Math.floor(state.counter / 25) % 2 ? 0 : 6)\n  }\n}\n\n"),je=n(16),Ne=n.n(je),Ie=function(e){return JSON.parse(y.a.get(e,'files["map.json"].content',JSON.stringify(D.map,null,2)))},Ae=function(e){return JSON.parse(y.a.get(e,'files["sprites.json"].content',JSON.stringify(D.sprites,null,2)))},Re=function(e){return JSON.parse(y.a.get(e,'files["chains.json"].content',JSON.stringify(D.chains,null,2)))},Me=function(e){return JSON.parse(y.a.get(e,'files["songs.json"].content',JSON.stringify(D.songs,null,2)))},De=function(e){return e?y.a.get(JSON.parse(y.a.get(e,'files["misc.json"].content',"{}")),"iframeVersion","0.1.247"):D.iframeVersion},Pe=function(e){var t=e.gist,n=e.game,a=e.sprites,r=e.map,i=e.phrases,o=e.chains,s=e.songs,l=e.iframeVersion,c=W(q(t.data)),u=W(n),h=!1;h=""===c?!Ne()(R,u):!Ne()(c,u);var d=!Ne()(Ie(t.data),r),m=!Ne()(Ae(t.data),a),p=!Ne()(_(t.data),i),f=!Ne()(Re(t.data),o),g=!Ne()(Me(t.data),s),b=!Ne()(De(t.data),l);return h||d||m||p||f||g||b},Ue=function(e){var t=e.gist,n=e.token,a=e.game,r=e.sprites,i=e.map,o=e.phrases,s=e.chains,l=e.songs,c=e.iframeVersion,u=Pe({gist:t,game:a,sprites:r,map:i,phrases:o,chains:s,songs:l,iframeVersion:c}),h=y.a.get(t,"data.owner.login",null),d=y.a.get(n,"user.login",null);return d&&d===h&&u||y.a.isEmpty(t)},Le=n(17),_e=n.n(Le),He=n(32),Fe=n(129),Ge=n(59),Be={ecmaVersion:9,sourceType:"script",locations:!0},Ve=function(e){function t(e){var n,a=e.loc,r=e.raisedAt,i=e.message;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,i))).name="InvalidTokenError",n.loc=a,n.raisedAt=r,n}return Object(m.a)(t,e),t}(Object(Fe.a)(Error)),We=function(e){return new Promise(function(t){var n=new window.MessageChannel,a={type:"findInvalidToken",tokens:e.map(function(e){return e.name})};document.querySelector("iframe").contentWindow.postMessage(a,"*",[n.port2]),n.port1.onmessage=function(n){t(e[n.data])}})},qe=function(){var e=Object(He.a)(_e.a.mark(function e(t){var n,a,r,i,o,s;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.text,a=[],e.prev=2,r=xe.a(n,Be),i=[],Ge.a(r,{Identifier:function(e){i.push(e)}}),e.next=8,We(i);case 8:if(!(o=e.sent)){e.next=12;break}throw s={loc:o.loc.start,raisedAt:o.end,message:"".concat(o.name," is not allowed in SCRIPT-8.")},new Ve(s);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),a.push({from:{line:e.t0.loc.line-1,ch:e.t0.loc.column},to:{line:e.t0.loc.line-1,ch:e.t0.raisedAt},message:e.t0.message.replace(/ \(\d+:\d+\)$/,""),severity:"error"});case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}},e,null,[[2,14]])}));return function(t){return e.apply(this,arguments)}}(),Xe=function(){window.CodeMirror.registerHelper("lint","javascript",function(e){return qe({text:e})})},Je=function(e){var t=e[0].text.split("\n")[0].match(/\/\/\s*title:\s*(\S.*)/);return t?t[1].trim().toUpperCase():null},Ye=function(e){var t=e.game,n=e.gameLine,a=X(t),r=V(a),i=r.findIndex(function(e){return e[1]>n});return i>-1?{tab:i,tabLine:n-r[i][0]}:null},ze=y.a.throttle(function(e){var t=W(e);try{return function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}(Object(B.a)(Object(xe.b)(t)).length)}catch(n){return"ERROR"}},1e3),Ke=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleToggleMenuClick=n.handleToggleMenuClick.bind(Object(ee.a)(Object(ee.a)(n))),n.evaluate=n.evaluate.bind(Object(ee.a)(Object(ee.a)(n))),n.handleClickSize=n.handleClickSize.bind(Object(ee.a)(Object(ee.a)(n))),n.handleClickError=n.handleClickError.bind(Object(ee.a)(Object(ee.a)(n))),n.resize=y.a.debounce(n.resize.bind(Object(ee.a)(Object(ee.a)(n))),100),n.handleBlur=n.handleBlur.bind(Object(ee.a)(Object(ee.a)(n))),window.addEventListener("resize",n.resize),n.state={showSize:!1,errors:[],logs:[]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"noop",value:function(){}},{key:"resize",value:function(){this.isLoaded&&this.evaluate()}},{key:"handleToggleMenuClick",value:function(){this.props.toggleMenu()}},{key:"handleClickSize",value:function(){this.setState({showSize:!this.state.showSize})}},{key:"handleBlur",value:function(e){this.props.run&&e.currentTarget.focus()}},{key:"handleClickError",value:function(e){var t=e.line,n=(e.column,this.props),a=n.game,r=n.setCodeTab,i=n.setErrorLine,o=Ye({game:a,gameLine:t});if(o){var s=o.tab,l=o.tabLine;r(s),i({line:l-1,timestamp:Date.now()})}}},{key:"componentDidMount",value:function(){this._iframe.focus()}},{key:"componentDidUpdate",value:function(e){this.props.run&&this._iframe.focus(),this.isLoaded&&JSON.stringify([e.iframeVersion,e.game,e.finishBoot,e.run,e.songs,e.chains,e.phrases,e.sprites,e.map,e.screen,e.sound,e.gist,e.setScreen,e.saveGist,e.token])!==JSON.stringify([this.props.iframeVersion,this.props.game,this.props.finishBoot,this.props.run,this.props.songs,this.props.chains,this.props.phrases,this.props.sprites,this.props.map,this.props.screen,this.props.sound,this.props.gist,this.props.setScreen,this.props.saveGist,this.props.token])&&this.evaluate(),W(this.props.game)!==W(e.game)&&this.setState({logs:[]})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"evaluate",value:function(){var e=this,t=this.props,n=t.game,a=t.finishBoot,r=t.run,i=t.songs,o=t.chains,s=t.phrases,l=t.sprites,c=t.map,u=t.screen,h=t.sound,d=t.gist,m=t.setScreen,p=t.saveGist,f=t.token,g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=new window.MessageChannel;e._iframe&&(e._iframe.contentWindow.postMessage({type:"callCode",game:W(n),isDoneFetching:u===k.BOOT&&!d.isFetching&&d.data,songs:i,chains:o,phrases:s,sprites:l,map:c,run:r,callbacks:t,sound:h},"*",[g.port2]),g.port1.onmessage=function(t){"finishBoot"===t.data.callback&&a();var n=t.data,r=n.height,i=n.errors,o=n.logs,s=n.shortcut;r&&e._iframe&&(e._iframe.height=r),i&&e.setState({errors:i}),y.a.isNil(o)||e.setState({logs:o}),s&&("save"===s&&f.value&&Ue(e.props)&&p(e.props),"previous"===s&&m(w(u)),"next"===s&&m(C(u)))})};u===k.BOOT?g({endCallback:"finishBoot"}):qe({text:W(n,!1)}).then(function(e){e.length?console.warn(e[0].message):g()})}},{key:"render",value:function(){var e=this,t=this.state,n=t.errors,a=t.logs,r=this.props,i=r.run,s=r.tutorial,l=r.game,c=r.iframeVersion,u=r.hideMenu,h=r.screen,d=Je(l);document.title=[d,"SCRIPT-8"].filter(function(e){return e}).join(" - ");var m=ze(l),p="".concat("https://script8.github.io","/iframe-v").concat(c,".html");return o.a.createElement("div",{className:E()("Output",{"in-tutorial":s&&i})},o.a.createElement("iframe",{src:p,title:"SCRIPT-8",sandbox:"allow-scripts allow-same-origin",ref:function(t){e._iframe=t},onLoad:function(){e.isLoaded=!0,e.evaluate()}}),i?h===k.BOOT?null:o.a.createElement("button",{className:"button togglemenu",onClick:this.handleToggleMenuClick},u?"show":"hide"," menu"):o.a.createElement("div",{className:"errors-and-stats"},a.map(function(e){return o.a.createElement("div",{className:"log"},"log: ",JSON.stringify(e))}),o.a.createElement("ul",{className:"errors"},n.map(function(t){var n=t.type,a=t.data,r=a.message,i=a.position;return i?o.a.createElement("li",{className:"clickable",key:n,onClick:function(){return e.handleClickError(i)}},"> error: ",r):o.a.createElement("li",{key:n},"error: ",r)})),o.a.createElement("div",{className:"stats"},"TOKENS: ",m)))}}]),t}(i.Component),Qe=Object(l.b)(function(e){var t=e.hideMenu,n=e.iframeVersion,a=e.screen,r=e.game,i=e.songs,o=e.chains,s=e.phrases,l=e.sprites,c=e.map,u=e.sound,h=e.gist,d=e.token,m=e.tutorial;return{hideMenu:t,iframeVersion:n,songs:i,chains:o,phrases:s,sprites:l,map:c,game:a===k.BOOT?{0:{text:Te}}:r,run:[k.BOOT,k.RUN].includes(a),screen:a,sound:u,gist:h,token:d,tutorial:m}},function(e){return{toggleMenu:function(){return e(K.toggleMenu())},setErrorLine:function(t){return e(K.setErrorLine(t))},setCodeTab:function(t){return e(K.setCodeTab(t))},setScreen:function(t){return e(K.setScreen(t))},finishBoot:function(){return e(K.finishBoot())},saveGist:function(t){var n=t.iframeVersion,a=t.game,r=t.token,i=t.gist,o=t.sprites,s=t.map,l=t.phrases,c=t.chains,u=t.songs;return e(Q({iframeVersion:n,game:a,token:r,gist:i,sprites:o,map:s,phrases:l,chains:c,songs:u,toFork:!1}))}}})(Ke),Ze=n(14),$e=n(42),et=n.n($e),tt=function(e){var t=e.x1,n=e.y1,a=e.x2,r=e.y2,i=e.setPixel,o=e.color,s=!1;if(Math.abs(t-a)<Math.abs(n-r)){var l=[n,t];t=l[0],n=l[1];var c=[r,a];a=c[0],r=c[1],s=!0}if(t>a){var u=[a,t];t=u[0],a=u[1];var h=[r,n];n=h[0],r=h[1]}for(var d=a-t,m=r-n,p=2*Math.abs(m),f=0,g=n,b=t;b<=a;b++)s?i(g,b,o):i(b,g,o),(f+=p)>d&&(r>n?g++:g--,f-=2*d)},nt=function(e){var t=e.points,n=e.args,a=e.line;if(t.length){var r,i,o,s,l,c;switch(n.length){case 1:i=t.map(function(e){return Object(B.a)(e)}),r=n[0];break;case 2:o=Math.cos(n[0]/180*Math.PI),s=Math.sin(n[0]/180*Math.PI);var u=t.map(function(e){return e[0]}),h=t.map(function(e){return e[1]});l=(Math.min.apply(Math,u)+Math.max.apply(Math,u))/2,c=(Math.min.apply(Math,h)+Math.max.apply(Math,h))/2,i=t.map(function(e){return[(e[0]-l)*o-(e[1]-c)*s+l,(e[0]-l)*s+(e[1]-c)*o+c]}),r=n[1];break;case 3:throw Error("`polyStroke` found 3 arguments instead of 2, 3, or 5.");default:o=Math.cos(n[0]/180*Math.PI),s=Math.sin(n[0]/180*Math.PI),l=n[1],c=n[2],r=n[3],i=t.map(function(e){return[(e[0]-l)*o-(e[1]-c)*s+l,(e[0]-l)*s+(e[1]-c)*o+c]})}for(var d=1;d<t.length;d++)a(Math.round(i[d-1][0]),Math.round(i[d-1][1]),Math.round(i[d][0]),Math.round(i[d][1]),r);a(Math.round(i[i.length-1][0]),Math.round(i[i.length-1][1]),Math.round(i[0][0]),Math.round(i[0][1]),r)}},at=function(e){var t=e.cx,n=e.cy,a=e.radius,r=e.color,i=e.onlyStroke,o=e.setPixel,s=e.line,l=a-1,c=0,u=1,h=1,d=u-(a<<1),m=function(e,a){i?(o(t+e,n+a,r),o(t+e,n-a,r)):s(t+e,n+a,t+e,n-a,r)};if(2===a)m(-1,0),m(0,1),m(1,0);else if(3===a)m(-2,0),m(-2,1),m(-1,2),m(-0,2),m(1,2),m(2,1),m(2,0);else for(;l>=c;)m(l,c),m(-l,c),m(c,l),m(-c,l),d<=0&&(c++,d+=h,h+=2),d>0&&(l--,d+=(u+=2)-(a<<1))},rt=function(e){var t=e.x,n=e.y,a=e.spriteIndex,r=e.darken,i=e.flipH,o=e.flipV,s=e.setPixel,l=e.sprites;l[a]&&l[a].slice(0,8).forEach(function(e,a){e.split("").forEach(function(e,l){if(" "!==e){var c=et()(+e-r,0,7);s(Math.floor(t)+(i?7-l:l),Math.floor(n)+(o?7-a:a),c)}})})},it={"<":[0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0],">":[1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,0,0],"/":[0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0,0],":":[0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0],"|":[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0],"(":[0,1,1,0,1,0,1,0,0,1,0,0],")":[1,0,0,1,0,1,0,1,1,0,0,0],0:[0,1,1,1,0,1,1,0,1,1,0,1,1,1,1,0,0,0],1:[1,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0],2:[1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,0,0,0],3:[1,1,1,0,0,1,0,1,1,0,0,1,1,1,1,0,0,0],4:[1,0,1,1,0,1,1,1,1,0,0,1,0,0,1,0,0,0],5:[1,1,1,1,0,0,1,1,1,0,0,1,1,1,1,0,0,0],6:[1,0,0,1,0,0,1,1,1,1,0,1,1,1,1,0,0,0],7:[1,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0],8:[1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,0],9:[1,1,1,1,0,1,1,1,1,0,0,1,0,0,1,0,0,0]," ":[0,0,0,0,0,0,0,0,0,0,0,0],".":[0,0,0,0,1,0],",":[0,0,0,0,1,1],"+":[0,0,0,0,1,0,1,1,1,0,1,0,0,0,0,0,0,0],"-":[0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0],"!":[1,1,1,0,1,0],"?":[1,1,0,1,1,1,0,0,1,0,0,0],a:[1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,0,0,0],b:[1,1,0,1,0,1,1,1,0,1,0,1,1,1,1,0,0,0],c:[1,1,1,1,0,0,1,0,0,1,0,0,1,1,1,0,0,0],d:[1,1,0,1,0,1,1,0,1,1,0,1,1,1,1,0,0,0],e:[1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,0,0,0],f:[1,1,1,1,0,0,1,1,1,1,0,0,1,0,0,0,0,0],g:[1,1,1,1,0,0,1,0,1,1,0,1,1,1,1,0,0,0],h:[1,0,1,1,0,1,1,1,1,1,0,1,1,0,1,0,0,0],i:[1,1,1,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0],j:[0,0,1,0,0,1,0,0,1,1,0,1,1,1,1,0,0,0],k:[1,0,1,1,0,1,1,1,0,1,0,1,1,0,1,0,0,0],l:[1,0,0,1,0,0,1,0,0,1,0,0,1,1,1,0,0,0],m:[1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,0,0,0],n:[1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0],o:[1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,0,0,0],p:[1,1,1,1,0,1,1,1,1,1,0,0,1,0,0,0,0,0],q:[1,1,1,1,0,1,1,0,1,1,0,1,0,1,1,0,0,0],r:[1,1,1,1,0,1,1,1,0,1,0,1,1,0,1,0,0,0],s:[1,1,1,1,0,0,1,1,1,0,0,1,1,1,1,0,0,0],t:[1,1,1,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0],u:[1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,0,0],v:[1,0,1,1,0,1,1,0,1,1,0,1,1,1,0,0,0,0],w:[1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,0,0,0],x:[1,0,1,1,0,1,0,1,0,1,0,1,1,0,1,0,0,0],y:[1,0,1,1,0,1,1,1,1,0,0,1,1,1,1,0,0,0],z:[1,1,1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,0]},ot=function(e){var t=e.x,n=e.y,a=e.letters,r=e.c,i=e.setPixel,o=Math.floor(t),s=Math.floor(n),l=!0,c=!1,u=void 0;try{for(var h,d=a.toString().split("")[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var m=h.value,p=it[m.toLowerCase()];if(p){for(var f=p.length/6,g=0;g<f;g++)for(var b=0;b<6;b++)p[b*f+g]&&i(o+g,s+b,r);o+=f+1}else o+=3}}catch(E){c=!0,u=E}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}},st=!1,lt=function(e){var t=e.pixels,n=e.width,a=e.height,r=e.sprites,i=e.map,o=void 0===i?[]:i,s=JSON.parse(JSON.stringify(o)),l=0,c=0,u={},h=function(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e=Math.floor(e-l),r=Math.floor(r-c),!(e<0||e>=n||r<0||r>=a)){var o=bt.int(i);if(o){var s=u[o]||o;t[r*n+e]=s}}},d=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;tt({x1:e,y1:t,x2:n,y2:a,setPixel:h,color:r})},m=function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];e-l<-8||e-l>n||t-c<-8||t-c>a||rt({x:e,y:t,spriteIndex:i,darken:o,flipH:s,flipV:u,setPixel:h,sprites:r})};return{camera:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;l=Math.floor(e),c=Math.floor(t)},clear:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;t.fill(bt.int(e))},colorSwap:function(e,t){void 0===e&&void 0===t?u={}:u[bt.int(e)]=bt.int(t)},setPixel:h,getPixel:function(e,r){return e=Math.floor(e-l),r=Math.floor(r-c),e<0||e>=n||r<0||r>=a?7:bt.lookupInt(t[r*a+e])},line:d,polyStroke:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];nt({points:e,args:n,line:d})},rectStroke:function(e,t,n,a){!function(e){var t=e.x,n=e.y,a=e.w,r=e.h,i=e.c,o=e.line,s=Math.floor(t),l=Math.floor(t+a-1),c=Math.floor(n),u=Math.floor(n+r-1);o(s,c,l,c,i),o(s,u,l,u,i),o(s,c,s,u,i),o(l,c,l,u,i)}({x:e,y:t,w:n,h:a,c:arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,line:d})},rectFill:function(e,t,n,a){!function(e){for(var t=e.x,n=e.y,a=e.w,r=e.h,i=e.c,o=e.line,s=Math.floor(t),l=Math.floor(t+a-1),c=Math.floor(n),u=Math.floor(n+r-1),h=s;h<=l;h++)o(h,c,h,u,i)}({x:e,y:t,w:n,h:a,c:arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,line:d})},circStroke:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;at({cx:Math.floor(e),cy:Math.floor(t),radius:Math.floor(n),color:a,onlyStroke:!0,setPixel:h,line:d})},circFill:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;at({cx:Math.floor(e),cy:Math.floor(t),radius:Math.floor(n),color:a,setPixel:h,line:d})},print:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;ot({x:e,y:t,letters:n,c:a,setPixel:h})},sprite:m,getTile:function(e,t){var n=Object(v.get)(s,[t,e],null),a=null!==n?r[n]:null;return a&&(a.type=a[8]||0,a.number=n),a},setTile:function(e,t,n){s[t][e]=n},map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;s.forEach(function(n,a){n.forEach(function(n,r){null!==n&&m(8*(r+e),8*(a+t),n)})})},resetMap:function(){s=JSON.parse(JSON.stringify(o))}}},ct=[[246,214,189],[195,163,138],[153,117,119],[129,98,113],[78,73,95],[32,57,79],[15,42,63],[8,20,30]],ut=ct.map(function(e){var t=Object(Ze.a)(e,3),n=t[0],a=t[1],r=t[2];return"rgb(".concat(n,",").concat(a,",").concat(r,")")}),ht=[],dt=0;dt<8;dt++){var mt=ct[dt],pt=255<<24|mt[2]<<16|mt[1]<<8|mt[0];ht[dt]=pt>>>0}for(var ft={},gt=0;gt<8;gt++)ft[ht[gt]]=gt;var bt={rgb:function(e){return ut[e%ut.length]},triplet:function(e){return ct[e%ct.length]},int:function(e){var t=e%ht.length;return st&&(t>2?t=et()(+t-2,0,7):t+=2),ht[t]},lookupInt:function(e){return e in ft?ft[e]:7}},Et=function(e){var t=e.cx,n=e.cy,a=e.radius,r=e.ctx,i=e.color,o=e.onlyStroke,s=a-1,l=0,c=1,u=1,h=c-(a<<1);r.fillStyle=i,r.strokeStyle=i;var d=function(e,t){r.fillRect(e,t,1,1)},m=function(e){var t=e.x0,n=e.x1,a=e.y;r.beginPath(),r.moveTo(t+1,a+.5),r.lineTo(n,a+.5),r.stroke()};if(2===a)d(t+1,n),d(t-1,n),d(t,n+1),d(t,n-1),o||d(t,n);else if(3===a)m({x0:t-2,x1:t+2,y:n-2}),m({x0:t-2,x1:t+2,y:n+2}),o?(d(t+2,n-1),d(t+2,n),d(t+2,n+1),d(t-2,n-1),d(t-2,n),d(t-2,n+1)):(m({x0:t-3,x1:t+3,y:n-1}),m({x0:t-3,x1:t+3,y:n}),m({x0:t-3,x1:t+3,y:n+1}));else for(;s>=l;)o?(d(t+s,n+l),d(t-s,n+l),d(t+l,n+s),d(t-l,n+s),d(t+s,n-l),d(t-s,n-l),d(t+l,n-s),d(t-l,n-s)):(m({x0:t+l,x1:t-l,y:n-s}),m({x0:t+s,x1:t-s,y:n-l}),m({x0:t+s,x1:t-s,y:n+l}),m({x0:t+l,x1:t-l,y:n+s})),h<=0&&(l++,h+=u,u+=2),h>0&&(s--,h+=(c+=2)-(a<<1))},vt=function(e){var t=e.x1,n=e.y1,a=e.x2,r=e.y2,i=e.ctx,o=e.color;i.fillStyle=o;var s=!1;if(Math.abs(t-a)<Math.abs(n-r)){var l=[n,t];t=l[0],n=l[1];var c=[r,a];a=c[0],r=c[1],s=!0}if(t>a){var u=[a,t];t=u[0],a=u[1];var h=[r,n];n=h[0],r=h[1]}for(var d=a-t,m=r-n,p=2*Math.abs(m),f=0,g=n,b=t;b<=a;b++)s?i.fillRect(g,b,1,1):i.fillRect(b,g,1,1),(f+=p)>d&&(r>n?g++:g--,f-=2*d)},yt=function(e){var t=e.points,n=e.args,a=e.ctx;if(t.length){var r,i,o,s,l,c;switch(n.length){case 1:i=t.map(function(e){return Object(B.a)(e)}),r=n[0];break;case 2:o=Math.cos(n[0]/180*Math.PI),s=Math.sin(n[0]/180*Math.PI);var u=t.map(function(e){return e[0]}),h=t.map(function(e){return e[1]});l=(Math.min.apply(Math,u)+Math.max.apply(Math,u))/2,c=(Math.min.apply(Math,h)+Math.max.apply(Math,h))/2,i=t.map(function(e){return[(e[0]-l)*o-(e[1]-c)*s+l,(e[0]-l)*s+(e[1]-c)*o+c]}),r=n[1];break;case 3:throw Error("`polyStroke` found 3 arguments instead of 2, 3, or 5.");default:o=Math.cos(n[0]/180*Math.PI),s=Math.sin(n[0]/180*Math.PI),l=n[1],c=n[2],r=n[3],i=t.map(function(e){return[(e[0]-l)*o-(e[1]-c)*s+l,(e[0]-l)*s+(e[1]-c)*o+c]})}for(var d=1;d<t.length;d++)vt({x1:Math.round(i[d-1][0]),y1:Math.round(i[d-1][1]),x2:Math.round(i[d][0]),y2:Math.round(i[d][1]),ctx:a,color:bt.rgb(r)});vt({x1:Math.round(i[i.length-1][0]),y1:Math.round(i[i.length-1][1]),x2:Math.round(i[0][0]),y2:Math.round(i[0][1]),ctx:a,color:bt.rgb(r)})}},Ot={"<":[0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0],">":[1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,0,0],"/":[0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0,0],":":[0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0],"|":[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0],"(":[0,1,1,0,1,0,1,0,0,1,0,0],")":[1,0,0,1,0,1,0,1,1,0,0,0],0:[0,1,1,1,0,1,1,0,1,1,0,1,1,1,1,0,0,0],1:[1,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0],2:[1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,0,0,0],3:[1,1,1,0,0,1,0,1,1,0,0,1,1,1,1,0,0,0],4:[1,0,1,1,0,1,1,1,1,0,0,1,0,0,1,0,0,0],5:[1,1,1,1,0,0,1,1,1,0,0,1,1,1,1,0,0,0],6:[1,0,0,1,0,0,1,1,1,1,0,1,1,1,1,0,0,0],7:[1,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0],8:[1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,0],9:[1,1,1,1,0,1,1,1,1,0,0,1,0,0,1,0,0,0]," ":[0,0,0,0,0,0,0,0,0,0,0,0],".":[0,0,0,0,1,0],",":[0,0,0,0,1,1],"+":[0,0,0,0,1,0,1,1,1,0,1,0,0,0,0,0,0,0],"-":[0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0],"!":[1,1,1,0,1,0],"?":[1,1,0,1,1,1,0,0,1,0,0,0],a:[1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,0,0,0],b:[1,1,0,1,0,1,1,1,0,1,0,1,1,1,1,0,0,0],c:[1,1,1,1,0,0,1,0,0,1,0,0,1,1,1,0,0,0],d:[1,1,0,1,0,1,1,0,1,1,0,1,1,1,1,0,0,0],e:[1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,0,0,0],f:[1,1,1,1,0,0,1,1,1,1,0,0,1,0,0,0,0,0],g:[1,1,1,1,0,0,1,0,1,1,0,1,1,1,1,0,0,0],h:[1,0,1,1,0,1,1,1,1,1,0,1,1,0,1,0,0,0],i:[1,1,1,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0],j:[0,0,1,0,0,1,0,0,1,1,0,1,1,1,1,0,0,0],k:[1,0,1,1,0,1,1,1,0,1,0,1,1,0,1,0,0,0],l:[1,0,0,1,0,0,1,0,0,1,0,0,1,1,1,0,0,0],m:[1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,0,0,0],n:[1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0],o:[1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,0,0,0],p:[1,1,1,1,0,1,1,1,1,1,0,0,1,0,0,0,0,0],q:[1,1,1,1,0,1,1,0,1,1,0,1,0,1,1,0,0,0],r:[1,1,1,1,0,1,1,1,0,1,0,1,1,0,1,0,0,0],s:[1,1,1,1,0,0,1,1,1,0,0,1,1,1,1,0,0,0],t:[1,1,1,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0],u:[1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,0,0],v:[1,0,1,1,0,1,1,0,1,1,0,1,1,1,0,0,0,0],w:[1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,0,0,0],x:[1,0,1,1,0,1,0,1,0,1,0,1,1,0,1,0,0,0],y:[1,0,1,1,0,1,1,1,1,0,0,1,1,1,1,0,0,0],z:[1,1,1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,0]},St=function(e){var t=e.x,n=e.y,a=e.letters,r=e.c,i=e.ctx,o=bt.triplet(r);a.toString().split("").map(function(e){var t=Ot[e.toLowerCase()];return{width:t?t.length/6:3,letter:e,pixels:t}}).reduce(function(e,t,n){var a=e[n-1],r=a?a.width+1+a.xOffset:0,i=a?a.yOffset:0;return[].concat(Object(B.a)(e),[Object(F.a)({},t,{xOffset:r,yOffset:i})])},[]).filter(function(e){return e.pixels}).forEach(function(e){var a=e.pixels,r=e.xOffset,s=e.yOffset,l=e.width,c=i.getImageData(t+r,n+s,l,6),u=c.data;a.map(function(e,t){return{pixel:e,pixelIndex:t}}).filter(function(e){return e.pixel}).forEach(function(e){var t=4*e.pixelIndex;u[t+0]=o[0],u[t+1]=o[1],u[t+2]=o[2],u[t+3]=255}),i.putImageData(c,t+r,n+s)})},Ct=function(e){var t=e.x,n=e.y,a=e.spriteIndex,r=e.darken,i=void 0===r?0:r,o=e.flipH,s=void 0!==o&&o,l=e.flipV,c=void 0!==l&&l,u=e.sprites,h=e.ctx;u[a]&&u[a].slice(0,8).forEach(function(e,a){e.split("").forEach(function(e,r){if(" "!==e){var o=et()(+e-i,0,7);h.fillStyle=bt.rgb(o),h.fillRect(Math.floor(t)+(s?7-r:r),Math.floor(n)+(c?7-a:a),1,1)}})})},wt=function(e){var t=e.ctx,n=e.width,a=e.height,r=e.sprites,i=e.map,o=void 0===i?[]:i,s=JSON.parse(JSON.stringify(o));t.setTransform(1,0,0,1,0,0);var l=0,c=0,u=document.createElement("canvas");u.width=n,u.height=a;var h=u.getContext("2d");return Object.entries(r).forEach(function(e){var t=Object(Ze.a)(e,2),n=t[0],a=t[1],r=+n;!function(e){var t=e.x,n=e.y,a=e.grid,r=e.ctx;a.slice(0,8).forEach(function(e,a){e.split("").forEach(function(e,i){" "!==e&&(r.fillStyle=bt.rgb(+e),r.fillRect(Math.floor(t)+i,Math.floor(n)+a,1,1))})})}({x:r%16*8,y:8*Math.floor(r/16),grid:a,ctx:h})}),{polyStroke:function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];yt({points:e,args:a,ctx:t})},getTile:function(e,t){var n=Object(v.get)(s,[t,e],null),a=null!==n?r[n]:null;return a&&(a.type=a[8]||0,a.number=n),a},setTile:function(e,t,n){s[t][e]=n},line:function(e,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;vt({x1:Math.floor(e),y1:Math.floor(n),x2:Math.floor(a),y2:Math.floor(r),ctx:t,color:bt.rgb(i)})},print:function(e,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;St({x:e-l,y:n-c,letters:a,c:r,ctx:t})},rectStroke:function(e,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;t.strokeStyle=bt.rgb(i),t.strokeRect(Math.floor(e)+.5,Math.floor(n)+.5,Math.floor(a)-1,Math.floor(r)-1)},camera:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;l=Math.floor(e),c=Math.floor(n),t.setTransform(1,0,0,1,0,0),t.translate(-l,-c)},rectFill:function(e,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;t.fillStyle=bt.rgb(i),t.fillRect(Math.floor(e),Math.floor(n),Math.floor(a),Math.floor(r))},resetMap:function(){s=JSON.parse(JSON.stringify(o))},map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;s.forEach(function(a,r){a.forEach(function(a,i){if(null!==a){var o=a%16*8,s=8*Math.floor(a/16),h=8*(i+e),d=8*(r+n);h+7>=l&&h<l+128&&d+7>=c&&d<c+128&&t.drawImage(u,o,s,8,8,h,d,8,8)}})})},sprite:function(e,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Ct({x:e,y:n,spriteIndex:a,darken:i,flipH:o,flipV:s,sprites:r,ctx:t})},circStroke:function(e,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Et({cx:Math.floor(e),cy:Math.floor(n),radius:Math.floor(a),ctx:t,color:bt.rgb(r),onlyStroke:!0})},circFill:function(e,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Et({cx:Math.floor(e),cy:Math.floor(n),radius:Math.floor(a),ctx:t,color:bt.rgb(r)})},clear:function(e){t.save(),t.setTransform(1,0,0,1,0,0),Object(v.isNil)(e)?t.clearRect(0,0,n,a):(t.fillStyle=bt.rgb(e),t.fillRect(0,0,128,128)),t.restore()},getPixel:function(e,n){return function(e){var t=e.x,n=e.y,a=e.ctx,r=Object(Ze.a)(a.getImageData(t,n,1,1).data,4),i=r[0],o=r[1],s=r[2],l=r[3];if(255!==l)return 7;var c=bt.lookup([i,o,s,l]);return null===c?7:c}({x:Math.floor(e-l),y:Math.floor(n-c),ctx:t})},setPixel:function(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(e){var t=e.x,n=e.y,a=e.ctx,r=e.color;a.fillStyle=r,a.fillRect(t,n,1,1)}({x:Math.floor(e),y:Math.floor(n),ctx:t,color:bt.rgb(a)})}}},kt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).draw=n.draw.bind(Object(ee.a)(Object(ee.a)(n))),n.handleTypeClick=n.handleTypeClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handleColorClick=n.handleColorClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handleCanvasClick=n.handleCanvasClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOnMouseDown=n.handleOnMouseDown.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOnMouseEnter=n.handleOnMouseEnter.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOnMouseUp=n.handleOnMouseUp.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOnTouchMove=n.handleOnTouchMove.bind(Object(ee.a)(Object(ee.a)(n))),n.getCurrentSprite=n.getCurrentSprite.bind(Object(ee.a)(Object(ee.a)(n))),n.drawPixel=n.drawPixel.bind(Object(ee.a)(Object(ee.a)(n))),n.setMode=n.setMode.bind(Object(ee.a)(Object(ee.a)(n))),n.state={spriteIndex:0,colorIndex:0,mouseDown:!1,mode:"+"},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"draw",value:function(){var e=this,t=this.props.sprites;this.canvasAPI=wt({ctx:this._canvas.getContext("2d"),width:128,height:64,sprites:t}),this.canvasAPI.clear(),Object.keys(t).forEach(function(t){var n=+t,a=Math.floor(n/16),r=n%16;e.canvasAPI.sprite(8*r,8*a,n)})}},{key:"componentDidMount",value:function(){this.draw()}},{key:"getCurrentSprite",value:function(){var e=this.props.sprites,t=this.state.spriteIndex;return y.a.get(e,t,y.a.range(8).map(function(e){return"        "}))}},{key:"handleCanvasClick",value:function(e){this.setState({spriteIndex:e})}},{key:"handleColorClick",value:function(e){this.setState({colorIndex:e,mode:"+"})}},{key:"handleTypeClick",value:function(e){var t=this.state.spriteIndex,n=this.props.updateSprite,a=this.getCurrentSprite();n({sprite:[].concat(Object(B.a)(a.slice(0,8)),[e]),index:t})}},{key:"handleOnMouseDown",value:function(e){this.setState({mouseDown:!0});var t=e.target.dataset,n=t.row,a=t.col;this.drawPixel({row:+n,col:+a})}},{key:"handleOnMouseEnter",value:function(e){if(this.state.mouseDown){var t=e.target.dataset,n=t.row,a=t.col;this.drawPixel({row:+n,col:+a})}}},{key:"handleOnMouseUp",value:function(){this.setState({mouseDown:!1})}},{key:"handleOnTouchMove",value:function(e){if(this.state.mouseDown){var t=e.changedTouches[0],n=document.elementFromPoint(t.clientX,t.clientY).dataset,a=n.row,r=n.col;a&&r&&this.drawPixel({row:+a,col:+r})}}},{key:"setMode",value:function(e){this.setState({mode:e})}},{key:"drawPixel",value:function(e){var t,n,a,r=e.row,i=e.col,o=this.state,s=o.spriteIndex,l=o.colorIndex,c=o.mode,u=this.props.updateSprite,h=this.getCurrentSprite(),d=JSON.parse(JSON.stringify(h));d[r]=(t=d[r],n=i,a="+"===c?l:" ",t.substr(0,n)+a+t.substr(n+a.toString().length)),u({sprite:d,index:s})}},{key:"componentDidUpdate",value:function(){this.draw()}},{key:"render",value:function(){var e=this,t=this.state,n=t.spriteIndex,a=t.colorIndex,r=t.mode,i=this.getCurrentSprite(),s=!i.slice(0,8).filter(function(e){return"        "!==e}).length,l=8===i.length?0:+i[8];return o.a.createElement("div",{onMouseUp:this.handleOnMouseUp,onTouchEnd:this.handleOnMouseUp,className:"Sprite two-rows-and-grid"},o.a.createElement("div",{className:"main"},o.a.createElement("div",{className:"SpriteEditor"},o.a.createElement("div",{className:"sprite-and-colors"},o.a.createElement("table",{className:"sprite"},o.a.createElement("tbody",null,y.a.range(8).map(function(t){return o.a.createElement("tr",{key:t},y.a.range(8).map(function(n){var a=y.a.get(i,[t,n]," ");return o.a.createElement("td",{key:n},o.a.createElement("button",{"data-row":t,"data-col":n,onMouseDown:e.handleOnMouseDown,onMouseEnter:e.handleOnMouseEnter,onTouchStart:e.handleOnMouseDown,onTouchMove:e.handleOnTouchMove,className:"background-".concat(a)}," "===a?"x":""))}))}))),o.a.createElement("div",{className:"colors-and-tools"},o.a.createElement("table",{className:"colors"},o.a.createElement("tbody",null,y.a.range(2).map(function(t){return o.a.createElement("tr",{key:t},y.a.range(0+4*t,4+4*t).map(function(t){return o.a.createElement("td",{key:t,className:E()({active:t===a&&"+"===r})},o.a.createElement("button",{onClick:function(){return e.handleColorClick(t)},className:E()("background-".concat(t),"border-".concat(t),{active:t===a&&"+"===r})}))}))}))),o.a.createElement("div",{className:"tools"},o.a.createElement("div",{className:"add-delete"},o.a.createElement("button",{className:E()("button",{active:"+"===r}),onClick:function(){e.setMode("+")}},"+"),o.a.createElement("button",{className:E()("button",{active:"-"===r}),onClick:function(){e.setMode("-")}},"-")),o.a.createElement("table",{className:E()("types",{hide:s})},o.a.createElement("tbody",null,o.a.createElement("tr",null,y.a.range(4).map(function(t){return o.a.createElement("td",{key:t,className:E()({active:t===l})},o.a.createElement("button",{onClick:function(){return e.handleTypeClick(t)},className:E()({active:t===l})},t))}))))))),o.a.createElement("div",{className:"sprites"},o.a.createElement("table",null,o.a.createElement("tbody",null,y.a.range(8).map(function(t){return o.a.createElement("tr",{key:t},y.a.range(16).map(function(a){var r=16*t+a;return o.a.createElement("td",{className:E()({active:n===r}),key:a},o.a.createElement("button",{onClick:function(){return e.handleCanvasClick(r)}}))}))}))),o.a.createElement("canvas",{width:128,height:64,ref:function(t){e._canvas=t}})),o.a.createElement("div",{className:"sprite-number"},n))))}}]),t}(i.Component),xt=Object(l.b)(function(e){return{sprites:e.sprites}},function(e){return{updateSprite:function(t){var n=t.sprite,a=t.index;return e(K.updateSprite({sprite:n,index:a}))}}})(kt),Tt=function(e){var t=e.width,n=e.height,a=new ImageData(t,n),r=new ArrayBuffer(4*t*n),i=new Uint8ClampedArray(r);return{pixels:new Uint32Array(r),writePixelDataToCanvas:function(e){a.data.set(i),e.putImageData(a,0,0)}}},jt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleOnMouseDown=n.handleOnMouseDown.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOnMouseEnter=n.handleOnMouseEnter.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOnMouseUp=n.handleOnMouseUp.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOnTouchMove=n.handleOnTouchMove.bind(Object(ee.a)(Object(ee.a)(n))),n.handleSpriteClick=n.handleSpriteClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handleRoomClick=n.handleRoomClick.bind(Object(ee.a)(Object(ee.a)(n))),n.spritePixelData=Tt({width:128,height:64}),n.drawSprite=n.drawSprite.bind(Object(ee.a)(Object(ee.a)(n))),n.roomPixelData=Tt({width:128,height:128}),n.drawRoom=n.drawRoom.bind(Object(ee.a)(Object(ee.a)(n))),n.mapPixelData=Tt({width:1024,height:512}),n.drawMap=n.drawMap.bind(Object(ee.a)(Object(ee.a)(n))),n.getCurrentRoom=n.getCurrentRoom.bind(Object(ee.a)(Object(ee.a)(n))),n.setMode=n.setMode.bind(Object(ee.a)(Object(ee.a)(n))),n.state={spriteIndex:0,roomIndex:0,mouseDown:!1,mode:"+"},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.drawSprites(),this.drawRoom(),this.drawMap()}},{key:"drawSprites",value:function(){var e=this,t=this.props.sprites;this.spriteCanvasAPI=lt({pixels:this.spritePixelData.pixels,width:128,height:64,sprites:t}),this.spriteCanvasAPI.clear(),Object.keys(t).forEach(function(t){var n=+t,a=Math.floor(n/16),r=n%16;e.spriteCanvasAPI.sprite(8*r,8*a,n)}),this.spritePixelData.writePixelDataToCanvas(this._spriteCanvas.getContext("2d"))}},{key:"drawRoom",value:function(){var e=this,t=Date.now(),n=this.props,a=n.sprites,r=n.map,i=this.state.roomIndex;this.roomCanvasAPI=lt({pixels:this.roomPixelData.pixels,width:128,height:128,sprites:a}),this.roomCanvasAPI.clear(),y.a.range(16).forEach(function(t){y.a.range(16).forEach(function(n){var a=y.a.get(r,[16*Math.floor(i/8)+t,i%8*16+n]);e.roomCanvasAPI.sprite(8*n,8*t,a)})}),this.roomPixelData.writePixelDataToCanvas(this._roomCanvas.getContext("2d"));var o=Date.now();console.log("this.drawRoom() took: ".concat(o-t,"ms"))}},{key:"drawMap",value:function(){var e=this,t=Date.now(),n=this.props,a=n.map,r=n.sprites;this.mapCanvasAPI=lt({pixels:this.mapPixelData.pixels,width:1024,height:512,sprites:r,map:a}),this.mapCanvasAPI.clear(),a.forEach(function(t,n){t.forEach(function(t,a){e.mapCanvasAPI.sprite(8*a,8*n,t)})}),this.mapPixelData.writePixelDataToCanvas(this._mapCanvas.getContext("2d"));var i=Date.now();console.log("this.drawMap() took: ".concat(i-t,"ms"))}},{key:"componentDidUpdate",value:function(){this.drawRoom(),this.drawMap()}},{key:"handleOnMouseDown",value:function(e){this.setState({mouseDown:!0});var t=e.target.dataset,n=t.row,a=t.col;this.drawSprite({row:+n,col:+a})}},{key:"handleOnMouseEnter",value:function(e){if(this.state.mouseDown){var t=e.target.dataset,n=t.row,a=t.col;this.drawSprite({row:+n,col:+a})}}},{key:"handleOnMouseUp",value:function(){this.setState({mouseDown:!1})}},{key:"handleOnTouchMove",value:function(e){if(this.state.mouseDown){var t=e.changedTouches[0],n=document.elementFromPoint(t.clientX,t.clientY).dataset,a=n.row,r=n.col;a&&r&&this.drawSprite({row:+a,col:+r})}}},{key:"handleSpriteClick",value:function(e){this.setState({spriteIndex:e,mode:"+"})}},{key:"handleRoomClick",value:function(e){this.setState({roomIndex:e})}},{key:"drawSprite",value:function(e){var t=e.row,n=e.col,a=this.state,r=a.roomIndex,i=a.spriteIndex,o=a.mode,s=this.props.updateMap,l=this.getCurrentRoom(),c=JSON.parse(JSON.stringify(l));c[16*Math.floor(r/8)+t][r%8*16+n]="+"===o?i:null,s(c)}},{key:"getCurrentRoom",value:function(){var e=this.props.map;return e.length?e:t.createBlankMap()}},{key:"setMode",value:function(e){this.setState({mode:e})}},{key:"render",value:function(){var e=this,t=this.state,n=t.roomIndex,a=t.spriteIndex,r=t.mode,i=this.props.map;return o.a.createElement("div",{onMouseUp:this.handleOnMouseUp,onTouchEnd:this.handleOnMouseUp,className:"Map two-rows-and-grid"},o.a.createElement("div",{className:"main"},o.a.createElement("div",{className:"MapEditor"},o.a.createElement("div",{className:"room-and-tools"},o.a.createElement("div",{className:"room"},o.a.createElement("table",null,o.a.createElement("tbody",null,y.a.range(16).map(function(t){return o.a.createElement("tr",{key:t},y.a.range(16).map(function(a){var r=y.a.get(i,[16*Math.floor(n/8)+t,n%8*16+a]);return o.a.createElement("td",{key:a},o.a.createElement("button",{"data-row":t,"data-col":a,onMouseDown:e.handleOnMouseDown,onMouseEnter:e.handleOnMouseEnter,onTouchStart:e.handleOnMouseDown,onTouchMove:e.handleOnTouchMove,className:"background-"},y.a.isNil(r)?"x":""))}))}))),o.a.createElement("canvas",{width:128,height:128,ref:function(t){e._roomCanvas=t}})),o.a.createElement("div",{className:"tools"},o.a.createElement("button",{className:E()("button",{active:"+"===r}),onClick:function(){e.setMode("+")}},"+"),o.a.createElement("button",{className:E()("button",{active:"-"===r}),onClick:function(){e.setMode("-")}},"-"))),o.a.createElement("div",{className:"sprites-and-map"},o.a.createElement("div",{className:"sprites"},o.a.createElement("table",null,o.a.createElement("tbody",null,y.a.range(8).map(function(t){return o.a.createElement("tr",{key:t},y.a.range(16).map(function(n){var i=16*t+n;return o.a.createElement("td",{className:E()({active:a===i&&"+"===r}),key:n},o.a.createElement("button",{onClick:function(){return e.handleSpriteClick(i)}}))}))}))),o.a.createElement("canvas",{width:128,height:64,ref:function(t){e._spriteCanvas=t}})),o.a.createElement("div",{className:"map"},o.a.createElement("table",null,o.a.createElement("tbody",null,y.a.range(4).map(function(t){return o.a.createElement("tr",{key:t},y.a.range(8).map(function(a){var r=8*t+a;return o.a.createElement("td",{className:E()({active:n===r}),key:a},o.a.createElement("button",{onClick:function(){return e.handleRoomClick(r)}}))}))}))),o.a.createElement("canvas",{width:1024,height:512,ref:function(t){e._mapCanvas=t}}))))))}}]),t}(i.Component);jt.createBlankMap=function(){return y.a.range(64).map(function(){return y.a.range(128).map(function(){return null})})};var Nt=Object(l.b)(function(e){return{sprites:e.sprites,map:e.map}},function(e){return{updateMap:function(t){return e(K.updateMap(t))}}})(jt),It=n(6),At={octaves:4,volumes:8,phrases:64,chains:64,songs:8,matrixLength:16,chainChannels:4,startOffset:"+0.1",startOffsetDouble:"+0.5",bpm:1152,subdivision:"2m"},Rt={volume:function(e){return(e+1)/At.volumes},note:function(e){return e}},Mt=[1,2,3,5,8,12,20,32],Dt=[].concat(Mt).reverse(),Pt=function(e){return Mt[e]},Ut=function(e){return Dt.map(function(e){return{"16n":e}})[e]},Lt=function(e){var t,n=e.volumeNode,a=e.index;return 0===a&&((t=new It.Synth({oscillator:{type:"pulse",width:.5},envelope:{release:.07}})).script8Name="synth"),1===a&&((t=new It.Synth({oscillator:{type:"pulse",width:.75},envelope:{release:.07}})).script8Name="synth"),2===a&&((t=new It.Synth({oscillator:{type:"triangle"},envelope:{release:.07}})).script8Name="synth"),3===a&&((t=new It.NoiseSynth({envelope:{release:.07}})).script8Name="noise"),n?t.chain(n,It.Master):t.chain(It.Master),t},_t=function(e){var t=e.note,n=e.octave,a=e.volume,r=e.time,i=void 0===r?It.context.currentTime:r,o=e.synth;if(i>=It.context.currentTime){var s=U(t+12*n,!0,!0),l=Rt.volume(a);"synth"===o.script8Name&&o.triggerAttack(s,i,l),"noise"===o.script8Name&&o.triggerAttack(i,l)}},Ht=function(e){var t=e.note,n=e.octave,a=e.volume,r=e.time,i=void 0===r?It.context.currentTime:r,o=e.synth,s=e.tempo;if(i>=It.context.currentTime){var l=U(t+12*n,!0,!0),c=Ut(s),u=Rt.volume(a);"synth"===o.script8Name&&o.triggerAttackRelease(l,c,i,u),"noise"===o.script8Name&&o.triggerAttackRelease(c,i,u)}},Ft=function(e){var t=e.time,n=void 0===t?It.context.currentTime:t,a=e.delay,r=void 0===a?0:a,i=e.synth;n>=It.context.currentTime&&i.triggerRelease(n+r)},Gt=function(e){var t=e.label,n=e.value,a=e.type,r=e.handleChange,i=e.options;return o.a.createElement("div",{className:"TextInput"},o.a.createElement("label",null,t,o.a.createElement("input",Object.assign({type:a,value:n},i,{onChange:r}))))},Bt=y.a.range(At.chainChannels).map(function(e){return Lt({index:e})});It.Transport.bpm.value=At.bpm,It.Transport.start(At.startOffset);var Vt=function(e){var t=e.phrases,n=e.selectedUi;return Object(F.a)({tempo:0,synth:0,notes:[]},y.a.get(t,[n.phrase],{}))},Wt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).keydown=n.keydown.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOctaveChange=n.handleOctaveChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleVolumeChange=n.handleVolumeChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleCloneChange=n.handleCloneChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleClear=n.handleClear.bind(Object(ee.a)(Object(ee.a)(n))),n.handleClone=n.handleClone.bind(Object(ee.a)(Object(ee.a)(n))),n.createSequence=n.createSequence.bind(Object(ee.a)(Object(ee.a)(n))),n.handleTempoChange=n.handleTempoChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleSynthChange=n.handleSynthChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handlePhraseIndexChange=n.handlePhraseIndexChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleNoteClick=n.handleNoteClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handleVolumeClick=n.handleVolumeClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handlePlay=n.handlePlay.bind(Object(ee.a)(Object(ee.a)(n))),n.drawCallback=n.drawCallback.bind(Object(ee.a)(Object(ee.a)(n))),n.state={isPlaying:!1,playingIndex:0,selectedCloneIndex:"",selectedOctave:3,selectedVolume:7,mode:"+"},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleOctaveChange",value:function(e){this.setState({selectedOctave:+e.target.value}),e.currentTarget.blur()}},{key:"handleVolumeChange",value:function(e){this.setState({selectedVolume:+e.target.value}),e.currentTarget.blur()}},{key:"handleCloneChange",value:function(e){this.setState({selectedCloneIndex:e.target.value}),e.currentTarget.blur()}},{key:"getValidClonePhraseKeys",value:function(){var e=this.props,t=e.selectedUi,n=e.phrases,a=t.phrase;return Object.entries(n).filter(function(e){var t=Object(Ze.a)(e,2),n=t[0];t[1];return+n!==+a}).map(function(e){var t=Object(Ze.a)(e,2),n=t[0];t[1];return n})}},{key:"handleClone",value:function(e){var t=this.props,n=t.selectedUi,a=t.phrases,r=t.updatePhrase,i=this.getValidClonePhraseKeys(),o=n.phrase,s=this.state.selectedCloneIndex,l=Vt(this.props);y.a.isEmpty(s)&&(s=i[0]),(y.a.isEmpty(l.notes)||window.confirm("Do you really want to clone phrase ".concat(s,"?")))&&r({phrase:a[s],index:o}),e.currentTarget.blur()}},{key:"handleClear",value:function(e){var t=this.props,n=t.updatePhrase,a=t.selectedUi.phrase;window.confirm("Do you really want to clear this phrase?")&&n({phrase:{tempo:0,synth:0,notes:[]},index:a}),e.currentTarget.blur()}},{key:"keydown",value:function(e){"Space"===e.code&&this.handlePlay()}},{key:"drawCallback",value:function(e){this.setState({playingIndex:e})}},{key:"componentDidMount",value:function(){It.context.resume();var e=Vt(this.props);this.sequence=this.createSequence(),this.sequence.playbackRate=Pt(e.tempo),window.addEventListener("keydown",this.keydown)}},{key:"createSequence",value:function(){var e=this;return new It.Sequence(function(t,n){var a=Vt(e.props),r=a.notes[n];r?(r.octave>-1&&_t(Object(F.a)({},r,{time:t,synth:Bt[a.synth]})),r.octave):Ft({time:t,synth:Bt[a.synth]}),It.Draw.schedule(function(){e.drawCallback(n)},t)},y.a.range(At.matrixLength),At.subdivision)}},{key:"handleSynthChange",value:function(e){var t=e.target,n=t.validity,a=t.value;if(n.valid){var r=this.props,i=r.updatePhrase,o=r.selectedUi.phrase,s=Vt(this.props),l=Object(F.a)({},s,{synth:a});Ft({synth:Bt[s.synth]}),i({phrase:l,index:o})}}},{key:"handleTempoChange",value:function(e){var t=e.target,n=t.validity,a=t.value;if(n.valid){this.sequence.playbackRate=Pt(a);var r=this.props,i=r.updatePhrase,o=r.selectedUi.phrase,s=Vt(this.props);i({phrase:Object(F.a)({},s,{tempo:a}),index:o})}}},{key:"handlePlay",value:function(){var e=this.state.isPlaying,t=Vt(this.props);e?(this.sequence.stop(),Ft({synth:Bt[t.synth]})):this.sequence.start(At.startOffset),this.setState({isPlaying:!e,playingIndex:0})}},{key:"handlePhraseIndexChange",value:function(e){var t=e.target,n=t.validity,a=t.value,r=Vt(this.props);if(n.valid){var i=this.props,o=i.selectUi,s=i.selectedUi;o(Object(F.a)({},s,{phrase:a})),Ft({synth:Bt[r.synth]})}}},{key:"handleVolumeClick",value:function(e){var t,n=this.props,a=n.updatePhrase,r=n.selectedUi.phrase,i=this.state.isPlaying,o=Vt(this.props),s=o.tempo,l=o.notes[e];if(l){var c=l.volume;t=c>0?Object(F.a)({},l,{volume:c-1}):null}else t={note:11,octave:At.octaves-1,volume:At.volumes-1};t&&!i&&t.octave>-1&&Ht(Object(F.a)({},t,{synth:Bt[o.synth],tempo:s})),a({phrase:Object(F.a)({},o,{notes:Object(F.a)({},o.notes,Object(p.a)({},e,t))}),index:r})}},{key:"handleNoteClick",value:function(e){var t,n=e.row,a=e.col,r=this.props,i=r.updatePhrase,o=r.selectedUi.phrase,s=this.state,l=s.isPlaying,c=s.mode,u=s.selectedOctave,h=s.selectedVolume,d=Vt(this.props),m=d.tempo,f=d.notes[a];if("-"===c)t=null;else{if(f){var g=f.note,b=f.octave;t=g!==n?Object(F.a)({},f,{note:n}):b>-1?Object(F.a)({},f,{octave:b-1}):null}else t={note:n,octave:u,volume:h};t&&!l&&t.octave>-1&&Ht(Object(F.a)({},t,{synth:Bt[d.synth],tempo:m}))}i({phrase:Object(F.a)({},d,{notes:Object(F.a)({},d.notes,Object(p.a)({},a,t))}),index:o})}},{key:"componentWillUnmount",value:function(){this.drawCallback=function(){},this.sequence.stop();var e=Vt(this.props);Ft({synth:Bt[e.synth]}),window.removeEventListener("keydown",this.keydown)}},{key:"componentDidUpdate",value:function(e){var t=Vt(e),n=Vt(this.props);e.selectedUi.phrase===this.props.selectedUi.phrase&&t.tempo===n.tempo||(this.sequence.playbackRate=Pt(n.tempo)),!y.a.isEmpty(t.notes)&&y.a.isEmpty(n.notes)&&this.setState({mode:"+"})}},{key:"render",value:function(){var e=this,t=this.props.selectedUi.phrase,n=this.state,a=n.isPlaying,r=n.playingIndex,i=n.selectedCloneIndex,s=n.mode,l=n.selectedOctave,c=n.selectedVolume,u=Vt(this.props),h=this.getValidClonePhraseKeys();return o.a.createElement("div",{className:"Phrase two-rows-and-grid"},o.a.createElement("div",{className:"main"},o.a.createElement("div",{className:"settings"},o.a.createElement("div",{className:"title"},"Phrase"),o.a.createElement(Gt,{label:"#",value:t.toString(),handleChange:this.handlePhraseIndexChange,type:"number",options:{min:0,max:At.phrases-1}}),o.a.createElement("div",{className:"title"},"Tempo"),o.a.createElement(Gt,{label:"#",value:u.tempo.toString(),handleChange:this.handleTempoChange,type:"number",options:{min:0,max:7}}),o.a.createElement("div",{className:"title"},"Synth"),o.a.createElement(Gt,{label:"#",value:u.synth.toString(),handleChange:this.handleSynthChange,type:"number",options:{min:0,max:3}})),o.a.createElement("div",{className:"matrix"},o.a.createElement("button",{className:E()("play button",{active:a}),onClick:this.handlePlay},a?"stop":"play"),o.a.createElement("table",{className:"notes"},o.a.createElement("tbody",null,y.a.range(11,-1).map(function(t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,U(t)),y.a.range(At.matrixLength).map(function(n){var i=u.notes[n],s=i&&i.note===t,l=11===t&&n===r&&a?o.a.createElement("span",{className:"highlight"}):null;return o.a.createElement("td",{key:n,onClick:function(){return e.handleNoteClick({row:t,col:n})},className:E()(Object(p.a)({match:s,highlight:n===r&&a},"octave-".concat(i&&i.octave),s))},l,o.a.createElement("button",null,s?i.octave>-1?i.octave:"-":" "))}))}))),o.a.createElement("table",{className:"volumes"},o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("td",null,"v"),y.a.range(At.matrixLength).map(function(t){var n=u.notes[t],i=t===r&&a?o.a.createElement("span",{className:"highlight"}):null;return o.a.createElement("td",{key:t,className:E()(Object(p.a)({highlight:t===r&&a},"volume-".concat(n&&n.volume),n)),onClick:function(){return e.handleVolumeClick(t)}},i,o.a.createElement("button",null,n&&n.volume))}))))),o.a.createElement("div",{className:"tools"},o.a.createElement("div",null,o.a.createElement("button",{className:"button",disabled:y.a.isEmpty(u.notes),onClick:this.handleClear},"clear")),o.a.createElement("div",{className:"clone"},o.a.createElement("button",{disabled:y.a.isEmpty(h),className:"button",onClick:this.handleClone},"clone"),o.a.createElement("select",{value:i,onChange:this.handleCloneChange},h.map(function(e){return o.a.createElement("option",{key:e,value:e},e)}))),o.a.createElement("div",{className:"selected"},o.a.createElement("span",{className:"title"},"octave"),o.a.createElement("select",{value:l,onChange:this.handleOctaveChange},y.a.range(3,-2,-1).map(function(e){return o.a.createElement("option",{key:e,value:e},-1===e?"-":e)}))),o.a.createElement("div",{className:"selected"},o.a.createElement("span",{className:"title"},"volume"),o.a.createElement("select",{value:c,onChange:this.handleVolumeChange},y.a.range(7,-1).map(function(e){return o.a.createElement("option",{key:e,value:e},e)}))),o.a.createElement("div",{className:"add-delete"},o.a.createElement("button",{className:E()("button",{active:"+"===s}),onClick:function(){e.setState({mode:"+"})}},"+"),o.a.createElement("button",{disabled:y.a.isEmpty(u.notes),className:E()("button",{active:"-"===s}),onClick:function(){e.setState({mode:"-"})}},"-")))))}}]),t}(i.Component),qt=Object(l.b)(function(e){return{phrases:e.phrases,selectedUi:e.selectedUi}},function(e){return{selectUi:function(t){return e(K.selectUi(t))},updatePhrase:function(t){var n=t.phrase,a=t.index;return e(K.updatePhrase({phrase:n,index:a}))}}})(Wt),Xt=y.a.range(At.chainChannels).map(function(e){return Lt({index:e})});It.Transport.bpm.value=At.bpm,It.Transport.start(At.startOffset);var Jt=function(e){return!y.a.intersection(Object.keys(e),y.a.range(At.matrixLength).map(function(e){return e.toString()})).length},Yt=function(e){var t=e.chains,n=e.selectedUi;return Object(F.a)({tempo:0},y.a.get(t,[n.chain],{}))},zt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).keydown=n.keydown.bind(Object(ee.a)(Object(ee.a)(n))),n.handleClear=n.handleClear.bind(Object(ee.a)(Object(ee.a)(n))),n.handleSelectedPhraseChange=n.handleSelectedPhraseChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleCloneChange=n.handleCloneChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleClone=n.handleClone.bind(Object(ee.a)(Object(ee.a)(n))),n.handleTempoChange=n.handleTempoChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleChainIndexChange=n.handleChainIndexChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handlePhraseClick=n.handlePhraseClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handlePlay=n.handlePlay.bind(Object(ee.a)(Object(ee.a)(n))),n.drawCallback=n.drawCallback.bind(Object(ee.a)(Object(ee.a)(n))),n.state={isPlaying:!1,playingIndex:0,selectedCloneIndex:"",selectedPhraseIndex:"",mode:"+"},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleSelectedPhraseChange",value:function(e){this.setState({selectedPhraseIndex:e.target.value}),e.currentTarget.blur()}},{key:"handleCloneChange",value:function(e){this.setState({selectedCloneIndex:e.target.value}),e.currentTarget.blur()}},{key:"getValidCloneChainKeys",value:function(){var e=this.props,t=e.selectedUi,n=e.chains,a=t.chain;return Object.keys(n).filter(function(e){return+e!==+a})}},{key:"handleClone",value:function(e){var t=this.props,n=t.selectedUi,a=t.chains,r=t.updateChain,i=this.getValidCloneChainKeys(),o=n.chain,s=this.state.selectedCloneIndex,l=Yt(this.props);y.a.isEmpty(s)&&(s=i[0]),(Jt(l)||window.confirm("Do you really want to clone phrase ".concat(s,"?")))&&r({chain:a[s],index:o}),e.currentTarget.blur()}},{key:"handleClear",value:function(e){var t=this.props,n=t.updateChain,a=t.selectedUi.chain;window.confirm("Do you really want to clear this chain?")&&n({chain:null,index:a}),e.currentTarget.blur()}},{key:"drawCallback",value:function(e){this.setState({playingIndex:e})}},{key:"componentDidMount",value:function(){var e=this;It.context.resume();var t=this.props.phrases,n=Yt(this.props);this.sequence=new It.Sequence(function(n,a){var r=Yt(e.props),i=y.a.padStart(a.toString(At.matrixLength),2,0).split("").map(function(e){return parseInt(e,At.matrixLength)}),o=Object(Ze.a)(i,2),s=o[0],l=o[1],c=y.a.get(r,s);y.a.range(At.chainChannels).forEach(function(e){var a=y.a.get(c,e);if(y.a.isNil(a))Ft({time:n,synth:Xt[e]});else{var r=y.a.get(t,a,{}),i=y.a.get(r.notes,l);y.a.isNil(i)?Ft({time:n,synth:Xt[e]}):(i.octave>-1&&_t(Object(F.a)({},i,{time:n,synth:Xt[e]})),i.octave)}}),It.Draw.schedule(function(){e.drawCallback(s)},n)},y.a.range(Math.pow(At.matrixLength,2)),At.subdivision),this.sequence.playbackRate=Pt(n.tempo),window.addEventListener("keydown",this.keydown)}},{key:"keydown",value:function(e){"Space"===e.code&&this.handlePlay(e)}},{key:"handleTempoChange",value:function(e){var t=e.target,n=t.validity,a=t.value;if(n.valid){this.sequence.playbackRate=Pt(a);var r=this.props,i=r.updateChain,o=r.selectedUi,s=Yt(this.props),l=y.a.cloneDeep(s);l.tempo=a,i({chain:l,index:o.chain})}}},{key:"handlePlay",value:function(e){var t=this.state.isPlaying;t?(this.sequence.stop(),Xt.forEach(function(e){return Ft({synth:e})})):this.sequence.start(At.startOffset),this.setState({isPlaying:!t,playingIndex:0}),e.currentTarget.blur()}},{key:"handleChainIndexChange",value:function(e){var t=e.target,n=t.validity,a=t.value;if(n.valid){var r=this.props,i=r.selectUi,o=r.selectedUi;i(Object(F.a)({},o,{chain:a}))}}},{key:"handlePhraseClick",value:function(e){var t=e.channel,n=e.col,a=e.e,r=this.props,i=r.phrases,o=r.updateChain,s=r.selectedUi,l=this.state,c=l.selectedPhraseIndex,u=l.mode,h=s.chain,d=Yt(this.props),m=y.a.cloneDeep(d),p=y.a.get(m,[n,t]),f=y()(Object.keys(i)).sortBy(function(e){return+e}).uniq().map(function(e){return+e}).value();if("-"===u)p=null;else if(y.a.isNil(p))p=y.a.isEmpty(c)?f[0]:c;else{var g=y.a.indexOf(f,+p);p=0===g?null:f[g-1]}y.a.setWith(m,[n,t],p,Object),o({chain:m,index:h}),a.currentTarget.blur()}},{key:"componentWillUnmount",value:function(){this.drawCallback=function(){},this.sequence.stop(),Xt.forEach(function(e){return Ft({synth:e})}),window.removeEventListener("keydown",this.keydown)}},{key:"componentDidUpdate",value:function(e){var t=Yt(e),n=Yt(this.props);e.selectedUi.chain===this.props.selectedUi.chain&&t.tempo===n.tempo||(this.sequence.playbackRate=Pt(n.tempo)),!Jt(t)&&Jt(n)&&this.setState({mode:"+"})}},{key:"render",value:function(){var e=this,t=this.props,n=t.selectedUi,a=t.phrases,r=n.chain,i=this.state,s=i.isPlaying,l=i.playingIndex,c=i.selectedCloneIndex,u=i.selectedPhraseIndex,h=i.mode,d=Yt(this.props),m=this.getValidCloneChainKeys();return o.a.createElement("div",{className:"Chain two-rows-and-grid"},o.a.createElement("div",{className:"main"},o.a.createElement("div",{className:E()("warning",{hide:!y.a.isEmpty(a)})},"error: no phrases found"),o.a.createElement("div",{className:E()("settings",{hide:y.a.isEmpty(a)})},o.a.createElement("div",{className:"title"},"Chain"),o.a.createElement(Gt,{label:"#",value:r.toString(),handleChange:this.handleChainIndexChange,type:"number",options:{min:0,max:At.chains-1}}),o.a.createElement("div",{className:"title"},"Tempo"),o.a.createElement(Gt,{label:"#",value:d.tempo.toString(),handleChange:this.handleTempoChange,type:"number",options:{min:0,max:7}})),o.a.createElement("div",{className:E()("matrix",{hide:y.a.isEmpty(a)})},o.a.createElement("button",{className:E()("play button",{active:s}),onClick:this.handlePlay},s?"stop":"play"),o.a.createElement("table",{className:"phrases"},o.a.createElement("tbody",null,y.a.range(At.chainChannels).map(function(t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,t),y.a.range(At.matrixLength).map(function(n){var a=y.a.get(d,[n,t]),r=0===t&&n===l&&s?o.a.createElement("span",{className:"highlight"}):null;return o.a.createElement("td",{key:n,className:E()({highlight:n===l&&s&&!y.a.isNil(a)}),onClick:function(a){return e.handlePhraseClick({channel:t,col:n,e:a})}},r,o.a.createElement("button",null,o.a.createElement("span",null,y.a.isNil(a)?"":y.a.padStart(a,2,0))))}))})))),o.a.createElement("div",{className:"tools"},o.a.createElement("div",null,o.a.createElement("button",{className:"button",disabled:Jt(d),onClick:this.handleClear},"clear")),o.a.createElement("div",{className:"clone"},o.a.createElement("button",{disabled:y.a.isEmpty(m),className:"button",onClick:this.handleClone},"clone"),o.a.createElement("select",{value:c,onChange:this.handleCloneChange},m.map(function(e){return o.a.createElement("option",{key:e,value:e},e)}))),o.a.createElement("div",{className:"selected"},o.a.createElement("span",{className:"title"},"phrase"),o.a.createElement("select",{value:u,onChange:this.handleSelectedPhraseChange},Object.keys(a).map(function(e){return o.a.createElement("option",{key:e,value:e},e)}))),o.a.createElement("div",{className:"add-delete"},o.a.createElement("button",{className:E()("button",{active:"+"===h}),onClick:function(){e.setState({mode:"+"})}},"+"),o.a.createElement("button",{className:E()("button",{active:"-"===h}),onClick:function(){e.setState({mode:"-"})}},"-")))))}}]),t}(i.Component),Kt=Object(l.b)(function(e){return{chains:e.chains,phrases:e.phrases,selectedUi:e.selectedUi}},function(e){return{selectUi:function(t){return e(K.selectUi(t))},updateChain:function(t){var n=t.chain,a=t.index;return e(K.updateChain({chain:n,index:a}))}}})(zt),Qt=y.a.range(At.chainChannels).map(function(e){return Lt({index:e})});It.Transport.bpm.value=At.bpm,It.Transport.start(At.startOffset);var Zt=function(e){var t=e.songs,n=e.selectedUi;return Object(F.a)({tempo:0},y.a.get(t,[n.song],{}))},$t=function(e){return!y.a.intersection(Object.keys(e),y.a.range(At.matrixLength).map(function(e){return e.toString()})).length},en=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleClear=n.handleClear.bind(Object(ee.a)(Object(ee.a)(n))),n.keydown=n.keydown.bind(Object(ee.a)(Object(ee.a)(n))),n.handleTempoChange=n.handleTempoChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleSongIndexChange=n.handleSongIndexChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleChainClick=n.handleChainClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handlePlay=n.handlePlay.bind(Object(ee.a)(Object(ee.a)(n))),n.drawCallback=n.drawCallback.bind(Object(ee.a)(Object(ee.a)(n))),n.state={isPlaying:!1,playingIndex:0},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleClear",value:function(e){e.currentTarget.blur();var t=this.props,n=t.updateSong,a=t.selectedUi.song;window.confirm("Do you really want to clear this song?")&&n({song:{tempo:0},index:a})}},{key:"drawCallback",value:function(e){this.setState({playingIndex:e})}},{key:"componentDidMount",value:function(){var e=this;It.context.resume();var t=this.props,n=t.chains,a=t.phrases,r=Zt(this.props);this.sequence=new It.Sequence(function(t,r){var i=Zt(e.props),o=y.a.padStart(r.toString(At.matrixLength),3,0).split("").map(function(e){return parseInt(e,At.matrixLength)}),s=Object(Ze.a)(o,3),l=s[0],c=s[1],u=s[2],h=y.a.get(i,l),d=y.a.get(n,h),m=y.a.get(d,c);y.a.range(At.chainChannels).forEach(function(e){var n=y.a.get(m,e);if(y.a.isNil(n))Ft({time:t,synth:Qt[e]});else{var r=y.a.get(a,n,{}),i=y.a.get(r.notes,u);y.a.isNil(i)?Ft({time:t,synth:Qt[e]}):(i.octave>-1&&_t(Object(F.a)({},i,{time:t,synth:Qt[e]})),i.octave)}}),It.Draw.schedule(function(){e.drawCallback(l)},t)},y.a.range(Math.pow(At.matrixLength,3)),At.subdivision),this.sequence.playbackRate=Pt(r.tempo),window.addEventListener("keydown",this.keydown)}},{key:"handleTempoChange",value:function(e){var t=e.target,n=t.validity,a=t.value;if(n.valid){this.sequence.playbackRate=Pt(a);var r=this.props,i=r.updateSong,o=r.selectedUi,s=Zt(this.props);i({song:Object(F.a)({},s,{tempo:a}),index:o.song})}}},{key:"handlePlay",value:function(){var e=this.state.isPlaying;e?(this.sequence.stop(),Qt.forEach(function(e){return Ft({synth:e})})):this.sequence.start(At.startOffset),this.setState({isPlaying:!e,playingIndex:0})}},{key:"handleSongIndexChange",value:function(e){var t=e.target,n=t.validity,a=t.value;if(n.valid){var r=this.props,i=r.selectUi,o=r.selectedUi;i(Object(F.a)({},o,{song:a}))}}},{key:"handleChainClick",value:function(e){var t=e.col,n=this.props,a=n.chains,r=n.updateSong,i=n.selectedUi.song,o=Zt(this.props),s=y.a.get(o,t),l=y()(Object.keys(a)).sortBy(function(e){return+e}).uniq().map(function(e){return+e}).value();if(y.a.isNil(s))s=y.a.last(l);else{var c=y.a.indexOf(l,s);s=0===c?null:l[c-1]}r({song:Object(F.a)({},o,Object(p.a)({},t,s)),index:i})}},{key:"keydown",value:function(e){"Space"===e.code&&this.handlePlay()}},{key:"componentWillUnmount",value:function(){this.drawCallback=function(){},this.sequence.stop(),Qt.forEach(function(e){return Ft({synth:e})}),window.removeEventListener("keydown",this.keydown)}},{key:"componentDidUpdate",value:function(e){var t=Zt(e),n=Zt(this.props);e.selectedUi.song===this.props.selectedUi.song&&t.tempo===n.tempo||(this.sequence.playbackRate=Pt(n.tempo))}},{key:"render",value:function(){var e=this,t=this.props.selectedUi.song,n=this.state,a=n.isPlaying,r=n.playingIndex,i=Zt(this.props),s=this.props.chains;return o.a.createElement("div",{className:"Song two-rows-and-grid"},o.a.createElement("div",{className:"main"},o.a.createElement("div",{className:E()("warning",{hide:!y.a.isEmpty(s)})},"error: no chains found"),o.a.createElement("div",{className:E()("settings",{hide:y.a.isEmpty(s)})},o.a.createElement("div",{className:"title"},"Song"),o.a.createElement(Gt,{label:"#",value:t.toString(),handleChange:this.handleSongIndexChange,type:"number",options:{min:0,max:At.songs-1}}),o.a.createElement("div",{className:"title"},"Tempo"),o.a.createElement(Gt,{label:"#",value:i.tempo.toString(),handleChange:this.handleTempoChange,type:"number",options:{min:0,max:7}})),o.a.createElement("div",{className:E()("matrix",{hide:y.a.isEmpty(s)})},o.a.createElement("button",{className:E()("play button",{active:a}),onClick:this.handlePlay},a?"stop":"play"),o.a.createElement("table",{className:"songs"},o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("td",null,"c"),y.a.range(At.matrixLength).map(function(t){var n=y.a.get(i,t),s=t===r&&a?o.a.createElement("span",{className:"highlight"}):null;return o.a.createElement("td",{key:t,className:E()({highlight:t===r&&a&&!y.a.isNil(n)}),onClick:function(){return e.handleChainClick({col:t})}},s,o.a.createElement("button",null,o.a.createElement("span",null,y.a.isNil(n)?"":y.a.padStart(n,2,0))))}))))),o.a.createElement("div",{className:"tools"},o.a.createElement("div",null,o.a.createElement("button",{className:"button",disabled:$t(i),onClick:this.handleClear},"clear")))))}}]),t}(i.Component),tn=Object(l.b)(function(e){return{songs:e.songs,chains:e.chains,phrases:e.phrases,selectedUi:e.selectedUi}},function(e){return{selectUi:function(t){return e(K.selectUi(t))},updateSong:function(t){var n=t.song,a=t.index;return e(K.updateSong({song:n,index:a}))}}})(en),nn=n(121),an=n.n(nn),rn=n(122),on=n.n(rn),sn=function(e){var t=e.slides,n=e.index;return t.slice(0,n+1).map(function(e){return e.game}).reduce(function(e,t){if(t&&t.length){var n=e.split("\n"),a=t.match(/^DEL(\d+)$/),r=t.match(/^DEL(\d+)-(\d+)$/),i=t.match(/^REP(\d+)/),o=t.match(/^REP(\d+)-(\d+)/),s=t.match(/^ADD(\d+)/),l=t.match(/^SAME$/);if(a){var c=+a[1];return[].concat(Object(B.a)(n.slice(0,c)),Object(B.a)(n.slice(c+1))).join("\n")}if(r){var u=+r[1],h=+r[2];return[].concat(Object(B.a)(n.slice(0,u)),Object(B.a)(n.slice(h+1))).join("\n")}if(o){var d=+o[1],m=+o[2];return[].concat(Object(B.a)(n.slice(0,d)),Object(B.a)(t.substring(o[0].length+1).split("\n")),Object(B.a)(n.slice(m+1))).join("\n")}if(i){var p=+i[1];return[].concat(Object(B.a)(n.slice(0,p)),Object(B.a)(t.substring(i[0].length+1).split("\n")),Object(B.a)(n.slice(p+1))).join("\n")}if(s){var f=+s[1];return[].concat(Object(B.a)(n.slice(0,f)),Object(B.a)(t.substring(s[0].length+1).split("\n")),Object(B.a)(n.slice(f))).join("\n")}return l?e:t}return e},"")},ln=n(29),cn=function(e){var t=e.requirements,n=e.props;return on()(t,function(e,t){return n[t]===e})},un=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleClose=n.handleClose.bind(Object(ee.a)(Object(ee.a)(n))),n.handlePrevious=n.handlePrevious.bind(Object(ee.a)(Object(ee.a)(n))),n.handleNextSlide=n.handleNextSlide.bind(Object(ee.a)(Object(ee.a)(n))),n.handleNextLesson=n.handleNextLesson.bind(Object(ee.a)(Object(ee.a)(n))),n.handleSlide=n.handleSlide.bind(Object(ee.a)(Object(ee.a)(n))),n.fireActions=n.fireActions.bind(Object(ee.a)(Object(ee.a)(n))),n.buttonsElement=null,n.setButtonsRef=function(e){n.buttonsElement=e},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"fireActions",value:function(e){var t=e.lessonIndex,n=e.slideIndex,a=this.props,r=a.setScreen,i=a.updateGame,o=a.updateSprite,s=a.updateMap,l=a.screen,c=a.setCodeTab,u=ln[t].slides,h=u[n],d=h.screen,m=h.game,p=h.sprites,f=h.map;if(!Object(v.isNil)(m)){var g=sn({slides:u,index:n});l!==k.CODE?i({tab:0,content:g}):i({tab:0,content:"SCRIPT-8 LESSON".concat(g)})}if(p&&p.forEach(function(e){var t=e.array,n=e.index;return o({sprite:t,index:n})}),f){var b=Nt.createBlankMap();f.forEach(function(e){var t=e.split("-"),n=Object(Ze.a)(t,3),a=n[0],r=n[1],i=n[2];b[+a][+r]=i?+i:null}),s(b)}d&&(r(d),d===k.CODE&&c(0))}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,a=n.tutorial,r=n.screen,i=a.lessonIndex,o=a.slideIndex,s=ln[i].slides[o].requirements;s&&(cn({requirements:s,props:e})||cn({requirements:s,props:this.props})&&this.handleNextSlide()),r===k.RUN&&this.buttonsElement.scrollIntoView()}},{key:"handleClose",value:function(){this.props.closeTutorial()}},{key:"handleSlide",value:function(e){var t=e.lessonIndex,n=e.slideIndex;this.props.setTutorialSlide({lessonIndex:t,slideIndex:n}),this.fireActions({lessonIndex:t,slideIndex:n})}},{key:"handleNextLesson",value:function(){var e=this.props.tutorial.lessonIndex;this.handleSlide({lessonIndex:e+1,slideIndex:0})}},{key:"handleNextSlide",value:function(){var e=this.props.tutorial,t=e.lessonIndex,n=e.slideIndex;ln[t].slides[n].newGameOnNext&&this.props.newGame(this.props.screen),this.handleSlide({lessonIndex:t,slideIndex:n+1})}},{key:"handlePrevious",value:function(){var e=this.props.tutorial,t=e.lessonIndex,n=e.slideIndex;this.handleSlide({lessonIndex:t,slideIndex:n-1})}},{key:"render",value:function(){var e=this.props,t=e.tutorial,n=e.screen,a=e.tutorialRef,r=t.lessonIndex,i=t.slideIndex,s=ln[r],l=s.title,c=s.slides,u=c[i],h=u.requirements,d=o.a.createElement("button",{className:"button",onClick:this.handleClose},"close"),m=!h||cn({requirements:h,props:this.props}),p=i<c.length-1?o.a.createElement("button",{className:"button",disabled:!m,onClick:this.handleNextSlide},"next"):null,f=i===c.length-1&&r<ln.length-1?o.a.createElement("button",{className:"button",onClick:this.handleNextLesson},"next lesson"):null,g=i>0?o.a.createElement("button",{className:"button",onClick:this.handlePrevious},"previous"):null,b=o.a.createElement("div",{className:"buttons",ref:this.setButtonsRef},g,f,p,d),v=0===i?0===r?o.a.createElement("p",null,l):o.a.createElement("p",null,"Lesson ",r,": ",l):null,y=an()(c.length).map(function(e){return e===i?"|":"."}).join("");return o.a.createElement("div",{className:E()("Tutorial",{"in-run":n===k.RUN}),ref:a},v,u.text.map(function(e,t){return o.a.createElement("p",{key:t,className:E()({code:e.startsWith("XX")}),dangerouslySetInnerHTML:{__html:e.replace(/^XX/,"")}})}),o.a.createElement("div",{className:"bottom-bar"},b,o.a.createElement("p",null,y)))}}]),t}(i.Component),hn=Object(l.b)(function(e){return{screen:e.screen,tutorial:e.tutorial,game:e.game}},function(e){return{setCodeTab:function(t){return e(K.setCodeTab(t))},newGame:function(){return e(K.newGame())},updateMap:function(t){return e(K.updateMap(t))},setScreen:function(t){return e(K.setScreen(t))},closeTutorial:function(){return e(K.closeTutorial())},updateGame:function(t){var n=t.tab,a=t.content;return e(K.updateGame({tab:n,content:a}))},updateSprite:function(t){var n=t.sprite,a=t.index;return e(K.updateSprite({sprite:n,index:a}))},setTutorialSlide:function(t){var n=t.lessonIndex,a=t.slideIndex;return e(K.setTutorialSlide({lessonIndex:n,slideIndex:a}))}}})(un),dn=n(60),mn=n.n(dn),pn=n(123),fn=n.n(pn),gn=n(124),bn=n.n(gn),En={tab:function(e){var t=Array(e.getOption("indentUnit")+1).join(" ");e.replaceSelection(t)},comment:function(e){e.toggleComment()},format:function(e,t){var n=e.getValue(),a=e.indexFromPos(e.getCursor()),r=fn.a.formatWithCursor(n,function(e){return{parser:"babel",plugins:{babel:bn.a},cursorOffset:e,semi:!1,singleQuote:!0}}(a)),i=r.formatted,o=r.cursorOffset;t(i);var s=e.posFromIndex(o);e.setCursor(s)}},vn=window.navigator.platform,yn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).sliderMark=null,n.hoverMark=null,n.setContents=n.setContents.bind(Object(ee.a)(Object(ee.a)(n))),n.handleSlider=n.handleSlider.bind(Object(ee.a)(Object(ee.a)(n))),n.activateSlider=n.activateSlider.bind(Object(ee.a)(Object(ee.a)(n))),n.hideSlider=n.hideSlider.bind(Object(ee.a)(Object(ee.a)(n))),n.highlightText=n.highlightText.bind(Object(ee.a)(Object(ee.a)(n))),n.mouseMove=n.mouseMove.bind(Object(ee.a)(Object(ee.a)(n))),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;Xe();var t=J(this.props.game);this.codeMirror=window.CodeMirror(this._editor,{value:t.text||"",mode:"javascript",theme:"nyx8",lint:!0,lineNumbers:!0,tabSize:2,cursorBlinkRate:0,scrollbarStyle:null,extraKeys:{Tab:En.tab,"Cmd-/":En.comment,"Ctrl-/":En.comment,"Alt-F":function(t){return En.format(t,e.setContents)},Esc:"clearSearch"}});var n=mn()(this.props.docHistories,"[".concat(t.key,"]"),null);n?this.codeMirror.getDoc().setHistory(n):this.codeMirror.getDoc().clearHistory(),this.codeMirror.on("change",function(t){var n=t.getValue();document.querySelector("#highlighter-box").classList.add("hide"),e.props.updateContent(n)}),this.codeMirror.on("keydown",function(t,n){g()(vn,"Mac")?"Meta"===n.key&&e.activateSlider():"Shift"===n.key&&e.activateSlider()}),window.addEventListener("keyup",this.hideSlider);var a=t.scrollData;a&&(this.codeMirror.scrollTo(a.left||0,a.top||0),this.codeMirror.setCursor(a.cursorPosition)),this.codeMirror.focus()}},{key:"hideSlider",value:function(){this.sliderMark&&this.sliderMark.clear(),this._slider.classList.add("hide")}},{key:"highlightText",value:function(e){var t=this,n=e.split("-").map(function(e){return+e}),a=n[0],r=n[n.length-1],i=n.map(function(e){return t.codeMirror.getLine(e)}),o=i[0].search(/\S/),s=(Math.max.apply(Math,Object(B.a)(i.map(function(e){return e.length})))-o+1)*this.codeMirror.defaultCharWidth(),l=this.codeMirror.defaultTextHeight()*(1+r-a);document.querySelector("#highlighter-box").classList.remove("hide"),this.codeMirror.addWidget({line:a,ch:o},document.querySelector("#highlighter-box"),!1),this._highlighterBox.style.width="".concat(s+8,"px"),this._highlighterBox.style.height="".concat(l+6,"px"),this.codeMirror.scrollIntoView({line:r,ch:0},40)}},{key:"activateSlider",value:function(){var e=this.codeMirror.getCursor(),t=this.codeMirror.getTokenAt(Object(F.a)({},e,{ch:e.ch+1}));if(t&&"number"===t.type){this.sliderMark&&this.sliderMark.clear(),this.sliderMark=this.codeMirror.markText({line:e.line,ch:t.start},{line:e.line,ch:t.end},{className:"slider-token"});var n=this.codeMirror.charCoords({line:e.line,ch:t.start}),a=this._wrapper.getBoundingClientRect(),r=t.string,i=+r;i>=-127&&i<=127?(this._slider.min=-127,this._slider.max=127,this._slider.value=i):(this._slider.min=2*-i,this._slider.max=2*i,this._slider.value=i),this._slider.style.left="".concat(n.left-a.left+r.length*this.codeMirror.defaultCharWidth()/2,"px"),this._slider.style.top="".concat(n.top-a.top-this.codeMirror.defaultTextHeight(),"px"),this._slider.classList.remove("hide")}}},{key:"handleSlider",value:function(e){var t=this.sliderMark.find(),n=t.from,a=t.to,r=e.target.value.toString();this.codeMirror.replaceRange(r,n,a),this.sliderMark=this.codeMirror.markText(n,Object(F.a)({},n,{ch:n.ch+r.length}),{className:"slider-token"})}},{key:"setContents",value:function(e){this.codeMirror.setValue(e),this.codeMirror.refresh()}},{key:"componentWillReceiveProps",value:function(e){var t=this;if("SCRIPT-8 NEW"===e.game[0].text)this.setContents(R),this.codeMirror.getDoc().clearHistory();else if(e.game[0].text.startsWith("SCRIPT-8 LESSON")){this.setContents(e.game[0].text.replace("SCRIPT-8 LESSON",""));var n=e.tutorial;if(n){var a=ln[n.lessonIndex].slides[n.slideIndex];a&&a.linesToHighlight&&(this._highlighterBox.classList.remove("hide"),this.highlightText(a.linesToHighlight))}}else if(J(this.props.game).key!==J(e.game).key){this.props.updateHistory({index:J(this.props.game).key,history:this.codeMirror.getDoc().getHistory()});var r=this.codeMirror.getScrollInfo(),i=this.codeMirror.getCursor();this.props.setScrollData({scrollData:{top:r.top,left:r.left,cursorPosition:i},tab:J(this.props.game).key}),this.setContents(J(e.game).text||"");var o=mn()(this.props.docHistories,"[".concat(J(e.game).key,"]"),null);o?this.codeMirror.getDoc().setHistory(o):this.codeMirror.getDoc().clearHistory();var s=J(e.game).scrollData;s&&(this.codeMirror.scrollTo(s.left||0,s.top||0),this.codeMirror.setCursor(s.cursorPosition)),this.codeMirror.focus()}if(JSON.stringify(e.errorLine)!==JSON.stringify(this.props.errorLine)&&!Object(v.isNil)(e.errorLine)){var l,c,u=function(){return t.codeMirror.getValue()===J(t.props.game).text},h=function(){t.highlightText(e.errorLine.line.toString())};u()?h():(c=0,l=setInterval(function(){u()?(clearInterval(l),h()):c>=7&&clearInterval(l),c++},250))}}},{key:"mouseMove",value:function(e){var t,n=this,a=J(this.props.game),r=function(){n.props.clearCallUnderMouse({tab:a.key})};if(e.ctrlKey){var i=this.codeMirror.coordsChar({left:e.pageX,top:e.pageY});if(i.outside)r();else{var o=null,s=1/0;try{Object(Ge.a)(Object(xe.a)(a.text,{locations:!0}),{CallExpression:function(e){if(!i.outside&&i.line+1>=e.loc.start.line&&i.line+1<=e.loc.end.line&&i.ch>=e.loc.start.column&&i.ch<=e.loc.end.column){var t=e.end-e.start;(!o||t<s)&&(o=e,s=t)}}})}catch(l){}this.hoverMark&&this.hoverMark.clear(),o&&(this.hoverMark=this.codeMirror.markText({line:o.loc.start.line-1,ch:o.loc.start.column},{line:o.loc.end.line-1,ch:o.loc.end.column},{className:"slider-token"})),t=o,n.props.setCallUnderMouse({tab:a.key,callUnderMouse:t})}}else r(),this.hoverMark&&this.hoverMark.clear()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keyup",this.hideSlider);var e=J(this.props.game),t=this.codeMirror.getScrollInfo(),n=this.codeMirror.getCursor(),a={top:t.top,left:t.left,cursorPosition:n};this.props.setScrollData({scrollData:a,tab:e.key}),this.props.updateHistory({index:e.key,history:this.codeMirror.getDoc().getHistory()})}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"CodeEditor",onMouseMove:this.mouseMove},o.a.createElement("div",{className:"wrapper",ref:function(t){e._wrapper=t}},o.a.createElement("div",{className:"_editor",ref:function(t){e._editor=t}}),o.a.createElement("input",{type:"range",className:"slider hide",step:1,ref:function(t){e._slider=t},onInput:this.handleSlider}),o.a.createElement("div",{id:"highlighter-box",ref:function(t){e._highlighterBox=t}})))}}]),t}(i.Component),On=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleTabUpdates=n.handleTabUpdates.bind(Object(ee.a)(Object(ee.a)(n))),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleTabUpdates",value:function(e){var t=J(this.props.game).key;this.props.updateGame({tab:t,content:e})}},{key:"render",value:function(){var e=this.props,t=e.game,n=e.tutorial,a=e.setScrollData,r=e.setCallUnderMouse,i=e.clearCallUnderMouse,s=e.docHistories,l=e.updateHistory,c=e.errorLine;return o.a.createElement("div",{className:E()("Code two-rows-and-grid",{tutorial:!1!==n})},o.a.createElement("div",{className:"main"},o.a.createElement(yn,{errorLine:c,game:t,updateContent:this.handleTabUpdates,setScrollData:a,setCallUnderMouse:r,clearCallUnderMouse:i,docHistories:s,updateHistory:l,tutorial:n})))}}]),t}(i.Component),Sn=Object(l.b)(function(e){return{game:e.game,tutorial:e.tutorial,docHistories:e.docHistories,errorLine:e.errorLine}},function(e){return{updateGame:function(t){var n=t.tab,a=t.content;return e(K.updateGame({tab:n,content:a}))},setScrollData:function(t){var n=t.tab,a=t.scrollData;return e(K.setScrollData({tab:n,scrollData:a}))},updateHistory:function(t){var n=t.index,a=t.history;return e(K.updateHistory({index:n,history:a}))},setCallUnderMouse:function(t){var n=t.tab,a=t.callUnderMouse;return e(K.setCallUnderMouse({tab:n,callUnderMouse:a}))},clearCallUnderMouse:function(t){var n=t.tab;return e(K.clearCallUnderMouse({tab:n}))}}})(On),Cn=n(125),wn=n(126),kn=n(127),xn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleLesson=n.handleLesson.bind(Object(ee.a)(Object(ee.a)(n))),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleLesson",value:function(e){this.props.setLessonIndex(e)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"Help"},o.a.createElement("div",{className:"main"},o.a.createElement("ul",{className:"top-list"},o.a.createElement("li",null,"SCRIPT-8 is written by Gabriel Florit (that's me!) and"," ",o.a.createElement("a",{className:"text",href:"https://github.com/script-8/script-8.github.io/graphs/contributors"},"dedicated contributors"),". Do you have a question? Or perhaps you found a bug? Tweet me at"," ",o.a.createElement("a",{className:"text",href:"https://twitter.com/gabrielflorit"},"@gabrielflorit")," ","and I'll be glad to help out. And visit the Github repository"," ",o.a.createElement("a",{className:"text",href:"https://github.com/script-8/script-8.github.io"},"here"),", where you can keep up with new features and the occasional bug fix."),o.a.createElement("li",null,"If you have any further questions, come join us on the"," ",o.a.createElement("a",{className:"text",href:"https://discord.gg/HA68FNX"},"Fantasy Consoles Discord server"),", a friendly place to chat about these sophisticated, cutting-edge computers. The server has a dedicated SCRIPT-8 room."),o.a.createElement("li",null,"Lessons",o.a.createElement("ul",{className:"lessons"},ln.map(function(t,n){return o.a.createElement("li",{key:n},o.a.createElement("button",{className:"button",onClick:function(){e.handleLesson(n)}},n," - ",t.shortTitle||t.title))})))),o.a.createElement("ul",{className:"top-list how"},o.a.createElement("li",null,"FAQ",o.a.createElement("dl",null,wn.map(function(e,t){var n=Object(Ze.a)(e,2),a=n[0],r=n[1];return o.a.createElement(i.Fragment,{key:t},o.a.createElement("dt",null,a),o.a.createElement("dd",{dangerouslySetInnerHTML:{__html:r}}))})))),o.a.createElement("ul",{className:"top-list"},o.a.createElement("li",null,"Keyboard shortcuts",o.a.createElement("dl",null,kn.map(function(e,t){var n=Object(Ze.a)(e,2),a=n[0],r=n[1];return o.a.createElement(i.Fragment,{key:t},o.a.createElement("dt",null,a),o.a.createElement("dd",{dangerouslySetInnerHTML:{__html:r}}))})))),o.a.createElement("ul",{className:"top-list"},o.a.createElement("li",null,"API documentation",o.a.createElement("ul",{className:"second-list"},Cn.map(function(e,t){return o.a.createElement("li",{key:t},e.title,e.note?o.a.createElement("span",null," (",e.note,")"):null,o.a.createElement("dl",null,e.dl.map(function(e,t){var n=Object(Ze.a)(e,2),a=n[0],r=n[1];return o.a.createElement(i.Fragment,{key:t},o.a.createElement("dt",null,a),o.a.createElement("dd",{dangerouslySetInnerHTML:{__html:r}}))})))})))),o.a.createElement("div",{className:"license"},o.a.createElement("p",null,"MIT License"),o.a.createElement("p",null,"Copyright (c) 2018 Gabriel Florit"),o.a.createElement("p",null,'Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:'),o.a.createElement("p",null,"The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software."),o.a.createElement("p",null,'THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.'))))}}]),t}(i.Component),Tn=Object(l.b)(function(){return{}},function(e){return{setLessonIndex:function(t){return e(K.setTutorialSlide({lessonIndex:t,slideIndex:0}))}}})(xn),jn=function(e){var t=e.split("-");return new Date(t[0],t[1]-1,t[2])},Nn=function(e,t){var n=new Date;return y()(e).map(function(e,a){var r,i;return e*function(e){return e<=4?100:e<=14?70:e<=31?50:e<=90?30:10}((r=jn(a),i=t?jn(t):n,Math.round((i-r)/864e5)))}).sum()},In=[["second",1],["minute",60],["hour",3600],["day",86400],["week",604800],["month",2592e3],["year",31536e3]],An=function(e){for(var t=e.now,n=e.before,a=Math.round((t-n)/1e3),r=0;r<In.length;r++)if(a<In[r][1])return 0===r?"Just now":(a=Math.round(a/In[r-1][1]))+" "+In[r-1][0]+(1===a?" ago":"s ago")},Rn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).renderCassette=n.renderCassette.bind(Object(ee.a)(Object(ee.a)(n))),n.handleNext=n.handleNext.bind(Object(ee.a)(Object(ee.a)(n))),n.handlePrevious=n.handlePrevious.bind(Object(ee.a)(Object(ee.a)(n))),n.state={index:0},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleNext",value:function(){this.setState({index:this.state.index+this.props.step})}},{key:"handlePrevious",value:function(){this.setState({index:Math.max(this.state.index-this.props.step,0)})}},{key:"renderCassette",value:function(e){var t=e.cassette,n=e.i,a=e.now,r=this.props,i=r.handleOnClick,s=r.tokenLogin,l=r.handleSetVisibility,c=r.handleRemove,u=t.isPrivate,h=t.gist,d=t.visits,m=(d?y.a.sum(Object.values(d)):0)+t.counter,p=t.title||"",f=p.length>16,g=[p.substring(0,16).trim(),f?"\u2026":""].join(""),b=new Date(t.updated);return o.a.createElement("li",{key:n,className:"cassette"},o.a.createElement("div",{className:"img"},o.a.createElement("span",{className:"title"},g||"\u2003"),o.a.createElement("a",{href:"/?id=".concat(h),onClick:function(e){i({e:e,id:h})},rel:"noopener noreferrer",target:"_blank"},o.a.createElement("img",{className:"background",alt:"",src:"./cassette-bg.png"}),o.a.createElement("span",{className:"load"},"load cassette"),t.cover?o.a.createElement("img",{className:"cover",src:t.cover,alt:""}):null),o.a.createElement("span",{className:"author"},"by ",o.a.createElement("a",{href:"/?shelf=".concat(t.user)},t.user)),o.a.createElement("div",{className:"date-info"},o.a.createElement("span",{className:"date"},An({now:a,before:b})),o.a.createElement("span",{className:"booted"},m||0," play",1===m?"":"s"))," "),s===t.user?o.a.createElement("div",{className:"buttons"},o.a.createElement("button",{className:"button",onClick:function(){l({gistId:h,isPrivate:!u})}},"make ",u?"public":"private"),o.a.createElement("button",{className:"button",onClick:function(){c({gistId:h})}},"remove")):null)}},{key:"render",value:function(){var e=this,t=this.props,n=t.cassettes,a=t.title,r=t.step,i=t.showAllButton,s=t.handleOnShowAllClick,l=this.state.index,c=new Date;return o.a.createElement("div",{className:"ShelfCassettes"},o.a.createElement("div",{className:"title-nav-and-show-all"},o.a.createElement("div",{className:"title-nav"},o.a.createElement("span",{className:"title"},a),o.a.createElement("button",{disabled:l<=0,className:"button",onClick:this.handlePrevious},"<"),o.a.createElement("button",{disabled:l>=n.length-r,className:"button",onClick:this.handleNext},">"),o.a.createElement("span",{className:"count"},l+1," - ",Math.min(l+r,n.length)," (",n.length," total)")),i?o.a.createElement("div",{className:"show-all"},o.a.createElement("button",{className:"button",onClick:s},"show all cassettes")):null),o.a.createElement("ul",{className:"cassettes"},y()(n).slice(l,l+r).map(function(t,n){return e.renderCassette({cassette:t,i:n,now:c})}).value()))}}]),t}(i.Component);Rn.defaultProps={step:5,showAllButton:!1};var Mn,Dn=Rn,Pn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).fetchCassettes=n.fetchCassettes.bind(Object(ee.a)(Object(ee.a)(n))),n.makeShelfCassettes=n.makeShelfCassettes.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOnClick=n.handleOnClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handleOnShowAllClick=n.handleOnShowAllClick.bind(Object(ee.a)(Object(ee.a)(n))),n.handleSetVisibility=n.handleSetVisibility.bind(Object(ee.a)(Object(ee.a)(n))),n.handleRemove=n.handleRemove.bind(Object(ee.a)(Object(ee.a)(n))),n.state={fetching:!0,popularCassettes:[],recentCassettes:[]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.fetchCassettes()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1;var e=window.location.search,t=new window.URLSearchParams(e),n=t.get("id"),a=t.get("shelf");!n&&a&&window.history.pushState(null,null,"/")}},{key:"fetchCassettes",value:function(){var e=this,t=this.props.token,n=y.a.get(t,"user.login",null),a=window.location.search,r=new window.URLSearchParams(a).get("shelf");t.value&&!r?window.fetch("".concat("https://script-8-api-l55chnkhk.now.sh","/private-cassettes"),{method:"POST",body:JSON.stringify({token:t.value})}).then(function(e){return e.json()},function(e){return H({error:e,message:"Could not request cassettes."})}).then(function(t){var n=y()(t).sortBy(function(e){return+e.updated}).reverse().value();e._isMounted&&e.setState({yourPrivateCassettes:n,fetching:!1})}):this._isMounted&&this.setState({yourPrivateCassettes:[]}),window.fetch("".concat("https://script-8-api-l55chnkhk.now.sh","/cassettes")).then(function(e){return e.json()},function(e){return H({error:e,message:"Could not request cassettes."})}).then(function(t){var a=t.map(function(e){return Object(F.a)({},e,{counter:+e.counter||0})}),r=y()(a).map(function(e){return Object(F.a)({},e,{score:Nn(e.visits)})}).sortBy(function(e){return e.score}).reverse().value(),i=y()(a).sortBy(function(e){return+e.updated}).reverse().value(),o=n?i.filter(function(e){return e.user===n}):[];e._isMounted&&e.setState({popularCassettes:r.filter(function(e){return!e.isFork}),recentCassettes:i.filter(function(e){return!e.isFork}),yourPublicCassettes:o,fetching:!1})})}},{key:"componentDidUpdate",value:function(e){(e.shelving&&!this.props.shelving||e.token!==this.props.token)&&(this.setState({fetching:!0}),this.fetchCassettes())}},{key:"handleOnShowAllClick",value:function(){window.history.pushState(null,null,"/"),this.setState({fetching:!0}),this.fetchCassettes()}},{key:"handleOnClick",value:function(e){var t=e.e,n=e.id,a=this.props,r=a.gist,i=a.setScreen;n===y.a.get(r,"data.id")&&(t.preventDefault(),i(k.RUN))}},{key:"handleSetVisibility",value:function(e){var t=e.gistId,n=e.isPrivate,a=this.props,r=a.token;(0,a.setVisibility)({token:r,gistId:t,isPrivate:n})}},{key:"handleRemove",value:function(e){var t=e.gistId,n=this.props,a=n.token,r=n.unshelveCassette;window.confirm("Do you really want to remove this cassette from the shelf?")&&r({gistId:t,token:a})}},{key:"makeShelfCassettes",value:function(e){var t=e.cassettes,n=e.title,a=e.tokenLogin;return o.a.createElement(Dn,{handleSetVisibility:this.handleSetVisibility,handleRemove:this.handleRemove,tokenLogin:a,handleOnClick:this.handleOnClick,cassettes:t,title:n})}},{key:"render",value:function(){var e=this.state,t=e.popularCassettes,n=e.recentCassettes,a=e.yourPublicCassettes,r=e.yourPrivateCassettes,s=e.fetching,l=y.a.get(this.props,"token.user.login",null),c=window.location.search,u=(new window.URLSearchParams(c).get("shelf")||"").toLowerCase(),h=n.filter(function(e){return e.user.toLowerCase()===u});return o.a.createElement("div",{className:"Shelf"},o.a.createElement("div",{className:"main"},s?o.a.createElement("p",{className:"loading"},"loading cassettes..."):u?h.length?o.a.createElement(Dn,{handleSetVisibility:this.handleSetVisibility,handleRemove:this.handleRemove,tokenLogin:l,handleOnClick:this.handleOnClick,cassettes:h,title:"".concat(u,"'s ").concat(l&&u===l.toLowerCase()?"public":""," cassettes"),step:20,showAllButton:!0,handleOnShowAllClick:this.handleOnShowAllClick}):o.a.createElement("p",{className:"loading"},"no cassettes found"):o.a.createElement(i.Fragment,null,r&&r.length?o.a.createElement(Dn,{handleSetVisibility:this.handleSetVisibility,handleRemove:this.handleRemove,tokenLogin:l,handleOnClick:this.handleOnClick,cassettes:r,title:"Your private cassettes"}):null,a&&a.length?o.a.createElement(Dn,{handleSetVisibility:this.handleSetVisibility,handleRemove:this.handleRemove,tokenLogin:l,handleOnClick:this.handleOnClick,cassettes:a,title:"Your public cassettes"}):null,o.a.createElement(Dn,{handleSetVisibility:this.handleSetVisibility,handleRemove:this.handleRemove,tokenLogin:l,handleOnClick:this.handleOnClick,cassettes:t,title:"Popular cassettes"}),o.a.createElement(Dn,{handleSetVisibility:this.handleSetVisibility,handleRemove:this.handleRemove,tokenLogin:l,handleOnClick:this.handleOnClick,cassettes:n,title:"Recent cassettes"}))))}}]),t}(i.Component),Un=Object(l.b)(function(e){return{gist:e.gist,token:e.token,shelving:e.shelving}},function(e){return{unshelveCassette:function(t){var n=t.token,a=t.gistId;return e(function(e){var t=e.token,n=e.gistId;return function(e){return e(z.shelveCassetteRequest()),window.fetch("".concat("https://script-8-api-l55chnkhk.now.sh","/delete"),{method:"POST",body:JSON.stringify({token:t.value,gist:n})}).then(function(e){return e.json()},function(e){return H({error:e,message:"Could not delete."})}).then(function(){return e(z.shelveCassetteSuccess())})}}({token:n,gistId:a}))},setScreen:function(t){return e(K.setScreen(t))},setVisibility:function(t){var n=t.token,a=t.gistId,r=t.isPrivate;return e(function(e){var t=e.token,n=e.gistId,a=e.isPrivate;return function(e){return e(z.setVisibilityRequest()),window.fetch("".concat("https://script-8-api-l55chnkhk.now.sh","/set-visibility"),{method:"POST",body:JSON.stringify({token:t.value,gist:n,isPrivate:a})}).then(function(e){return e.json()},function(e){return H({error:e,message:"Could not set visibility."})}).then(function(){return e(z.setVisibilitySuccess())})}}({token:n,gistId:a,isPrivate:r}))}}})(Pn),Ln=n(43),_n=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleDismissNotices=n.handleDismissNotices.bind(Object(ee.a)(Object(ee.a)(n))),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleDismissNotices",value:function(){this.props.dismissNotices(Ln.map(function(e){return e.id}))}},{key:"render",value:function(){var e=y.a.difference(Ln.map(function(e){return e.id}),this.props.dismissedNotices);return o.a.createElement("div",{className:"Notice"},o.a.createElement("div",{className:"box"},o.a.createElement("div",{className:"text"},o.a.createElement("p",{className:"title"},"SCRIPT-8 updates"),y()(e).map(function(e){return Ln.find(function(t){return t.id===e})}).sortBy("id").reverse().map(function(e,t){return o.a.createElement("p",{key:t},o.a.createElement("span",null,e.date," - "),e.text)}).value()),o.a.createElement("button",{className:"button",onClick:this.handleDismissNotices},"> OK")))}}]),t}(i.Component),Hn=Object(l.b)(function(e){return{dismissedNotices:e.dismissedNotices}},function(e){return{dismissNotices:function(t){return e(K.dismissNotices(t))}}})(_n),Fn="Insert your comment here.",Gn=function(e){return e&&e.length&&e!==Fn},Bn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).deleteComment=n.deleteComment.bind(Object(ee.a)(Object(ee.a)(n))),n.createIssueAndComment=n.createIssueAndComment.bind(Object(ee.a)(Object(ee.a)(n))),n.fetchIssueAndComments=n.fetchIssueAndComments.bind(Object(ee.a)(Object(ee.a)(n))),n.updateUserScopes=n.updateUserScopes.bind(Object(ee.a)(Object(ee.a)(n))),n.createComment=n.createComment.bind(Object(ee.a)(Object(ee.a)(n))),n.handleCommentCreate=n.handleCommentCreate.bind(Object(ee.a)(Object(ee.a)(n))),n.handleCommentDelete=n.handleCommentDelete.bind(Object(ee.a)(Object(ee.a)(n))),n.handleCommentChange=n.handleCommentChange.bind(Object(ee.a)(Object(ee.a)(n))),n.handleLoginClick=n.handleLoginClick.bind(Object(ee.a)(Object(ee.a)(n))),n.state={commentTextarea:Fn,comments:[],issue:null,error:null,isFetching:!1,scopes:""},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"updateUserScopes",value:function(){var e=Object(He.a)(_e.a.mark(function e(){var t,n,a,r;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.token,!(n=y.a.get(t,"user.login",null))){e.next=9;break}return a="https://api.github.com/users/".concat(n),console.log("updateUserScopes: fetch ".concat(a)),e.next=7,fetch(a,{headers:{Authorization:"token ".concat(t.value),"Content-Type":"application/json"}});case 7:(r=e.sent).headers.has("x-oauth-scopes")&&this.setState({scopes:r.headers.get("x-oauth-scopes")});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchIssueAndComments",value:function(){var e=Object(He.a)(_e.a.mark(function e(){var t,n,a,r,i,o,s,l;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.gameId,n="https://api.github.com/search/issues?q=".concat(t,"+repo:script8/script8.github.io"),console.log("componentDidMount: fetch ".concat(n,".")),e.next=5,fetch(n);case 5:return a=e.sent,e.next=8,a.json();case 8:if(r=e.sent,i=y.a.get(r,"items[0]",null),o=y.a.get(r,"items[0].comments_url",null),!i||!o){e.next=21;break}return this.setState({issue:i}),console.log("componentDidMount: fetch ".concat(o,".")),e.next=16,fetch(o);case 16:return s=e.sent,e.next=19,s.json();case 19:l=e.sent,this.setState({comments:l});case 21:this.updateUserScopes();case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.fetchIssueAndComments()}},{key:"createIssueAndComment",value:function(){var e=Object(He.a)(_e.a.mark(function e(){return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createIssue();case 2:return e.next=4,this.createComment();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createIssue",value:function(){var e=Object(He.a)(_e.a.mark(function e(){var t,n,a,r,i,o,s;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.token,a=t.gameId,this.setState({isFetching:!0}),r="https://api.github.com/repos/script8/script8.github.io/issues",i={method:"POST",headers:{Authorization:"token ".concat(n.value),"Content-Type":"application/json"},body:JSON.stringify({title:a})},console.log("createIssue: fetching ".concat(r)),e.next=7,fetch(r,i);case 7:if(201!==(o=e.sent).status){e.next=15;break}return e.next=11,o.json();case 11:s=e.sent,this.setState({issue:s,isFetching:!1}),e.next=17;break;case 15:throw this.setState({isFetching:!1}),new Error(o.statusText);case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createComment",value:function(){var e=Object(He.a)(_e.a.mark(function e(){var t,n,a,r,i,o,s,l;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.token,n=this.state,a=n.issue,r=n.commentTextarea,this.setState({isFetching:!0}),i="https://api.github.com/repos/script8/script8.github.io/issues/".concat(a.number,"/comments"),o={method:"POST",headers:{Authorization:"token ".concat(t.value),"Content-Type":"application/json"},body:JSON.stringify({body:r})},console.log("createComment: fetch ".concat(i)),e.next=8,fetch(i,o);case 8:if(201!==(s=e.sent).status){e.next=16;break}return e.next=12,s.json();case 12:l=e.sent,this.setState({isFetching:!1,comments:[].concat(Object(B.a)(this.state.comments),[l]),commentTextarea:Fn}),e.next=17;break;case 16:throw new Error(s.statusText);case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"deleteComment",value:function(){var e=Object(He.a)(_e.a.mark(function e(t){var n,a,r,i;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props.token,this.setState({isFetching:!0}),a="https://api.github.com/repos/script8/script8.github.io/issues/comments/".concat(t),r={method:"DELETE",headers:{Authorization:"token ".concat(n.value)}},console.log("handleCommentDelete: fetch ".concat(a)),e.next=7,fetch(a,r);case 7:204===(i=e.sent).status?this.setState({isFetching:!1,comments:this.state.comments.filter(function(e){return e.id!==t})}):this.setState({isFetching:!1,error:i.statusText});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleCommentDelete",value:function(e){this.deleteComment(e)}},{key:"handleCommentCreate",value:function(){var e=this.state,t=e.issue,n=e.commentTextarea,a=e.isFetching;if(console.log({commentTextarea:n,isFetching:a,issue:t}),!a&&Gn(n))if(t)try{console.log("creating comment"),this.createComment()}catch(r){this.setState({isFetching:!1,error:r.message})}else try{console.log("creating issue and comment"),this.createIssueAndComment()}catch(r){this.setState({isFetching:!1,error:r.message})}}},{key:"handleCommentChange",value:function(e){this.setState({commentTextarea:e.target.value,error:null})}},{key:"handleLoginClick",value:function(){window.open("https://github.com/login/oauth/authorize?client_id=".concat("25365dd03e3a923dcf43","&scope=gist public_repo"),"popup","width=600,height=700")}},{key:"componentDidUpdate",value:function(e){var t=e.token,n=this.props.token;t.value!==n.value&&this.updateUserScopes()}},{key:"render",value:function(){var e=this,t=this.props.token,n=this.state,a=n.commentTextarea,r=n.comments,i=n.isFetching,s=n.error,l=n.scopes,c=new Date,u=y.a.get(t,"user.login",null),h=i||!Gn(a),d=l.includes("public_repo"),m=!!u&&d;return o.a.createElement("div",{className:"Comments"},o.a.createElement("ul",null,r.map(function(t,n){return o.a.createElement("li",{key:n},o.a.createElement("div",{className:"info"},o.a.createElement("span",{className:"user"},t.user.login),o.a.createElement("span",{className:"time"},An({now:c,before:new Date(t.updated_at)})),u&&u===t.user.login&&o.a.createElement("button",{className:"button delete",onClick:function(){e.handleCommentDelete(t.id)}},"> delete")),o.a.createElement("div",{className:"comment"},t.body))})),m&&o.a.createElement("div",{className:"comment-box"},o.a.createElement("textarea",{value:a,onChange:this.handleCommentChange}),o.a.createElement("div",{className:"ok-button"},o.a.createElement("button",{className:"button",disabled:h,onClick:this.handleCommentCreate},"> Add comment")),s&&o.a.createElement("div",{className:"error"},"Error: ",s)),!m&&o.a.createElement("div",{className:"comment-login-prompt"},o.a.createElement("button",{className:"button",onClick:this.handleLoginClick},">"," ",u&&!d?"please login again to comment":"login to comment")),o.a.createElement("div",{className:E()("loading",{"is-fetching":i})},"LOAD"))}}]),t}(i.Component),Vn=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.gist,t=y.a.get(e,"data.id");t&&this.updateUrl(t)}},{key:"componentDidUpdate",value:function(e){var t=this.props.gist,n=y.a.get(e,"gist.data.id"),a=y.a.get(t,"data.id");a!==n&&this.updateUrl(a)}},{key:"updateUrl",value:function(e){var t=window.location.search;new window.URLSearchParams(t).get("id")!==e&&window.history.pushState(null,null,e?"/?id=".concat(e):"/")}},{key:"render",value:function(){return null}}]),t}(i.Component),Wn=Object(l.b)(function(e){return{gist:e.gist}},function(){return{}})(Vn),qn=function(e){var t=e.game,n=e.sprites,a=e.map,r=e.phrases,i=e.chains,o=e.songs;return Ne()(t,D.game)&&Ne()(n,D.sprites)&&Ne()(a,D.map)&&Ne()(r,D.phrases)&&Ne()(i,D.chains)&&Ne()(o,D.songs)},Xn=window.navigator.platform,Jn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).keydown=n.keydown.bind(Object(ee.a)(Object(ee.a)(n))),n.onExport=n.onExport.bind(Object(ee.a)(Object(ee.a)(n))),n.onRecordClick=n.onRecordClick.bind(Object(ee.a)(Object(ee.a)(n))),n.onLoginClick=n.onLoginClick.bind(Object(ee.a)(Object(ee.a)(n))),n.onInsertBlankClick=n.onInsertBlankClick.bind(Object(ee.a)(Object(ee.a)(n))),n.onPutOnShelfClick=n.onPutOnShelfClick.bind(Object(ee.a)(Object(ee.a)(n))),n.record=n.record.bind(Object(ee.a)(Object(ee.a)(n))),n.onClose=n.onClose.bind(Object(ee.a)(Object(ee.a)(n))),n.onUpdateIframeVersion=n.onUpdateIframeVersion.bind(Object(ee.a)(Object(ee.a)(n))),window.script8.handleCode=e.fetchToken,window.addEventListener("beforeunload",n.onClose),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){var e=this.props,t=e.token,n=e.nextAction,a=e.clearNextAction;t.value&&n&&(a(),"record"===n&&this.record(),"recordToFork"===n&&this.record(!0))}},{key:"keydown",value:function(e){var t=this.props,n=t.screen,a=t.game,r=t.setCodeTab,i=t.setScreen,o=t.token,s=e.altKey,l=e.code,c=e.metaKey,u=e.ctrlKey;if((c&&"KeyS"===l&&y.a.includes(Xn,"Mac")||u&&"KeyS"===l&&!y.a.includes(Xn,"Mac"))&&o.value&&Ue(this.props)&&(this.onRecordClick(!1),e.preventDefault()),s){if(n===k.CODE){var h=+J(a).key;"BracketLeft"===l&&(r((h-1+8)%8),e.preventDefault()),"BracketRight"===l&&(r((h+1)%8),e.preventDefault())}"Period"===l&&(i(w(n)),e.preventDefault()),"Slash"===l&&(i(C(n)),e.preventDefault())}}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.keydown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onClose),window.removeEventListener("keydown",this.keydown)}},{key:"onUpdateIframeVersion",value:function(){window.confirm("Do you really want to update to the latest SCRIPT-8 API? This change cannot be reverted.")&&this.props.updateIframeVersion()}},{key:"onExport",value:function(){var e=this.props,t=e.gist,n=e.game,a=Je(n).toUpperCase(),r=y.a.get(t,"data.id",null),i="https://script8.github.io/iframe-v".concat(M.a,".html");window.fetch(i).then(function(e){return e.text()}).then(function(e){!function(e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","index.html"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}(e.replace("<title>script-8-iframe</title>","<title>".concat(a,"</title><style>#root canvas.master { width: 100vmin; height: 100vmin; }</style>")).replace("<body>",'<body><script>window.SCRIPT_8_EMBEDDED_GIST_ID="'.concat(r,'";<\/script>')))})}},{key:"onClose",value:function(e){var t=this.props,n=t.gist,a=t.game,r=t.sprites,i=t.map,o=t.phrases,s=t.chains,l=t.songs,c=t.iframeVersion;if(Pe({gist:n,game:a,sprites:r,map:i,phrases:o,chains:s,songs:l,iframeVersion:c})){var u="Leave site? Changes you made may not be saved.";return e.returnValue=u,u}}},{key:"onLoginClick",value:function(){var e=this.props,t=e.token,n=e.clearToken;!!t.value?n():window.open("https://github.com/login/oauth/authorize?client_id=".concat("25365dd03e3a923dcf43","&scope=gist public_repo"),"popup","width=600,height=700")}},{key:"onInsertBlankClick",value:function(){var e=this.props,t=e.gist,n=e.game,a=e.sprites,r=e.map,i=e.phrases,o=e.chains,s=e.songs,l=e.iframeVersion;Pe({gist:t,game:n,sprites:a,map:r,phrases:i,chains:o,songs:s,iframeVersion:l})&&!window.confirm("You have not recorded the cassette. Changes will be lost. Are you sure?")||this.props.newGame(this.props.screen)}},{key:"onPutOnShelfClick",value:function(e){var t=this.props,n=t.putOnShelf,a=t.gist,r=t.game,i=t.token,o=y.a.get(a,"data.owner.login",null),s=y.a.get(a,"data.id",null),l=!!y.a.get(a,"data.fork_of",null),c={user:o,gist:s,title:Je(r),isFork:l,isPrivate:e,token:i},u=document.querySelector("iframe");if(u){var h=new window.MessageChannel;u.contentWindow.postMessage({type:"image"},"*",[h.port2]),h.port1.onmessage=function(e){var t=e.data;n(Object(F.a)({},c,{cover:t}))}}else n(c)}},{key:"onRecordClick",value:function(e){var t=this.props,n=t.token,a=t.setNextAction;e&&!window.confirm("Do you really want to record to a blank cassette?")||(n.value?this.record(e):(a(e?"recordToFork":"record"),window.open("https://github.com/login/oauth/authorize?client_id=".concat("25365dd03e3a923dcf43","&scope=gist public_repo"),"popup","width=600,height=700")))}},{key:"record",value:function(e){var t=this.props,n=t.iframeVersion,a=t.token,r=t.game,i=t.saveGist,o=t.gist;i({iframeVersion:n,token:a,game:r,sprites:t.sprites,map:t.map,phrases:t.phrases,chains:t.chains,songs:t.songs,gist:o,toFork:e})}},{key:"render",value:function(){var e=this,t=this.props,n=t.screen,a=t.gist,r=t.token,i=t.game,s=t.sprites,l=t.map,c=t.phrases,u=t.chains,h=t.songs,d=t.setScreen,m=t.sound,p=t.toggleSound,f=t.setCodeTab,g=t.isFetching,b=t.iframeVersion,v=Pe({gist:a,game:i,sprites:s,map:l,phrases:c,chains:u,songs:h,iframeVersion:b}),O=qn({game:i,sprites:s,map:l,phrases:c,chains:u,songs:h}),S=y.a.isEmpty(W(i))&&y.a.isEmpty(s)&&y.a.isEmpty(l)&&y.a.isEmpty(c)&&y.a.isEmpty(u)&&y.a.isEmpty(h),C=y.a.get(a,"data.owner.login",null),w=y.a.get(r,"user.login",null),x=!y.a.isEmpty(a)||!O,T=Ue(this.props),j=!y.a.isEmpty(a)&&(null===C||C!==w||!S),N=w&&w===C,I=N&&!v,A=[k.SONG,k.CHAIN,k.PHRASE].includes(n),R=[k.SPRITE,k.MAP].includes(n),D=J(i).key,P=n===k.CODE?" ".concat(D):"",U=!!r.value,L=b&&b!==M.a;return o.a.createElement("nav",{className:"Menu"},o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.HOME)},className:E()("button",{active:n===k.HOME})},o.a.createElement("span",{className:"full"},"SCRIPT-8"),o.a.createElement("span",{className:"mid"},"SCRIPT-8"),o.a.createElement("span",{className:"small"},n===k.HOME?"script-8":"s-8")),o.a.createElement("ul",{className:"dropdown"},o.a.createElement("li",null,o.a.createElement("button",{onClick:this.onLoginClick,className:"button",disabled:U},"Login")),o.a.createElement("li",null,o.a.createElement("button",{onClick:this.onLoginClick,className:"button",disabled:!U},"Logout")))),o.a.createElement("li",null,o.a.createElement("button",{className:"button"},o.a.createElement("span",{className:"full"},"cassette"),o.a.createElement("span",{className:"mid"},"cas"),o.a.createElement("span",{className:"small"},"ca"),o.a.createElement("span",{className:E()({invisible:!v})},"*")),o.a.createElement("ul",{className:"dropdown"},o.a.createElement("li",null,o.a.createElement("button",{onClick:this.onInsertBlankClick,className:"button",disabled:!x},"Insert new")),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){e.onRecordClick(!1)},className:"button",disabled:!T},"Record")),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){e.onRecordClick(!0)},className:"button",disabled:!j},"Record to blank")),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){e.onPutOnShelfClick(!0)},disabled:!I,className:"button"},"Put on private shelf")),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){e.onPutOnShelfClick(!1)},disabled:!I,className:"button"},"Put on public shelf")),o.a.createElement("li",null,null),o.a.createElement("li",null,L?o.a.createElement("button",{onClick:this.onUpdateIframeVersion,className:"button"},"UPDATE SCRIPT-8 API"):null))),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.CODE)},className:E()("button",{active:n===k.CODE})},o.a.createElement("span",{className:"full"},"CODE",P),o.a.createElement("span",{className:"mid"},n===k.CODE?"code".concat(P):"cod".concat(P)),o.a.createElement("span",{className:"small"},n===k.CODE?"code".concat(P):"co".concat(P))),o.a.createElement("ul",{className:"dropdown"},y.a.range(8).map(function(e){return o.a.createElement("li",{key:e},o.a.createElement("button",{className:"button",onClick:function(){f(e),d(k.CODE)}},"CODE ",e))}))),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.SPRITE)},className:E()("button",{active:R})},o.a.createElement("span",{className:"full"},R?n:"ART"),o.a.createElement("span",{className:"mid"},R?n:"ART"),o.a.createElement("span",{className:"small"},R?n.substring(0,2):"AR")),o.a.createElement("ul",{className:"dropdown"},o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.SPRITE)},className:E()("button",{active:n===k.SPRITE})},"SPRITE")),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.MAP)},className:E()("button",{active:n===k.MAP})},"MAP")))),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.PHRASE)},className:E()("button",{active:A})},o.a.createElement("span",{className:"full"},A?n:"music"),o.a.createElement("span",{className:"mid"},A?n:"mus"),o.a.createElement("span",{className:"small"},A?n.substring(0,2):"mu")),o.a.createElement("ul",{className:"dropdown"},o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.PHRASE)},className:E()("button",{active:n===k.PHRASE})},"PHRASE")),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.CHAIN)},className:E()("button",{active:n===k.CHAIN})},"CHAIN")),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.SONG)},className:E()("button",{active:n===k.SONG})},"SONG")))),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.HELP)},className:E()("button",{active:n===k.HELP})},o.a.createElement("span",{className:"full"},"HELP"),o.a.createElement("span",{className:"mid"},n===k.HELP?"help":"hel"),o.a.createElement("span",{className:"small"},n===k.HELP?"help":"he"))),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.SHELF)},className:E()("button",{active:n===k.SHELF})},o.a.createElement("span",{className:"full"},"SHELF"),o.a.createElement("span",{className:"mid"},n===k.SHELF?"shelf":"she"),o.a.createElement("span",{className:"small"},n===k.SHELF?"shelf":"sh"))),o.a.createElement("li",null,o.a.createElement("button",{onClick:function(){d(k.RUN)},className:E()("button",{active:n===k.RUN})},o.a.createElement("span",{className:"full"},"RUN"),o.a.createElement("span",{className:"mid"},"run"),o.a.createElement("span",{className:"small"},n===k.RUN?"run":"ru"))),o.a.createElement("li",{className:E()({hide:n!==k.RUN})},o.a.createElement("button",{onClick:p,className:"button"},o.a.createElement("span",{className:"full"},m?"":"un","mute"),o.a.createElement("span",{className:"mid"},m?"":"un","mute"),o.a.createElement("span",{className:"small"},m?"":"un","mute")))),o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement("button",{className:E()("button","title",{"is-fetching":g})},o.a.createElement("span",null,"load")))))}}]),t}(i.Component),Yn=Object(l.b)(function(e){var t=e.iframeVersion,n=e.gist,a=e.game,r=e.sprites,i=e.map,o=e.phrases,s=e.chains,l=e.songs,c=e.token,u=e.shelving,h=e.screen,d=e.nextAction,m=e.sound;return{iframeVersion:t,screen:h,gist:n,game:a,sprites:r,map:i,phrases:o,chains:s,songs:l,token:c,isFetching:n.isFetching||c.isFetching||u,nextAction:d,sound:m}},function(e){return{updateIframeVersion:function(){return e(K.updateIframeVersion())},clearToken:function(){return e(K.clearToken())},setCodeTab:function(t){return e(K.setCodeTab(t))},toggleSound:function(){return e(K.toggleSound())},clearNextAction:function(){return e(K.clearNextAction())},fetchToken:function(t){return e((n=t,function(e){return e(z.tokenRequest()),window.fetch("".concat("https://script-8.herokuapp.com","/authenticate/").concat(n)).then(function(e){return e.json()},function(e){return H({error:e,message:"Could not fetch oauth token."})}).then(function(e){var t=e.token;return new j.a({token:t}).getUser().getProfile().then(function(e){return{token:t,user:e.data}},function(e){return H({error:e,message:"Could not fetch GitHub user despite valid oauth token."})})}).then(function(t){return e(z.tokenSuccess(t))})}));var n},newGame:function(t){return e(K.newGame(t))},putOnShelf:function(t){var n=t.user,a=t.gist,r=t.cover,i=t.title,o=t.isFork,s=t.isPrivate,l=t.token;return e(function(e){var t=e.user,n=e.gist,a=e.cover,r=e.title,i=e.isFork,o=e.isPrivate,s=e.token;return function(e){return e(z.shelveCassetteRequest()),window.fetch("".concat("https://script-8-api-l55chnkhk.now.sh","/cassette"),{method:"POST",body:JSON.stringify({user:t,gist:n,cover:a,title:r,isFork:i,isPrivate:o,token:s.value})}).then(function(e){return e.json()},function(e){return H({error:e,message:"Could not post cassette via appspot service."})}).then(function(){return e(z.shelveCassetteSuccess())}).then(function(){return e(z.setScreen(k.SHELF))})}}({user:n,gist:a,cover:r,title:i,isFork:o,isPrivate:s,token:l}))},saveGist:function(t){var n=t.iframeVersion,a=t.game,r=t.token,i=t.gist,o=t.sprites,s=t.map,l=t.phrases,c=t.chains,u=t.songs,h=t.toFork;return e(Q({iframeVersion:n,game:a,token:r,gist:i,sprites:o,map:s,phrases:l,chains:c,songs:u,toFork:h}))},setNextAction:function(t){return e(K.setNextAction(t))},setScreen:function(t){return e(K.setScreen(t))}}})(Jn),zn=function(e){var t=e.hideMenu;return o.a.createElement("div",{className:E()("TopBar",{show:!t})},o.a.createElement(Wn,null),o.a.createElement(Yn,null))},Kn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={hasError:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({error:e,errorInfo:t})}},{key:"render",value:function(){var e=this.state,t=e.error,n=e.errorInfo;return n?o.a.createElement("div",{className:"ErrorBoundary"},o.a.createElement("h2",null,"Something went wrong."),o.a.createElement("details",{style:{whiteSpace:"pre-wrap"}},t&&t.toString(),o.a.createElement("br",null),n.componentStack)):this.props.children}}]),t}(i.Component);n(292);console.log(JSON.stringify("SCRIPT-8 app v ".concat(M.a),null,2));var Qn,Zn,$n,ea,ta,na,aa,ra,ia,oa,sa,la,ca,ua=function(e){var t=e.gist,n=e.token,a=y.a.get(t,"data.owner.login",null),r=y.a.get(n,"user.login",null),i=r&&r===a,o=y.a.difference(Ln.map(function(e){return e.id}),e.dismissedNotices);return i&&o.length},ha=(Mn={},Object(p.a)(Mn,k.BOOT,function(){return o.a.createElement($,null)}),Object(p.a)(Mn,k.HOME,function(){return o.a.createElement(ke,null)}),Object(p.a)(Mn,k.SPRITE,function(){return o.a.createElement(xt,null)}),Object(p.a)(Mn,k.MAP,function(){return o.a.createElement(Nt,null)}),Object(p.a)(Mn,k.PHRASE,function(){return o.a.createElement(qt,null)}),Object(p.a)(Mn,k.CHAIN,function(){return o.a.createElement(Kt,null)}),Object(p.a)(Mn,k.SONG,function(){return o.a.createElement(tn,null)}),Object(p.a)(Mn,k.RUN,function(){return null}),Object(p.a)(Mn,k.CODE,function(){return o.a.createElement(Sn,null)}),Object(p.a)(Mn,k.HELP,function(){return o.a.createElement(Tn,null)}),Object(p.a)(Mn,k.SHELF,function(){return o.a.createElement(Un,null)}),Mn),da=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).tutorialElement=o.a.createRef(),n.appElement=null,n.setAppElementRef=function(e){n.appElement=e},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){if(this.tutorialElement&&this.tutorialElement.current){var e=this.tutorialElement.current.clientHeight;this.appElement.style.paddingBottom="".concat(e,"px")}else this.appElement.style.paddingBottom="0";ua(this.props)?document.body.classList.add("overflow-hidden"):document.body.classList.remove("overflow-hidden")}},{key:"render",value:function(){var e=this.props,t=e.screen,n=e.tutorial,a=e.hideMenu,r=e.token,i=e.gist,s=y.a.get(i,"data.id",null),l=ua(this.props);return o.a.createElement(Kn,null,o.a.createElement("div",{ref:this.setAppElementRef,className:E()("App","App-".concat(t),{"full-height":g()([k.BOOT,k.CODE],t)})},o.a.createElement(zn,{hideMenu:a}),ha[t](),o.a.createElement(Qe,null),n?o.a.createElement(hn,{className:E()({"in-RUN":t===k.RUN}),tutorialRef:this.tutorialElement}):null,l?o.a.createElement(Hn,null):null,t===k.RUN&&s&&o.a.createElement(Bn,{gameId:s,token:r})))}}]),t}(i.Component),ma=Object(l.b)(function(e){return{gist:e.gist,screen:e.screen,tutorial:e.tutorial,dismissedNotices:e.dismissedNotices,token:e.token,hideMenu:e.hideMenu}},function(){return{}})(da),pa=n(128),fa=n(35),ga=Object(G.a)(Object(p.a)({},N.SET_SCREEN,function(e,t){return g()([k.PHRASE,k.CHAIN,k.SONG,k.RUN],t.payload)&&It&&It.context&&It.context.state&&"running"!==It.context.state&&It.start(),t.payload}),D.screen),ba=Object(G.a)((Qn={},Object(p.a)(Qn,N.NEW_GAME,function(){}),Object(p.a)(Qn,N.FETCH_GIST_REQUEST,function(){return{isFetching:!0}}),Object(p.a)(Qn,N.FETCH_GIST_SUCCESS,function(e,t){return{isFetching:!1,data:t.payload}}),Object(p.a)(Qn,N.SAVE_GIST_REQUEST,function(e){return{data:e.data,isFetching:!0}}),Object(p.a)(Qn,N.SAVE_GIST_SUCCESS,function(e,t){return{isFetching:!1,data:t.payload}}),Qn),D.gist),Ea=Object(G.a)(Object(p.a)({},N.FINISH_BOOT,function(e,t){return!0}),D.booted),va=Object(G.a)((Zn={},Object(p.a)(Zn,N.CLEAR_TOKEN,function(){return D.token}),Object(p.a)(Zn,N.TOKEN_REQUEST,function(){return{isFetching:!0}}),Object(p.a)(Zn,N.TOKEN_SUCCESS,function(e,t){return{value:t.payload.token,user:t.payload.user}}),Zn),D.token),ya=Object(G.a)(($n={},Object(p.a)($n,N.SET_NEXT_ACTION,function(e,t){return t.payload}),Object(p.a)($n,N.CLEAR_NEXT_ACTION,function(){return null}),$n),D.nextAction),Oa=Object(G.a)((ea={},Object(p.a)(ea,N.NEW_GAME,function(){return D.sprites}),Object(p.a)(ea,N.FETCH_GIST_SUCCESS,function(e,t){return Ae(t.payload)}),Object(p.a)(ea,N.UPDATE_SPRITE,function(e,t){var n=t.payload,a=n.sprite;return A()(Object(F.a)({},e,Object(p.a)({},n.index,a&&a.slice(0,8).filter(function(e){return"        "!==e}).length?a:null)))}),ea),D.sprites),Sa=Object(G.a)((ta={},Object(p.a)(ta,N.NEW_GAME,function(){return D.map}),Object(p.a)(ta,N.FETCH_GIST_SUCCESS,function(e,t){return Ie(t.payload)}),Object(p.a)(ta,N.UPDATE_MAP,function(e,t){return t.payload}),ta),D.map),Ca=Object(G.a)((na={},Object(p.a)(na,N.NEW_GAME,function(){return D.phrases}),Object(p.a)(na,N.FETCH_GIST_SUCCESS,function(e,t){return _(t.payload)}),Object(p.a)(na,N.UPDATE_PHRASE,function(e,t){var n=t.payload,a=n.index,r=n.phrase;return A()(Object(F.a)({},e,Object(p.a)({},a,r&&!y.a.isEmpty(r.notes)&&Object.values(r.notes).filter(function(e){return!y.a.isNil(e)}).length?r:null)))}),na),D.phrases),wa=Object(G.a)((aa={},Object(p.a)(aa,N.NEW_GAME,function(){return D.chains}),Object(p.a)(aa,N.FETCH_GIST_SUCCESS,function(e,t){return Re(t.payload)}),Object(p.a)(aa,N.UPDATE_CHAIN,function(e,t){var n=t.payload;return A()(Object(F.a)({},e,Object(p.a)({},n.index,n.chain)))}),aa),D.chains),ka=Object(G.a)((ra={},Object(p.a)(ra,N.NEW_GAME,function(){return D.songs}),Object(p.a)(ra,N.FETCH_GIST_SUCCESS,function(e,t){return Me(t.payload)}),Object(p.a)(ra,N.UPDATE_SONG,function(e,t){var n=t.payload;return A()(Object(F.a)({},e,Object(p.a)({},n.index,n.song)))}),ra),D.songs),xa=Object(G.a)((ia={},Object(p.a)(ia,N.CLOSE_TUTORIAL,function(){return null}),Object(p.a)(ia,N.SET_TUTORIAL_SLIDE,function(e,t){return t.payload}),ia),D.tutorial),Ta=Object(G.a)(Object(p.a)({},N.TOGGLE_SOUND,function(e,t){return!e}),D.sound),ja=Object(G.a)((oa={},Object(p.a)(oa,N.UNSHELVE_CASSETTE_REQUEST,function(){return!0}),Object(p.a)(oa,N.UNSHELVE_CASSETTE_SUCCESS,function(){return!1}),Object(p.a)(oa,N.SHELVE_CASSETTE_REQUEST,function(){return!0}),Object(p.a)(oa,N.SHELVE_CASSETTE_SUCCESS,function(){return!1}),Object(p.a)(oa,N.SET_VISIBILITY_REQUEST,function(){return!0}),Object(p.a)(oa,N.SET_VISIBILITY_SUCCESS,function(){return!1}),oa),D.shelving),Na=Object(G.a)((sa={},Object(p.a)(sa,N.NEW_GAME,function(){return D.docHistories}),Object(p.a)(sa,N.UPDATE_HISTORY,function(e,t){var n=t.payload;return Object(F.a)({},e,Object(p.a)({},n.index,n.history))}),sa),D.docHistories),Ia=Object(G.a)(Object(p.a)({},N.DISMISS_NOTICES,function(e,t){var n=t.payload;return Object(B.a)(n)}),D.dismissedNotices),Aa=Object(G.a)(Object(p.a)({},N.SELECT_UI,function(e,t){var n=t.payload;return Object(F.a)({},n)}),D.selectedUi),Ra=Object(G.a)(Object(p.a)({},N.SET_ERROR_LINE,function(e,t){return t.payload}),D.errorLine),Ma=Object(G.a)((la={},Object(p.a)(la,N.UPDATE_IFRAME_VERSION,function(){return D.iframeVersion}),Object(p.a)(la,N.NEW_GAME,function(){return D.iframeVersion}),Object(p.a)(la,N.FETCH_GIST_SUCCESS,function(e,t){return De(t.payload)}),la),D.iframeVersion),Da=Object(G.a)((ca={},Object(p.a)(ca,N.TOGGLE_MENU,function(e,t){return!e}),Object(p.a)(ca,N.SET_SCREEN,function(e,t){return!!g()([k.BOOT,k.RUN],t.payload)&&e}),ca),D.hideMenu),Pa=Object(fa.c)({hideMenu:Da,iframeVersion:Ma,errorLine:Ra,screen:ga,gist:ba,booted:Ea,token:va,game:Y,nextAction:ya,sprites:Oa,map:Sa,phrases:Ca,chains:wa,songs:ka,tutorial:xa,sound:Ta,shelving:ja,docHistories:Na,dismissedNotices:Ia,selectedUi:Aa}),Ua=function(){try{var e=localStorage.getItem("script-8-1");if(null===e)return;return JSON.parse(e)}catch(t){return}}(),La=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||fa.d,_a=Object(fa.e)(Pa,Ua,La(Object(fa.a)(pa.a)));_a.subscribe(function(){!function(e){try{var t=JSON.stringify(e);localStorage.setItem("script-8-1",t)}catch(n){console.error(n)}}({token:_a.getState().token,dismissedNotices:_a.getState().dismissedNotices})});var Ha=_a;window.script8=window.script8||{},Object(s.render)(o.a.createElement(l.a,{store:Ha},o.a.createElement(ma,null)),document.getElementById("root"))},43:function(e){e.exports=[{id:7,date:"3-23-2019",text:"BREAKING CHANGE: Replaced `initialState` with `init`, a function. This only affects new cassettes. Consult HELP for more information."},{id:6,date:"3-8-2019",text:"BREAKING CHANGE: Renamed `actor.name` to `actor.id`. This only applies if you're have an `actors` array in `initialState`. If so, please update your cassettes."},{id:5,date:"3-5-2019",text:"Added LOGIN/LOGOUT buttons (under the top-left SCRIPT-8 menu button). If you don't see your cassettes in SHELF, please LOGIN."},{id:1,date:"2-24-2019",text:"Renamed `tile` to `getTile`. Please update your cassettes. See HELP for more details."}]}},[[130,1,2]]]);
//# sourceMappingURL=main.ba086089.chunk.js.map